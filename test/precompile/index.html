<html>
	<head>
	</head>

	<body>


		<script src="../../vm/src/gc.js"></script>
		<script src="../../vm/src/EventEmitter.js"></script>
		<script src="../../vm/src/FileManager.js"></script>
		<script src="../../vm/src/VM.js"></script>
		<!-- // <script src="../../vm/src/Register.js"></script> -->
		<script src="../../vm/src/Closure.js"></script>
		<!-- // <script src="../../vm/src/Function.js"></script> -->
		<!-- // <script src="../../vm/src/Coroutine.js"></script> -->
		<script src="../../vm/src/Table.js"></script>
		<script src="../../vm/src/Error.js"></script>
		<!-- // <script src="../../vm/src/File.js"></script> -->
		<!-- // <script src="../../vm/src/operations.js"></script> -->
		<script src="../../vm/src/jit.js"></script>
		<script src="../../vm/src/lib.js"></script>
		<script src="../../vm/src/utils.js"></script>
		<script src="../../vm/src/output.js"></script>

		<pre></pre>
		<script>
				var elOutput = document.getElementsByTagName('pre')[0];
				
				function escapeHTML(text) {
				    return text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
				}

				shine.stdout.write = function (message) {
					elOutput.innerHTML += escapeHTML(message) + '\n';
				};



				shine_precompiler_env = {
                        getTimestamp: function () {
                            return Date.now();
                        },

					system: {
						parseXML:  function (xml) {

        var parser, tree, obj;


        if (window.DOMParser) {

            parser = {

                parser: new DOMParser(),

                init: function () {

                    this.parser.async = false;

                },
                parse: function (xml) {

                    return this.parser.parseFromString(xml, 'text/xml');

                }
            };


        } else if (window.ActiveXObject) {

            parser = {

                parser: new ActiveXObject('Microsoft.XMLDOM'),

                init: function () {

                    this.parser.async = false;

                },
                parse: function (xml) {

                    return this.parser.loadXML(xml);

                }
            };


        } else {

            throw new Error('Native XML Parser not found');

        }

        function parseNode(node) {

            var nodes, result;

            result = {

                name: node.tagName,

                text: '',

                attributes: {}
            };


            if (node.attributes) {

                Array.prototype.forEach.call(node.attributes, function ( attribute) {

                    result.attributes[attribute.name] = attribute.value;

                });
            }


            if (node.childNodes.length > 0) {

                nodes = result.childNodes = [];


                Array.prototype.forEach.call(node.childNodes, function ( childNode) {

                    switch (childNode.nodeType) {


                    case 3: // TEXT_NODE

                    case 4: // CDATA_SECTION_NODE

                        result.text += childNode.textContent;

                        break;


                    case 8: // COMMENT_NODE

                        return;


                    default:
                        nodes.push(parseNode(childNode));

                    }
                });

            }
            //noinspection JSLint

            delete (result.text && !nodes.length) ? result.childNodes : result.text;

            return result;

        }

        parser.init();

        tree = parser.parse(xml);

        obj = parseNode(tree.childNodes[0]);


        return new shine.Table(obj);
        },

						getTimestamp: function () {
							return Date.now();
						},
					}
				};
	

			
			// shine_precompiler_env = { 
			// 	getTimestamp: function () { return Date.now(); } 
			// };


		</script>
		<script src="./output.js"></script>


	</body>
</html>