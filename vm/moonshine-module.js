define(function(require,exports,module){
 /*
 * Moonshine Lua VM
 * http://moonshinejs.org
 *
 * Copyright 2013 Gamesys Limited.
 * Distributed under the terms of the XXXXXXXXXX license.
 * http://moonshinejs.org/license
 */
 "use strict";var shine=shine||{};shine.EMPTY_OBJ={};shine.EMPTY_ARR=[];shine.gc={objects:[],arrays:[],collected:0,reused:0,cacheArray:function(a){a.length=0;this.arrays.push(a);this.collected++},cacheObject:function(b){for(var a in b){if(b.hasOwnProperty(a)){delete b[a]}}this.objects.push(b);this.collected++},createArray:function(){if(this.arrays.length){this.reused++}return this.arrays.pop()||[]},createObject:function(){if(this.objects.length){this.reused++}return this.objects.pop()||{}},decrRef:function(a){if(!a||!(a instanceof shine.Table)||a.__shine.refCount===undefined){return}if(--a.__shine.refCount==0){this.collect(a)}},incrRef:function(a){if(!a||!(a instanceof shine.Table)||a.__shine.refCount===undefined){return}a.__shine.refCount++},collect:function(d){if(d===undefined||d===null){return}if(d instanceof Array){return this.cacheArray(d)}if(typeof d=="object"&&d.constructor==Object){return this.cacheObject(d)}if(!(d instanceof shine.Table)||d.__shine.refCount===undefined){return}var b,a,c=d.__shine;for(b=0,a=c.values.length;b<a;b++){this.decrRef(c.values[b])}for(b=0,a=c.numValues.length;b<a;b++){this.decrRef(c.numValues[b])}this.cacheArray(c.keys);this.cacheArray(c.values);delete c.keys;delete c.values;this.cacheObject(c);delete d.__shine;for(b in d){if(d.hasOwnProperty(b)){this.decrRef(d[b])}}}};"use strict";var shine=shine||{};shine.EventEmitter=function(){this._listeners={}};shine.EventEmitter.prototype._trigger=function(b,e){var d=this._listeners[b],a,c;if(!d){return}if(!((e||shine.EMPTY_OBJ) instanceof Array)){e=[e]}for(c in d){if(d.hasOwnProperty(c)){a=d[c].apply(this,e);if(a!==undefined&&!a){break}}}};shine.EventEmitter.prototype.on=function(a,b){if(!this._listeners[a]){this._listeners[a]=[]}this._listeners[a].push(b)};shine.EventEmitter.prototype.unbind=function(a,c){for(var b in this._listeners[a]){if(this._listeners[a].hasOwnProperty(b)&&this._listeners[a][b]===c){this._listeners[a].splice(b,1)}}};if(typeof module=="object"&&module.exports){module.exports.EventEmitter=shine.EventEmitter}"use strict";var shine=shine||{};shine.FileManager=function(){shine.EventEmitter.call(this);this._cache={}};shine.FileManager.prototype=new shine.EventEmitter();shine.FileManager.prototype.constructor=shine.FileManager;shine.FileManager.prototype.load=function(b,g){var c=this,d;function f(j,i){var h;if(c.constructor._isJson(j)){h=JSON.parse(j)}else{if(c.constructor._isLuac(j)){h=c.constructor._parseLuac(j)}}if(h){window.setTimeout(function(){if(i){c._cache[i]=h}c._onSuccess(i||"",h,g)},1)}return !!h}function e(h){if(!f(h,b)){throw new Error("File contains non-parsable content: "+b)}}function a(h){c._onError(h,g)}switch(typeof b){case"string":if(!f(b)){if(d=this._cache[b]){window.setTimeout(function(){c._onSuccess(b,d,g)},1)}else{shine.utils.get(b,e,a)}}break;case"object":this._onSuccess("",b,g);break;default:throw new TypeError("Can't load object of unknown type")}};shine.FileManager.prototype._onSuccess=function(a,d,e){var c,b;if(d.format=="moonshine.package"){for(b in d.files){this._cache[b]=d.files[b]}this._trigger("loaded-package",d);if(!(a=d.main)){return}if(!(d=d.files[a])){throw new ReferenceError("The package's main reference does not point to a filename within the package")}}c=new shine.File(a,d);this._onFileLoaded(c,function(){e(null,c)})};shine.FileManager.prototype._onFileLoaded=function(a,b){b()};shine.FileManager.prototype._onError=function(a,b){b(a)};shine.FileManager._isJson=function(a){return/^({.*}|\[.*\])$/.test(a)};shine.FileManager._isLuac=function(a){return a.substr(0,5)==String.fromCharCode(27,76,117,97,81)};shine.FileManager._parseLuac=function(a){if(!shine.distillery){throw new Error('Moonshine needs the distillery to parse Lua byte code. Please include "distillery.moonshine.js" in the page.')}if(!("ArrayBuffer" in window)){console.warn("Browser does not support ArrayBuffers, this could cause unexpected results when loading binary files.")}return new shine.distillery.Parser().parse(a)};shine.FileManager.prototype.dispose=function(){delete this._cache};"use strict";var shine=shine||{};shine.VM=function(a){shine.EventEmitter.call(this);this.fileManager=new shine.FileManager();this._env=a||{};this._coroutineStack=[];this._status=shine.RUNNING;this._resumeStack=[];this._callbackQueue=[];this._resetGlobals()};shine.VM.prototype=new shine.EventEmitter();shine.VM.prototype.constructor=shine.VM;shine.RUNNING=0;shine.SUSPENDING=1;shine.SUSPENDED=2;shine.RESUMING=3;shine.DEAD=4;shine.VM.prototype._resetGlobals=function(){this._globals=this._bindLib(shine.lib);for(var a in this._globals){if(this._globals.hasOwnProperty(a)&&this._globals[a] instanceof shine.Table){this._globals["package"].loaded[a]=this._globals[a]}}this._globals["package"].loaded._G=this._globals;for(var a in this._env){if(this._env.hasOwnProperty(a)){this._globals[a]=this._env[a]}}};shine.VM.prototype._bindLib=function(c){var a=shine.gc.createObject();for(var b in c){if(c.hasOwnProperty(b)){if(c[b]&&c[b].constructor===shine.Table){a[b]=new shine.Table(shine.utils.toObject(c[b]))}else{if(c[b]&&c[b].constructor===Object){a[b]=this._bindLib(c[b])}else{if(typeof c[b]=="function"){a[b]=(function(e,d){return function(){return e.apply(d,arguments)}})(c[b],this)}else{a[b]=c[b]}}}}}return new shine.Table(a)};shine.VM.prototype.load=function(b,d,a){var c=this;this.fileManager.load(b,function(f,e){if(f){throw new URIError("Failed to load file: "+b+" ("+f+")")}c._trigger("file-loaded",e);if(d||d===undefined){c.execute(a,e)}})};shine.VM.prototype.execute=function(j,b){var h=this,a=b?[b]:this._files,d,b,g;if(!a.length){throw new Error("No files loaded.")}for(d in a){if(a.hasOwnProperty(d)){b=a[d];if(!b.data){throw new Error("Tried to execute file before data loaded.")}g=this._thread=new shine.Function(this,b,b.data,this._globals);this._trigger("executing",[g,j]);try{if(!j){g.call()}else{var i=shine.lib.coroutine.wrap.call(this,g),c=function(){i();if(j.uiOnly&&i._coroutine.status!=shine.DEAD){window.setTimeout(c,1)}};c()}}catch(f){shine.Error.catchExecutionError(f)}}}};shine.VM.prototype.setGlobal=function(a,b){this._globals[a]=b};shine.VM.prototype.getGlobal=function(a){return this._globals[a]};shine.VM.prototype.suspend=function(){if(this._status!==shine.RUNNING){throw new Error("attempt to suspend a non-running VM")}var a=this;this._status=shine.SUSPENDING;this._resumeVars=undefined;window.setTimeout(function(){if(a._status==shine.SUSPENDING){a._status=shine.SUSPENDED}},1)};shine.VM.prototype.resume=function(c){if(this._status!==shine.SUSPENDED&&this._status!==shine.SUSPENDING){throw new Error("attempt to resume a non-suspended VM")}if(!arguments.length||c!==undefined){c=c||this._resumeVars}if(c&&!(c instanceof Array)){var b=shine.gc.createArray();b.push(c);c=b}this._status=shine.RESUMING;this._resumeVars=c;var d=this._resumeStack.pop();if(d){try{if(d instanceof shine.Coroutine){d.resume()}else{if(d instanceof shine.Closure){d._run()}else{d()}}}catch(g){if(!((g||shine.EMPTY_OBJ) instanceof shine.Error)){var a=(g.stack||"");g=new shine.Error("Error in host call: "+g.message);g.stack=a;g.luaStack=a.split("\n")}if(!g.luaStack){g.luaStack=shine.gc.createArray()}g.luaStack.push([d,d._pc-1]);shine.Error.catchExecutionError(g)}}while(this._callbackQueue[0]){this._callbackQueue.shift()()}};shine.VM.prototype.dispose=function(){var a;for(var b in this._files){if(this._files.hasOwnProperty(b)){this._files[b].dispose()}}if(a=this._thread){a.dispose()}delete this._files;delete this._thread;delete this._globals;delete this._env;delete this._coroutineStack;this.fileManager.dispose();delete this.fileManager;shine.Closure._graveyard.length=0;shine.Closure._current=undefined;shine.Coroutine._graveyard.length=0};shine.getCurrentVM=function(){var a;return(a=this.Closure._current)&&a._vm};"use strict";var shine=shine||{};shine.Register=function(){this._items=shine.gc.createArray()};shine.Register._graveyard=[];shine.Register.create=function(){var a=shine.Register._graveyard.pop();return a||new shine.Register(arguments)};shine.Register.prototype.getLength=function(){return this._items.length};shine.Register.prototype.getItem=function(a){return this._items[a]};shine.Register.prototype.setItem=function(a,c){var b=this._items[a];shine.gc.incrRef(c);shine.gc.decrRef(b);this._items[a]=c};shine.Register.prototype.set=function(a){var c,b=Math.max(a.length,this._items.length);for(c=0;c<b;c++){this.setItem(c,a[c])}};shine.Register.prototype.push=function(){this._items.push.apply(this._items,arguments)};shine.Register.prototype.clearItem=function(a){delete this._items[a]};shine.Register.prototype.splice=function(a,b){this._items.splice.apply(this._items,arguments)};shine.Register.prototype.reset=function(){for(var b=0,a=this._items.length;b<a;b++){shine.gc.decrRef(this._items[b])}this._items.length=0};shine.Register.prototype.dispose=function(){this._items.reset();this.constructor._graveyard.push(this)};"use strict";var shine=shine||{};shine.Closure=function(c,b,f,e,g){var d=this;this._vm=c;this._globals=e;this._file=b;this._data=f;this._upvalues=g||shine.gc.createObject();this._constants=f.constants;this._functions=f.functions;this._instructions=f.instructions;this._register=this._register||shine.Register.create();this._pc=0;this._localsUsedAsUpvalues=this._localsUsedAsUpvalues||shine.gc.createArray();this._funcInstances=this._funcInstances||shine.gc.createArray();this._localFunctions=shine.gc.createObject();var d=this,a=function(){var j=shine.gc.createArray();for(var k=0,h=arguments.length;k<h;k++){j.push(arguments[k])}return d.execute(j)};a._instance=this;a.dispose=function(){d.dispose.apply(d,arguments);delete this.dispose};return a};shine.Closure.prototype={};shine.Closure.prototype.constructor=shine.Closure;shine.Closure._graveyard=[];shine.Closure._current=undefined;shine.Closure.create=function(c,b,e,d,f){var a=shine.Closure._graveyard.pop();if(a){return shine.Closure.apply(a,arguments)}else{return new shine.Closure(c,b,e,d,f)}};shine.Closure.prototype.execute=function(c){var f=this;if(this._vm._status!=shine.RUNNING){this._vm._callbackQueue.push(function(){f.execute.apply(f,c)});return}this._pc=0;this._params=shine.gc.createArray().concat(c);this._register.set(c.splice(0,this._data.paramCount));if(this._data.is_vararg==7){var b=[].concat(c),d=b.length;b=new shine.Table(b);b.setMember("n",d);this._register.push(b)}try{return this._run()}catch(g){if(!((g||shine.EMPTY_OBJ) instanceof shine.Error)){var a=(g.stack||"");g=new shine.Error("Error in host call: "+g.message);g.stack=a;g.luaStack=a.split("\n")}if(!g.luaStack){g.luaStack=shine.gc.createArray()}g.luaStack.push([this,this._pc-1]);throw g}};shine.Closure.prototype._run=function(){var d,p,e,m;this.terminated=false;if(this._vm._status==shine.RESUMING){if(this._vm._resumeStack.length){this._pc--}else{this._vm._status=shine.RUNNING;m=this._vm._resumeVars;delete this._vm._resumeVars}}else{if(shine.debug&&shine.debug._status==shine.RESUMING){if(shine.debug._resumeStack.length){this._pc--}else{shine.debug._setStatus(shine.RUNNING)}}else{if(shine.Coroutine._running&&shine.Coroutine._running.status==shine.RESUMING){if(shine.Coroutine._running._resumeStack.length){this._pc--}else{shine.Coroutine._running.status=shine.RUNNING;m=shine.Coroutine._running._yieldVars}}}}if(m){var g=(this._pc-1)*4,o=this._instructions[g+1],n=this._instructions[g+2],k=this._instructions[g+3],j=shine.gc.createArray();for(var h=0,f=m.length;h<f;h++){j.push(m[h])}if(k===0){f=j.length;for(h=0;h<f;h++){this._register.setItem(o+h,j[h])}this._register.splice(o+f)}else{for(h=0;h<k-1;h++){this._register.setItem(o+h,j[h])}}shine.gc.collect(j)}while(this._instructions[this._pc*4]!==undefined){p=this._data.linePositions&&this._data.linePositions[this._pc];e=this._executeInstruction(this._pc++,p);if(shine.Coroutine._running&&shine.Coroutine._running.status==shine.SUSPENDING){shine.Coroutine._running._resumeStack.push(this);if(shine.Coroutine._running._func._instance==this){e=shine.Coroutine._running._yieldVars;shine.Coroutine._running.status=shine.SUSPENDED;shine.Coroutine._remove();return e}return}if(this._vm._status==shine.SUSPENDING&&!e){this._vm._resumeStack.push(this);return}if(shine.debug&&shine.debug._status==shine.SUSPENDING&&!e){shine.debug._resumeStack.push(this);return}if(e!==undefined){this.terminated=true;this.dispose();return e}}this.terminated=true;this.dispose()};shine.Closure.prototype._executeInstruction=function(c,b){this.constructor._current=this;var f=c*4,d=this._instructions[f],h=this.constructor.OPERATIONS[d],a=this._instructions[f+1],g=this._instructions[f+2],e=this._instructions[f+3];return h.call(this,a,g,e)};shine.Closure.prototype._getConstant=function(a){if(this._constants[a]===null){return}return this._constants[a]};shine.Closure.prototype.hasRetainedScope=function(){if(this._localsUsedAsUpvalues.length){return true}if(this._upvalues.length){return true}for(var a in this._funcInstances){if(this._funcInstances.hasOwnProperty(a)&&this._funcInstances[a].isRetained()){return true}}return false};shine.Closure.prototype.dispose=function(a){if(a||!this.hasRetainedScope()){delete this._vm;delete this._globals;delete this._file;delete this._data;delete this._functions;delete this._instructions;delete this._pc;shine.gc.collect(this._params);shine.gc.collect(this._localFunctions);delete this._params;delete this._constants;delete this._upvalues;this._register.reset();this._funcInstances.length=0;this._localsUsedAsUpvalues.length=0;shine.Closure._graveyard.push(this)}};(function(){function m(N,M){var Q=this._register.getItem(M),P,O;this._register.setItem(N,Q);if(this._data.locals&&Q&&Q instanceof shine.Function){for(O=this._data.locals.length-1;O>=0;O--){P=this._data.locals[O];if(P.startpc==this._pc-1){this._localFunctions[P.varname]=Q}}}}function b(M,N){this._register.setItem(M,this._getConstant(N))}function q(N,M,O){this._register.setItem(N,!!M);if(O){this._pc++}}function I(N,M){for(var O=N;O<=M;O++){this._register.setItem(O,undefined)}}function B(N,M){if(this._upvalues[M]===undefined){return}this._register.setItem(N,this._upvalues[M].getValue())}function i(O,N){var M;if(this._getConstant(N)=="_G"){M=new shine.Table(this._globals)}else{if(this._globals[this._getConstant(N)]!==undefined){M=this._globals[this._getConstant(N)]}}this._register.setItem(O,M)}function x(O,N,R){var M,Q,P;N=this._register.getItem(N);R=(R>=256)?this._getConstant(R-256):this._register.getItem(R);if(N===undefined){throw new shine.Error("Attempt to index a nil value ("+R+" not present in nil)")}if(N instanceof shine.Table){M=N.getMember(R)}else{if(typeof N=="string"&&shine.lib.string[R]){M=shine.lib.string[R]}else{M=N[R]}}this._register.setItem(O,M);if(M&&M instanceof shine.Function){this._localFunctions[R]=M}}function l(N,M){var Q=this._getConstant(M),O=this._globals[Q],P=this._register.getItem(N);shine.gc.incrRef(P);shine.gc.decrRef(O);this._globals[Q]=P}function z(N,M){this._upvalues[M].setValue(this._register.getItem(N))}function v(N,M,O){N=this._register.getItem(N);M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);O=(O>=256)?this._getConstant(O-256):this._register.getItem(O);if(N===undefined){throw new shine.Error("Attempt to index a missing field (can't set \""+M+'" on a nil value)')}if(N instanceof shine.Table){N.setMember(M,O)}else{N[M]=O}}function D(N,M,P){var O=new shine.Table();O.__shine.refCount=0;this._register.setItem(N,O)}function k(O,N,P){var M;N=this._register.getItem(N);P=(P>=256)?this._getConstant(P-256):this._register.getItem(P);this._register.setItem(O+1,N);if(N===undefined){throw new shine.Error("Attempt to index a nil value ("+P+" not present in nil)")}if(N instanceof shine.Table){M=N.getMember(P)}else{if(typeof N=="string"&&shine.lib.string[P]){M=shine.lib.string[P]}else{M=N[P]}}this._register.setItem(O,M)}function g(N,M,T){M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);T=(T>=256)?this._getConstant(T-256):this._register.getItem(T);var P=shine.utils.coerce,O,Q,R,S;if(((M||shine.EMPTY_OBJ) instanceof shine.Table&&(O=M.__shine.metatable)&&(Q=O.getMember("__add")))||((T||shine.EMPTY_OBJ) instanceof shine.Table&&(O=T.__shine.metatable)&&(Q=O.getMember("__add")))){this._register.setItem(N,Q.apply(null,[M,T],true)[0])}else{M=P(M,"number","attempt to perform arithmetic on a non-numeric value");T=P(T,"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,M+T)}}function r(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);R=(R>=256)?this._getConstant(R-256):this._register.getItem(R);var P=shine.utils.coerce,O,Q;if(((M||shine.EMPTY_OBJ) instanceof shine.Table&&(O=M.__shine.metatable)&&(Q=O.getMember("__sub")))||((R||shine.EMPTY_OBJ) instanceof shine.Table&&(O=R.__shine.metatable)&&(Q=O.getMember("__sub")))){this._register.setItem(N,Q.apply(null,[M,R],true)[0])}else{M=P(M,"number","attempt to perform arithmetic on a non-numeric value");R=P(R,"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,M-R)}}function d(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);R=(R>=256)?this._getConstant(R-256):this._register.getItem(R);var P=shine.utils.coerce,O,Q;if(((M||shine.EMPTY_OBJ) instanceof shine.Table&&(O=M.__shine.metatable)&&(Q=O.getMember("__mul")))||((R||shine.EMPTY_OBJ) instanceof shine.Table&&(O=R.__shine.metatable)&&(Q=O.getMember("__mul")))){this._register.setItem(N,Q.apply(null,[M,R],true)[0])}else{M=P(M,"number","attempt to perform arithmetic on a non-numeric value");R=P(R,"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,M*R)}}function H(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);R=(R>=256)?this._getConstant(R-256):this._register.getItem(R);var P=shine.utils.coerce,O,Q;if(((M||shine.EMPTY_OBJ) instanceof shine.Table&&(O=M.__shine.metatable)&&(Q=O.getMember("__div")))||((R||shine.EMPTY_OBJ) instanceof shine.Table&&(O=R.__shine.metatable)&&(Q=O.getMember("__div")))){this._register.setItem(N,Q.apply(null,[M,R],true)[0])}else{M=P(M,"number","attempt to perform arithmetic on a non-numeric value");R=P(R,"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,M/R)}}function h(O,N,T){N=(N>=256)?this._getConstant(N-256):this._register.getItem(N);T=(T>=256)?this._getConstant(T-256):this._register.getItem(T);var Q=shine.utils.coerce,P,S,M,R;if(((N||shine.EMPTY_OBJ) instanceof shine.Table&&(P=N.__shine.metatable)&&(S=P.getMember("__mod")))||((T||shine.EMPTY_OBJ) instanceof shine.Table&&(P=T.__shine.metatable)&&(S=P.getMember("__mod")))){this._register.setItem(O,S.apply(null,[N,T],true)[0])}else{N=Q(N,"number","attempt to perform arithmetic on a non-numeric value");T=Q(T,"number","attempt to perform arithmetic on a non-numeric value");if(T===0||T===-Infinity||T===Infinity||window.isNaN(N)||window.isNaN(T)){M=NaN}else{M=Math.abs(N)%(R=Math.abs(T));if(N*T<0){M=R-M}if(T<0){M*=-1}}this._register.setItem(O,M)}}function w(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);R=(R>=256)?this._getConstant(R-256):this._register.getItem(R);var P=shine.utils.coerce,O,Q;if(((M||shine.EMPTY_OBJ) instanceof shine.Table&&(O=M.__shine.metatable)&&(Q=O.getMember("__pow")))||((R||shine.EMPTY_OBJ) instanceof shine.Table&&(O=R.__shine.metatable)&&(Q=O.getMember("__pow")))){this._register.setItem(N,Q.apply(null,[M,R],true)[0])}else{M=P(M,"number","attempt to perform arithmetic on a non-numeric value");R=P(R,"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,Math.pow(M,R))}}function o(N,M){var O,P;if((this._register.getItem(M)||shine.EMPTY_OBJ) instanceof shine.Table&&(O=this._register.getItem(M).__shine.metatable)&&(P=O.getMember("__unm"))){this._register.setItem(N,P.apply(null,[this._register.getItem(M)],true)[0])}else{M=shine.utils.coerce(this._register.getItem(M),"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,-M)}}function F(N,M){this._register.setItem(N,!this._register.getItem(M))}function n(N,M){var P=0;if((this._register.getItem(M)||shine.EMPTY_OBJ) instanceof shine.Table){this._register.setItem(N,shine.lib.table.getn(this._register.getItem(M)))}else{if(typeof this._register.getItem(M)=="object"){for(var O in this._register.getItem(M)){if(this._register.getItem(M).hasOwnProperty(O)){P++}}this._register.setItem(N,P)}else{if(this._register.getItem(M)==undefined){throw new shine.Error("attempt to get length of a nil value")}else{if(this._register.getItem(M).length===undefined){this._register.setItem(N,undefined)}else{this._register.setItem(N,this._register.getItem(M).length)}}}}}function u(S,R,Q){var T=this._register.getItem(Q),N,U,M,O,P;for(N=Q-1;N>=R;N--){U=this._register.getItem(N);if((U!==undefined&&U instanceof shine.Table&&(M=U.__shine.metatable)&&(O=M.getMember("__concat")))||(T!==undefined&&T instanceof shine.Table&&(M=T.__shine.metatable)&&(O=M.getMember("__concat")))){P=shine.gc.createArray();P.push(U,T);T=O.apply(null,P,true)[0]}else{if(!(typeof U==="string"||typeof U==="number")||!(typeof T==="string"||typeof T==="number")){throw new shine.Error("Attempt to concatenate a non-string or non-numeric value")}T=U+T}}this._register.setItem(S,T)}function J(N,M){this._pc+=M}function G(O,N,S){N=(N>=256)?this._getConstant(N-256):this._register.getItem(N);S=(S>=256)?this._getConstant(S-256):this._register.getItem(S);var Q,P,R,M;if(N!==S&&(N||shine.EMPTY_OBJ) instanceof shine.Table&&(S||shine.EMPTY_OBJ) instanceof shine.Table&&(Q=N.__shine.metatable)&&(P=S.__shine.metatable)&&Q===P&&(R=Q.getMember("__eq"))){M=!!R.apply(null,[N,S],true)[0]}else{M=(N===S)}if(M!=O){this._pc++}}function t(T,S,Q){S=(S>=256)?this._getConstant(S-256):this._register.getItem(S);Q=(Q>=256)?this._getConstant(Q-256):this._register.getItem(Q);var R=(typeof S!="object"&&typeof S)||((S||shine.EMPTY_OBJ) instanceof shine.Table&&"table")||"userdata",P=(typeof Q!="object"&&typeof S)||((Q||shine.EMPTY_OBJ) instanceof shine.Table&&"table")||"userdata",O,U,N,M;if(R!==P){throw new shine.Error("attempt to compare "+R+" with "+P)}else{if(R=="table"){if((N=S.__shine.metatable)&&(M=Q.__shine.metatable)&&N===M&&(O=N.getMember("__lt"))){U=O.apply(null,[S,Q],true)[0]}else{throw new shine.Error("attempt to compare two table values")}}else{U=(S<Q)}}if(U!=T){this._pc++}}function C(T,S,Q){S=(S>=256)?this._getConstant(S-256):this._register.getItem(S);Q=(Q>=256)?this._getConstant(Q-256):this._register.getItem(Q);var R=(typeof S!="object"&&typeof S)||((S||shine.EMPTY_OBJ) instanceof shine.Table&&"table")||"userdata",P=(typeof Q!="object"&&typeof S)||((Q||shine.EMPTY_OBJ) instanceof shine.Table&&"table")||"userdata",O,U,N,M;if(R!==P){throw new shine.Error("attempt to compare "+R+" with "+P)}else{if(R=="table"){if((N=S.__shine.metatable)&&(M=Q.__shine.metatable)&&N===M&&(O=N.getMember("__le"))){U=O.apply(null,[S,Q],true)[0]}else{throw new shine.Error("attempt to compare two table values")}}else{U=(S<=Q)}}if(U!=T){this._pc++}}function j(N,M,O){N=this._register.getItem(N);if(shine.utils.coerce(N,"boolean")!==!!O){this._pc++}}function e(N,M,O){M=this._register.getItem(M);if(shine.utils.coerce(M,"boolean")===!!O){this._register.setItem(N,M)}else{this._pc++}}function c(W,V,U){var T=shine.gc.createArray(),Q,O,R,P,S,N,M;if(this._vm._status==shine.RESUMING){P=this._vm._resumeStack.pop()}else{if(shine.debug&&shine.debug._status==shine.RESUMING){P=shine.debug._resumeStack.pop()}}if(P){if(P instanceof shine.Coroutine){R=P.resume();if(R){R.shift()}}else{if(P instanceof shine.Closure){R=P._run()}else{R=P()}}}else{if(shine.Coroutine._running&&shine.Coroutine._running.status==shine.RESUMING){P=shine.Coroutine._running._resumeStack.pop();R=P._run()}else{if(V===0){O=this._register.getLength();for(Q=W+1;Q<O;Q++){T.push(this._register.getItem(Q))}}else{for(Q=0;Q<V-1;Q++){T.push(this._register.getItem(W+Q+1))}}}}if(!P){N=this._register.getItem(W);if((N||shine.EMPTY_OBJ) instanceof shine.Function){R=N.apply(null,T,true)}else{if(N&&N.apply){R=N.apply(null,T)}else{if(N&&(N||shine.EMPTY_OBJ) instanceof shine.Table&&(M=N.__shine.metatable)&&(S=M.getMember("__call"))&&S.apply){T.unshift(N);R=S.apply(null,T,true)}else{throw new shine.Error("Attempt to call non-function")}}}}shine.gc.collect(T);if(this._vm._status==shine.SUSPENDING){if(R!==undefined&&this._vm._resumeVars===undefined){this._vm._resumeVars=(R instanceof Array)?R:[R]}return}if(!(R&&R instanceof Array)){R=[R]}if(shine.Coroutine._running&&shine.Coroutine._running.status==shine.SUSPENDING){return}if(U===0){O=R.length;for(Q=0;Q<O;Q++){this._register.setItem(W+Q,(N=R[Q])==null?undefined:N)}this._register.splice(W+O)}else{for(Q=0;Q<U-1;Q++){this._register.setItem(W+Q,(N=R[Q])==null?undefined:N)}}}function L(N,M){return c.call(this,N,M,0)}function y(O,M){var P=shine.gc.createArray(),R,Q,N;if(M===0){N=this._register.getLength();for(Q=O;Q<N;Q++){P.push(this._register.getItem(Q))}}else{for(Q=0;Q<M-1;Q++){P.push(R=this._register.getItem(O+Q));shine.gc.incrRef(R)}}E.call(this,0);this.dead=true;return P}function p(N,M){this._register.setItem(N,this._register.getItem(N)+this._register.getItem(N+2));var O=this._register.getItem(N+2)/Math.abs(this._register.getItem(N+2));if((O===1&&this._register.getItem(N)<=this._register.getItem(N+1))||(O!==1&&this._register.getItem(N)>=this._register.getItem(N+1))){this._register.setItem(N+3,this._register.getItem(N));this._pc+=M}}function K(N,M){this._register.setItem(N,this._register.getItem(N)-this._register.getItem(N+2));this._pc+=M}function s(N,M,S){var Q=[this._register.getItem(N+1),this._register.getItem(N+2)],O=this._register.getItem(N).apply(null,Q),P;if(!((O||shine.EMPTY_OBJ) instanceof Array)){O=[O]}if(O[0]&&O[0]===""+(P=parseInt(O[0],10))){O[0]=P}for(var R=0;R<S;R++){this._register.setItem(N+R+3,O[R])}if(this._register.getItem(N+3)!==undefined){this._register.setItem(N+2,this._register.getItem(N+3))}else{this._pc++}}function f(N,M,Q){var P=M||this._register.getLength()-N-1,O;for(O=0;O<P;O++){this._register.getItem(N).setMember(50*(Q-1)+O+1,this._register.getItem(N+O+1))}}function E(O,M,R){for(var Q=0,N=this._localsUsedAsUpvalues.length;Q<N;Q++){var P=this._localsUsedAsUpvalues[Q];if(P&&P.registerIndex>=O){P.upvalue.value=this._register.getItem(P.registerIndex);P.upvalue.open=false;this._localsUsedAsUpvalues.splice(Q--,1);N--;this._register.clearItem(P.registerIndex)}}}function a(M,Q){var O=this,R=shine.gc.createArray(),P;while((P=this._instructions[this._pc*4])!==undefined&&(P===0||P===4)&&this._instructions[this._pc*4+1]===0){(function(){var Z=P,W=O._pc*4,U=O._instructions[W+1],T=O._instructions[W+2],S=O._instructions[W+3],aa;if(Z===0){for(var X=0,V=O._localsUsedAsUpvalues.length;X<V;X++){var Y=O._localsUsedAsUpvalues[X];if(Y.registerIndex===T){aa=Y.upvalue;break}}if(!aa){aa={open:true,getValue:function(){return this.open?O._register.getItem(T):this.value},setValue:function(ab){if(this.open){O._register.setItem(T,ab)}else{shine.gc.incrRef(ab);shine.gc.decrRef(this.value);this.value=ab}},name:O._functions[Q].upvalues?O._functions[Q].upvalues[R.length]:"(upvalue)"};O._localsUsedAsUpvalues.push({registerIndex:T,upvalue:aa})}R.push(aa)}else{R.push({getValue:function(){return O._upvalues[T].getValue()},setValue:function(ab){O._upvalues[T].setValue(ab)},name:O._upvalues[T].name})}})();this._pc++}var N=new shine.Function(this._vm,this._file,this._functions[Q],this._globals,R);this._register.setItem(M,N)}function A(P,M){var Q,O,N=M===0?this._params.length-this._data.paramCount:M-1;for(Q=0;Q<N;Q++){this._register.setItem(P+Q,this._params[this._data.paramCount+Q])}for(Q=P+N,O=this._register.getLength();Q<O;Q++){this._register.clearItem(Q)}}shine.Closure.OPERATIONS=[m,b,q,I,B,i,x,l,z,v,D,k,g,r,d,H,h,w,o,F,n,u,J,G,t,C,j,e,c,L,y,p,K,s,f,E,a,A];shine.Closure.OPERATION_NAMES=["move","loadk","loadbool","loadnil","getupval","getglobal","gettable","setglobal","setupval","settable","newtable","self","add","sub","mul","div","mod","pow","unm","not","len","concat","jmp","eq","lt","le","test","testset","call","tailcall","return","forloop","forprep","tforloop","setlist","close","closure","vararg"]})();"use strict";var shine=shine||{};shine.Function=function(b,a,d,c,e){this._vm=b;this._file=a;this._data=d||shine.gc.createObject();this._globals=c;this._upvalues=e||shine.gc.createObject();this._index=shine.Function._index++;this.instances=shine.gc.createArray();this._retainCount=0;this._convertInstructions()};shine.Function.prototype={};shine.Function.prototype.constructor=shine.Function;shine.Function._index=0;shine.Function.prototype.getInstance=function(){return shine.Closure.create(this._vm,this._file,this._data,this._globals,this._upvalues)};shine.Function.prototype._convertInstructions=function(){var c=this._data.instructions||shine.gc.createArray(),e,b,f,d,a,g;if("ArrayBuffer" in window){if(c instanceof Int32Array){return}if(c.length==0||c[0].op===undefined){e=new ArrayBuffer(c.length*4);b=new Int32Array(e);b.set(c);this._data.instructions=b;return}e=new ArrayBuffer(c.length*4*4);b=new Int32Array(e)}else{if(c.length==0||typeof c[0]=="number"){return}b=[]}for(f=0,d=c.length;f<d;f++){a=c[f];g=f*4;b[g]=a.op;b[g+1]=a.A;b[g+2]=a.B;b[g+3]=a.C}this._data.instructions=b};shine.Function.prototype.call=function(){var b=shine.gc.createArray(),a=arguments.length,c;for(c=1;c<a;c++){b.push(arguments[c])}return this.apply(b)};shine.Function.prototype.apply=function(d,b,a){if((d||shine.EMPTY_OBJ) instanceof Array&&!b){b=d;d=undefined}try{return this.getInstance().apply(d,b)}catch(c){shine.Error.catchExecutionError(c)}};shine.Function.prototype.toString=function(){return"function: 0x"+this._index.toString(16)};shine.Function.prototype.retain=function(){this._retainCount++};shine.Function.prototype.release=function(){if(!--this._retainCount&&this._readyToDispose){this.dispose()}};shine.Function.prototype.isRetained=function(){if(this._retainCount){return true}for(var a in this.instances){if(this.instances.hasOwnProperty(a)&&this.instances[a].hasRetainedScope()){return true}}return false};shine.Function.prototype.dispose=function(c){this._readyToDispose=true;if(c){for(var b=0,a=this.instances.length;b<a;b++){this.instances[b].dispose(true)}}else{if(this.isRetained()){return false}}delete this._vm;delete this._file;delete this._data;delete this._globals;delete this._upvalues;delete this.instances;delete this._readyToDispose;return true};"use strict";var shine=shine||{};shine.Coroutine=function(a){shine.EventEmitter.call(this);this._func=a.getInstance();this._index=shine.Coroutine._index++;this._started=false;this._yieldVars=undefined;this._resumeStack=this._resumeStack||shine.gc.createArray();this.status=shine.SUSPENDED;shine.stddebug.write("[coroutine created]\n")};shine.Coroutine.prototype=new shine.EventEmitter();shine.Coroutine.prototype.constructor=shine.Function;shine.Coroutine._index=0;shine.Coroutine._stack=[];shine.Coroutine._graveyard=[];shine.Coroutine.create=function(b){var a=shine.Coroutine._graveyard.pop();if(a){shine.Coroutine.apply(a,arguments);return a}else{return new shine.Coroutine(b)}};shine.Coroutine._add=function(a){shine.Coroutine._stack.push(shine.Coroutine._running);shine.Coroutine._running=a};shine.Coroutine._remove=function(){shine.Coroutine._running=shine.Coroutine._stack.pop()};shine.Coroutine.prototype.resume=function(){var b,h,f=this._func._instance._vm;try{if(this.status==shine.DEAD){throw new shine.Error("cannot resume dead coroutine")}shine.Coroutine._add(this);if(f&&f._status==shine.RESUMING){h=f._resumeStack.pop()}else{if(shine.debug&&shine.debug._status==shine.RESUMING){h=shine.debug._resumeStack.pop()}}if(h){if(h instanceof shine.Coroutine){b=h.resume()}else{if(h instanceof Function){b=h()}else{b=this._func._instance._run()}}}else{if(!this._started){this.status=shine.RUNNING;shine.stddebug.write("[coroutine started]\n");this._started=true;b=this._func.apply(null,arguments)}else{this.status=shine.RESUMING;shine.stddebug.write("[coroutine resuming]\n");if(!arguments.length){this._yieldVars=undefined}else{var c=shine.gc.createArray();for(var d=0,a=arguments.length;d<a;d++){c.push(arguments[d])}this._yieldVars=c}b=this._resumeStack.pop()._run()}}if(shine.debug&&shine.debug._status==shine.SUSPENDING){shine.debug._resumeStack.push(this);return}this.status=this._func._instance.terminated?shine.DEAD:shine.SUSPENDED;if(b){b.unshift(true)}}catch(g){if(!g.luaStack){g.luaStack=shine.gc.createArray()}g.luaStack.push([this._func._instance,this._func._instance._pc-1]);b=[false,g];this.status=shine.DEAD}if(this.status==shine.DEAD){shine.Coroutine._remove();shine.stddebug.write("[coroutine terminated]\n");this._dispose()}return b};shine.Coroutine.prototype.toString=function(){return"thread:"+(this._index?"0x"+this._index.toString(16):"[dead]")};shine.Coroutine.prototype._dispose=function(){delete this._func;delete this._index;delete this._listeners;delete this._started;delete this._yieldVars;delete this.status;this._resumeStack.length=0;shine.Coroutine._graveyard.push(this)};"use strict";var shine=shine||{};shine.Table=function(g){var d=((g||shine.EMPTY_OBJ) instanceof Array),f,c,e,b;g=g||shine.gc.createObject();this.__shine=f=shine.gc.createObject();f.type="table";f.index=++shine.Table.count;f.keys=shine.gc.createArray();f.values=shine.gc.createArray();f.numValues=[undefined];for(b in g){if(g.hasOwnProperty(b)){var a;c=d?parseInt(b,10)+1:b;e=g[b];if(typeof getQualifiedClassName!=="undefined"){a=(getQualifiedClassName(e)=="Object"&&!(e instanceof shine.Table)&&!(e instanceof shine.Coroutine)&&!(e instanceof shine.Function)&&!(e instanceof shine.Closure))||getQualifiedClassName(e)=="Array"}else{a=(typeof e=="object"&&e.constructor===Object)||e instanceof Array}this.setMember(c,a?new shine.Table(e):e)}}};shine.Table.count=0;shine.Table.prototype.getMember=function(c){var d=typeof c,b,e,a,f;if(d=="string"&&(c=="getMember"||c=="setMember")){d="object"}switch(d){case"string":if(this.hasOwnProperty(c)&&this[c]!==undefined){return this[c]}break;case"number":e=this.__shine.numValues[c];if(e!==undefined){return e}break;default:b=this.__shine.keys.indexOf(c);if(b>=0){return this.__shine.values[b]}}if((a=this.__shine.metatable)&&(f=a.__index)){switch(f.constructor){case shine.Table:return f.getMember(c);case Function:return f(this,c);case shine.Function:return f.apply(this,[this,c])[0]}}};shine.Table.prototype.setMember=function(d,g){var a=this.__shine.metatable,f=typeof d,c,e,b;if(f=="string"&&(d=="getMember"||d=="setMember")){f="object"}switch(f){case"string":c=this[d];break;case"number":c=this.__shine.numValues[d];break;default:e=this.__shine.keys;b=e.indexOf(d);c=b==-1?undefined:this.__shine.values[b]}if(c===undefined&&a&&a.__newindex){switch(a.__newindex.constructor){case shine.Table:return a.__newindex.setMember(d,g);case Function:return a.__newindex(this,d,g);case shine.Function:return a.__newindex.apply(this,[this,d,g])[0]}}switch(f){case"string":this[d]=g;break;case"number":this.__shine.numValues[d]=g;break;default:if(b<0){b=e.length;e[b]=d}this.__shine.values[b]=g}shine.gc.incrRef(g);shine.gc.decrRef(c)};shine.Table.prototype.toString=function(){var a;if(this.constructor!=shine.Table){return"userdata"}if(this.__shine&&(a=this.__shine.metatable)&&a.__tostring){return a.__tostring.call(undefined,this)[0]}return"table: 0x"+this.__shine.index.toString(16)};"use strict";var shine=shine||{};shine.Error=function(a){this.message=a};shine.Error.prototype=Object.create?Object.create(Error.prototype):new Error();shine.Error.prototype.constructor=shine.Error;shine.Error.catchExecutionError=function(a){if(!a){return}if((a||shine.EMPTY_OBJ) instanceof shine.Error){if(!a.luaMessage){a.luaMessage=a.message}a.message=a.luaMessage+"\n    "+a._stackToString()}throw a};shine.Error.prototype._stackToString=function(){var n=[],f,h,g,k,e,a,m,d,c,b;this.luaStack=this.luaStack||[];for(d=0,b=this.luaStack.length;d<b;d++){if(this.luaStack[d-1]&&this.luaStack[d][0]===this.luaStack[d-1][0]&&this.luaStack[d][1]===this.luaStack[d-1][1]){continue}if(typeof this.luaStack[d]=="string"){n.push(this.luaStack[d])}else{f=this.luaStack[d][0];h=this.luaStack[d][1];if(!(g=f._data.sourceName)){if(k=this.luaStack[d+1]&&this.luaStack[d+1][0]){for(c in k._localFunctions){if(k._localFunctions[c]._data===f._data){g=c;break}}if(!g){for(c in k._upvalues){e=k._upvalues[c].getValue();if((e||shine.EMPTY_OBJ) instanceof shine.Function&&e._data===f._data){g=k._upvalues[c].name;break}}}}if(!g){for(c in f._globals){if((f._globals[c]||shine.EMPTY_OBJ) instanceof shine.Function&&f._globals[c]._data===f._data){g=c;break}}}}if(a=f._file.data.sourcePath){a=f._file.url.match("^(.*)/.*?$")[1]+"/"+a;a=a.replace(/\/\.\//g,"/").replace(/\/.*?\/\.\.\//g,"/")}else{a=f._file.url}n.push((g||"function")+" ["+(a||"file")+":"+(f._data.linePositions?f._data.linePositions[h]:"?")+"]")}}return n.join("\n    ")};shine.Error.prototype.toString=function(){return"Moonshine Error: "+this.message};"use strict";var shine=shine||{};shine.File=function(a,b){this.url=a;this.data=b};shine.File.prototype.dispose=function(){delete this.url;delete this.data};"use strict";var shine=shine||{};(function(){var k=16807,c=2147483647,f={"([^a-zA-Z0-9%(])-":"$1*?","(.)-([^a-zA-Z0-9?])":"$1*?$2","(.)-$":"$1*?","%a":"[a-zA-Z]","%A":"[^a-zA-Z]","%c":"[\x00-\x1f]","%C":"[^\x00-\x1f]","%d":"\\d","%D":"[^\d]","%l":"[a-z]","%L":"[^a-z]","%p":"[.,\"'?!;:#$%&()*+-/<>=@[]\\^_{}|~]","%P":"[^.,\"'?!;:#$%&()*+-/<>=@[]\\^_{}|~]","%s":"[ \\t\\n\\f\\v\\r]","%S":"[^ \t\n\f\v\r]","%u":"[A-Z]","%U":"[^A-Z]","%w":"[a-zA-Z0-9]","%W":"[^a-zA-Z0-9]","%x":"[a-fA-F0-9]","%X":"[^a-fA-F0-9]","%([^a-zA-Z])":"\\$1"},j=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b=["January","February","March","April","May","June","July","August","September","October","November","December"],d=[31,28,31,30,31,30,31,31,30,31,30,31],g={"%a":function(n,m){return j[n["get"+(m?"UTC":"")+"Day"]()].substr(0,3)},"%A":function(n,m){return j[n["get"+(m?"UTC":"")+"Day"]()]},"%b":function(n,m){return b[n["get"+(m?"UTC":"")+"Month"]()].substr(0,3)},"%B":function(n,m){return b[n["get"+(m?"UTC":"")+"Month"]()]},"%c":function(n,m){return n["to"+(m?"UTC":"")+"LocaleString"]()},"%d":function(n,m){return("0"+n["get"+(m?"UTC":"")+"Date"]()).substr(-2)},"%H":function(n,m){return("0"+n["get"+(m?"UTC":"")+"Hours"]()).substr(-2)},"%I":function(n,m){return("0"+((n["get"+(m?"UTC":"")+"Hours"]()+11)%12+1)).substr(-2)},"%j":function(r,q){var o=r["get"+(q?"UTC":"")+"Date"](),n=r["get"+(q?"UTC":"")+"Month"]();for(var p=0;p<n;p++){o+=d[p]}if(n>1&&r["get"+(q?"UTC":"")+"FullYear"]()%4===0){o+=1}return("00"+o).substr(-3)},"%m":function(n,m){return("0"+(n["get"+(m?"UTC":"")+"Month"]()+1)).substr(-2)},"%M":function(n,m){return("0"+n["get"+(m?"UTC":"")+"Minutes"]()).substr(-2)},"%p":function(n,m){return(n["get"+(m?"UTC":"")+"Hours"]()<12)?"AM":"PM"},"%S":function(n,m){return("0"+n["get"+(m?"UTC":"")+"Seconds"]()).substr(-2)},"%U":function(n,m){return e(n,0,m)},"%w":function(n,m){return""+(n["get"+(m?"UTC":"")+"Day"]())},"%W":function(n,m){return e(n,1,m)},"%x":function(n,m){return g["%m"](n,m)+"/"+g["%d"](n,m)+"/"+g["%y"](n,m)},"%X":function(n,m){return g["%H"](n,m)+":"+g["%M"](n,m)+":"+g["%S"](n,m)},"%y":function(n,m){return g["%Y"](n,m).substr(-2)},"%Y":function(n,m){return""+n["get"+(m?"UTC":"")+"FullYear"]()},"%Z":function(p,o){var n;return(o&&"UTC")||((n=p.toString().match(/[A-Z][A-Z][A-Z]/))&&n[0])},"%%":function(){return"%"}},i=1;function h(){i=(k*i)%c;return i/c}function e(r,m,p){var o=parseInt(g["%j"](r),10),n=new Date(r.getFullYear(),0,1,12),q=(8-n["get"+(p?"UTC":"")+"Day"]()+m)%7;return("0"+(Math.floor((o-q)/7)+1)).substr(-2)}function l(r){r=""+r;var s=0,p,m,q,o;for(p in f){if(f.hasOwnProperty(p)){r=r.replace(new RegExp(p,"g"),f[p])}}m=r.length;for(p=0;p<m;p++){q=r.substr(p,1);o=false;if(q=="["){if(s){o=true}s++}else{if(q=="]"){s--;if(s){o=true}}}if(o){r=r.substr(0,p)+"\\"+r.substr(p++);m++}}return r}function a(m,q){var o=this,n,p;this.fileManager.load(m,function(t,r){if(t){o._trigger("module-load-error",r,t);if(t==404&&/\.lua$/.test(m)){a.call(o,m+".json",q)}else{q()}return}var s=new shine.Function(o,r,r.data,o._globals);o._trigger("module-loaded",r,s);q(s)});this._trigger("loading-module",m)}shine.lib={assert:function(o,n){if(o===false||o===undefined){throw new shine.Error(n||"Assertion failed!")}return[o,n]},collectgarbage:function(n,m){},dofile:function(m){},error:function(m){throw new shine.Error(m)},getfenv:function(m){},getmetatable:function(n){var m;if(!((n||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in getmetatable(). Table expected")}if((m=n.__shine.metatable)&&(m=m.__metatable)){return m}return n.__shine.metatable},ipairs:function(n){if(!((n||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in ipairs(). Table expected")}var m=function(q,p){if(p===undefined){throw new shine.Error("Bad argument #2 to ipairs() iterator")}var o=p+1;if(!q.__shine.numValues.hasOwnProperty(o)){return undefined}return[o,q.__shine.numValues[o]]};return[m,n,0]},load:function(r,n){var q=this,o="",p,m;while((p=r.apply(r))&&(p=p[0])){o+=(m=p)}return shine.lib.loadstring.call(this,o)},loadfile:function(m){var n=this,o=function(p){n.resume(p||[])};n.suspend();a.call(this,m,o)},loadstring:function(n,m){var o=this;if(typeof n!="string"){throw new shine.Error("bad argument #1 to 'loadstring' (string expected, got "+shine.utils.coerce(n,"string")+")")}if(!n){return new shine.Function(this)}this.suspend();this.fileManager.load(n,function(r,p){if(r){o.resume([]);return}var q=new shine.Function(o,p,p.data,o._globals,shine.gc.createArray());o.resume([q])})},next:function(r,o){var s=(o===undefined),n=r.__shine.numValues,q,m;if(s||typeof o=="number"){for(q=1,m=n.length;q<m;q++){if(!s){if(q===o){s=true}}else{if(n.hasOwnProperty(q)&&n[q]!==undefined){return[q,n[q]]}}}}for(q in r){if(r.hasOwnProperty(q)&&!(q in shine.Table.prototype)&&q!=="__shine"){if(!s){if(q==o){s=true}}else{if(r.hasOwnProperty(q)&&r[q]!==undefined&&(""+q).substr(0,2)!="__"){return[q,r[q]]}}}}for(q in r.__shine.keys){if(r.__shine.keys.hasOwnProperty(q)){var p=r.__shine.keys[q];if(!s){if(p===o){s=true}}else{if(r.__shine.values[q]!==undefined){return[p,r.__shine.values[q]]}}}}return shine.gc.createArray()},pairs:function(m){if(!((m||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in pairs(). Table expected")}return[shine.lib.next,m]},pcall:function(q){var o=shine.gc.createArray(),m;for(var p=1,n=arguments.length;p<n;p++){o.push(arguments[p])}try{if(typeof q=="function"){m=q.apply(null,o)}else{if((q||shine.EMPTY_OBJ) instanceof shine.Function){m=q.apply(null,o,true)}else{throw new shine.Error("Attempt to call non-function")}}}catch(r){return[false,r.message]}if(!((m||shine.EMPTY_OBJ) instanceof Array)){m=[m]}m.unshift(true);return m},print:function(){var n=shine.gc.createArray(),p;for(var o=0,m=arguments.length;o<m;o++){n.push(shine.lib.tostring(arguments[o]))}return shine.stdout.write(n.join("\t"))},rawequal:function(n,m){return(n===m)},rawget:function(n,m){if(!((n||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in rawget(). Table expected")}return n[m]},rawset:function(n,m,o){if(!((n||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in rawset(). Table expected")}if(m==undefined){throw new shine.Error("Bad argument #2 in rawset(). Nil not allowed")}n[m]=o;return n},require:function(q){var r=this._globals["package"],t=shine.Closure._current,n=this,m,u,w,x,p=shine.gc.createArray();function o(y){return function(){return v(y)}}function v(z){var y;if(n._resumeStack.length){y=n._resumeStack.pop()._run()}else{if(shine.debug&&shine.debug._resumeStack.length){y=shine.debug._resumeStack.pop()._run()}else{r.loaded[q]=true;y=z.call(null,q)}}if(n._status==shine.SUSPENDING&&!y){t._pc--;n._resumeStack.push(o(z));return}else{if(shine.debug&&shine.debug._status==shine.SUSPENDING&&!y){t._pc--;shine.debug._resumeStack.push(o(z));return}}if(!y){return}m=y[0];if(m!==undefined){r.loaded.setMember(q,m)}return r.loaded[q]}q=shine.utils.coerce(q,"string");if(m=r.loaded[q]){return m}if(u=r.preload[q]){return v(u)}w=r.path.replace(/;;/g,";").split(";");n.suspend();function s(){x=w.shift();if(!x){throw new shine.Error("module '"+q+"' not found:\n	no field package.preload['"+q+"']\n"+p.join("\n"))}else{x=x.replace(/\?/g,q.replace(/\./g,"/"));a.call(n,x,function(y){if(y){r.preload[q]=y;shine.Closure._current._pc--;n.resume()}else{p.push("	no file '"+x+"'");s()}})}}s()},select:function(o){var n=shine.gc.createArray();if(o=="#"){return arguments.length-1}else{if(o=parseInt(o,10)){for(var p=o,m=arguments.length;p<m;p++){n.push(arguments[p])}return n}else{throw new shine.Error('Bad argument #1 in select(). Number or "#" expected')}}},setmetatable:function(o,n){var m;if(!((o||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in setmetatable(). Table expected")}if(!(n===undefined||(n||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #2 in setmetatable(). Nil or table expected")}if((m=o.__shine.metatable)&&(m=m.__metatable)){throw new shine.Error("cannot change a protected metatable")}shine.gc.incrRef(n);shine.gc.decrRef(o.__shine.metatable);o.__shine.metatable=n;return o},tonumber:function(q,p){var m,n,o;if(q===""){return}p=p||10;if(p<2||p>36){throw new shine.Error("bad argument #2 to tonumber() (base out of range)")}if(p==10&&(q===Infinity||q===-Infinity||(typeof q=="number"&&window.isNaN(q)))){return q}if(p!=10&&q==undefined){throw new shine.Error("bad argument #1 to 'tonumber' (string expected, got nil)")}q=(""+q).replace(/^\s+|\s+$/g,"");if(p==10){return shine.utils.coerce(q,"number")}q=shine.utils.coerce(q,"string");if(p==16&&(m=q.match(/^(\-)?0[xX](.+)$/))){q=(m[1]||"")+m[2]}n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";o=new RegExp("^["+n.substr(0,p)+"]*$","gi");if(!o.test(q)){return}return parseInt(q,p)},tostring:function(n){var m,o;if(n!==undefined&&n instanceof shine.Table&&(m=n.__shine.metatable)&&(o=m.getMember("__tostring"))){return o.call(o,n)}return shine.utils.coerce(n,"string")},type:function(m){var n=typeof m;switch(n){case"undefined":return"nil";case"number":case"string":case"boolean":case"function":return n;case"object":if(m.constructor===shine.Table){return"table"}if((m||shine.EMPTY_OBJ) instanceof shine.Function){return"function"}return"userdata"}},unpack:function(o,n,m){return shine.lib.table.unpack(o,n,m)},_VERSION:"Lua 5.1",xpcall:function(o,n){var m,r,p;try{if(typeof o=="function"){m=o.apply()}else{if((o||shine.EMPTY_OBJ) instanceof shine.Function){m=o.apply(null,undefined,true)}else{p=true}}r=true}catch(q){m=n.apply(null,undefined,true);if(((m||shine.EMPTY_OBJ) instanceof Array)){m=m[0]}r=false}if(p){throw new shine.Error("Attempt to call non-function")}if(!((m||shine.EMPTY_OBJ) instanceof Array)){m=[m]}m.unshift(r);return m}};shine.lib.coroutine={create:function(m){return shine.Coroutine.create(m)},resume:function(m){if(arguments.length<2){return m.resume.call(m)}var o=shine.gc.createArray();for(var p=1,n=arguments.length;p<n;p++){o.push(arguments[p])}return m.resume.apply(m,o)},running:function(){return shine.Coroutine._running},status:function(m){switch(m.status){case shine.RUNNING:return(m===shine.Coroutine._running)?"running":"normal";case shine.SUSPENDED:return"suspended";case shine.DEAD:return"dead"}},wrap:function(p){var o=shine.lib.coroutine.create(p),n=this;var m=function(){var s=[o];for(var t=0,q=arguments.length;t<q;t++){s.push(arguments[t])}var r=shine.lib.coroutine.resume.apply(null,s),u;if(!r&&(n._status==shine.SUSPENDING||(shine.debug&&shine.debug._status==shine.SUSPENDING))){return}u=r.shift();if(u){return r}throw r[0]};m._coroutine=o;return m},yield:function(){if(!shine.Coroutine._running){throw new shine.Error("attempt to yield across metamethod/C-call boundary (not in coroutine)")}if(shine.Coroutine._running.status!=shine.RUNNING){throw new shine.Error("attempt to yield non-running coroutine in host")}var o=shine.gc.createArray(),n=shine.Coroutine._running;for(var p=0,m=arguments.length;p<m;p++){o.push(arguments[p])}n._yieldVars=o;n.status=shine.SUSPENDING;return{resume:function(){var r=[n],s,q=arguments.length,t=function(){shine.lib.coroutine.resume.apply(undefined,r)};if(arguments.length==1&&arguments[0]===undefined){q=0}for(s=0;s<q;s++){r.push(arguments[s])}if(n.status==shine.SUSPENDING){window.setTimeout(t,1)}else{t()}}}}};shine.lib.debug={debug:function(){},getfenv:function(m){},gethook:function(m){},getinfo:function(m,n,o){},getlocal:function(m,o,n){},getmetatable:function(m){},getregistry:function(){},getupvalue:function(n,m){},setfenv:function(m,n){},sethook:function(m,p,n,o){},setlocal:function(m,p,n,o){},setmetatable:function(m,n){},setupvalue:function(n,m,o){},traceback:function(m,n,o){}};shine.lib.io={write:function(){var o,m,n="";for(var o in arguments){if(arguments.hasOwnProperty(o)){var m=arguments[o];if(["string","number"].indexOf(typeof m)==-1){throw new shine.Error("bad argument #"+o+" to 'write' (string expected, got "+typeof m+")")}n+=m}}shine.stdout.write(n)}};shine.lib.math={abs:function(m){return Math.abs(m)},acos:function(m){return Math.acos(m)},asin:function(m){return Math.asin(m)},atan:function(m){return Math.atan(m)},atan2:function(n,m){return Math.atan2(n,m)},ceil:function(m){return Math.ceil(m)},cos:function(m){return Math.cos(m)},cosh:function(m){},deg:function(m){return m*180/Math.PI},exp:function(m){return Math.exp(m)},floor:function(m){return Math.floor(m)},fmod:function(m,n){return m%n},frexp:function(m,n){},huge:Infinity,ldexp:function(n,o){return n*Math.pow(2,o)},log:function(n,o){var m=Math.log(n);if(o!==undefined){return m/Math.log(o)}return m},log10:function(m){return Math.log(m)/Math.log(10)},max:function(){return Math.max.apply(Math,arguments)},min:function(){return Math.min.apply(Math,arguments)},modf:function(m){var o=Math.floor(m),n=m-o;return[o,n]},pi:Math.PI,pow:function(m,o){var n=shine.utils.coerce;m=n(m,"number","bad argument #1 to 'pow' (number expected)");o=n(o,"number","bad argument #2 to 'pow' (number expected)");return Math.pow(m,o)},rad:function(m){m=shine.utils.coerce(m,"number","bad argument #1 to 'rad' (number expected)");return(Math.PI/180)*m},random:function(n,m){if(n===undefined&&m===undefined){return h()}if(typeof n!=="number"){throw new shine.Error("bad argument #1 to 'random' (number expected)")}if(m===undefined){m=n;n=1}else{if(typeof m!=="number"){throw new shine.Error("bad argument #2 to 'random' (number expected)")}}if(n>m){throw new shine.Error("bad argument #2 to 'random' (interval is empty)")}return Math.floor(h()*(m-n+1)+n)},randomseed:function(m){if(typeof m!=="number"){throw new shine.Error("bad argument #1 to 'randomseed' (number expected)")}i=m},sin:function(m){return Math.sin(m)},sinh:function(m){},sqrt:function(m){return Math.sqrt(m)},tan:function(m){return Math.tan(m)},tanh:function(m){}};shine.lib.os={clock:function(){},date:function(r,q){if(r===undefined){r="%c"}var o,m=new Date();if(q){m.setTime(q*1000)}if(r.substr(0,1)==="!"){r=r.substr(1);o=true}if(r==="*t"){var p=function(u){var t=u.getFullYear(),s=new Date(t,0);return(u.getTimezoneOffset()!==s.getTimezoneOffset())};return new shine.Table({year:parseInt(g["%Y"](m,o),10),month:parseInt(g["%m"](m,o),10),day:parseInt(g["%d"](m,o),10),hour:parseInt(g["%H"](m,o),10),min:parseInt(g["%M"](m,o),10),sec:parseInt(g["%S"](m,o),10),wday:parseInt(g["%w"](m,o),10)+1,yday:parseInt(g["%j"](m,o),10),isdst:p(m,o)})}for(var n in g){if(g.hasOwnProperty(n)&&r.indexOf(n)>=0){r=r.replace(n,g[n](m,o))}}return r},difftime:function(m,n){return m-n},execute:function(){if(arguments.length){throw new shine.Error("shell is not available. You should always check first by calling os.execute with no parameters")}return 0},exit:function(){throw"Execution terminated."},getenv:function(){},remove:function(){},rename:function(){},setlocale:function(){},time:function(r){var t;if(!r){t=Date.now?Date.now():new Date().getTime()}else{var n,s,q,m,o,p;if(!(n=r.getMember("day"))){throw new shine.Error("Field 'day' missing in date table")}if(!(s=r.getMember("month"))){throw new shine.Error("Field 'month' missing in date table")}if(!(q=r.getMember("year"))){throw new shine.Error("Field 'year' missing in date table")}m=r.getMember("hour")||12;o=r.getMember("min")||0;p=r.getMember("sec")||0;if(r.getMember("isdst")){m--}t=new Date(q,s-1,n,m,o,p).getTime()}return Math.floor(t/1000)},tmpname:function(){}};shine.lib["package"]={cpath:undefined,loaded:new shine.Table(),loadlib:function(n,m){},path:"?.lua.json;?.json;modules/?.lua.json;modules/?.json;modules/?/?.lua.json;modules/?/index.lua.json",preload:{},seeall:function(m){}};shine.lib.string={"byte":function(q,p,o){p=p||1;o=o||p;var m=shine.gc.createArray(),r=q.length,n;for(n=p;n<=r&&n<=o;n++){m.push(q.charCodeAt(n-1)||undefined)}return m},"char":function(){var m="";for(var o=0,n=arguments.length;o<n;o++){m+=String.fromCharCode(arguments[o])}return m},dump:function(m){return JSON.stringify(m._data)},find:function(r,t,u,p){if(typeof r!="string"&&typeof r!="number"){throw new shine.Error("bad argument #1 to 'find' (string expected, got "+typeof r+")")}if(typeof t!="string"&&typeof t!="number"){throw new shine.Error("bad argument #2 to 'find' (string expected, got "+typeof t+")")}r=""+r;u=u||1;var o,q,n,m;if(p===undefined||!p){t=l(t);q=new RegExp(t);o=r.substr(u-1).search(q);if(o<0){return}n=r.substr(u-1).match(q);m=[o+u,o+u+n[0].length-1];n.shift();return m.concat(n)}o=r.indexOf(t,u-1);return(o===-1)?undefined:[o+1,o+t.length]},format:function(D){var u=/^(.*?)%(.*)$/,m=/^(%?)([+\-#\ 0]*)(\d*)(\.(\d*))?([cdeEfgGiouqsxX])(.*)$/,w,t="",n,p=[].splice.call(arguments,0),B=2;p.shift();function z(s){var q=s[2],o=parseInt(s[5]);if((""+q).length>5){throw new shine.Error("invalid format (repeated flags)")}if(!o&&o!==0){o=Infinity}return{showSign:q.indexOf("+")>=0,prefix:q.indexOf(" ")>=0,leftAlign:q.indexOf("-")>=0,alternateForm:q.indexOf("#")>=0,zeroPad:q.indexOf("0")>=0,minWidth:parseInt(s[3])||0,hasPrecision:!!s[4],precision:o}}function E(q,o){return Array(o+1).join(q)}function G(o,x,s){var q;if(s.zeroPad&&!s.leftAlign&&(q=s.minWidth-o.length)>0){if(x||s.showSign||s.prefix){q--}o=E("0",q)+o}if(x){o="-"+o}else{if(s.showSign){o="+"+o}else{if(s.prefix){o=" "+o}}}if((q=s.minWidth-o.length)>0){if(s.leftAlign){return o+E(" ",q)}return E(" ",q)+o}return o}function H(o){o=shine.utils.coerce(o,"number","bad argument #"+B+" to 'format' (number expected)");return String.fromCharCode(o)}function F(o){o=shine.utils.coerce(o,"number","bad argument #"+B+" to 'format' (number expected)");var s=z(n),x=o<0,q;o=""+Math.floor(Math.abs(o));if(s.hasPrecision){if(s.precision!==Infinity&&(q=s.precision-o.length)>0){o=E("0",q)+o}s.zeroPad=false}return G(o,x,s)}function C(o){o=shine.utils.coerce(o,"number","bad argument #"+B+" to 'format' (number expected)");var x=z(n),I=o<0,s=o-Math.floor(o),q=x.precision===Infinity?6:x.precision;o=""+Math.floor(Math.abs(o));if(q>0){o+="."+Math.round(s*Math.pow(10,q))}return G(o,I,x)}function A(o,s){o=shine.utils.coerce(o,"number","bad argument #"+B+" to 'format' (number expected)");var I=o<0,s=Math.pow(2,32),x=z(n),q;o=Math.floor(o);if(I){o=s+o}o=o.toString(16);if(x.hasPrecision&&x.precision!==Infinity&&(q=x.precision-o.length)>0){o=E("0",q)+o}if((q=x.minWidth-o.length)>0){if(x.leftAlign){return o+E(" ",q)}return E(" ",q)+o}return o}function y(o){o=shine.utils.coerce(o,"string");return'"'+o.replace(/([\n"])/g,"\\$1")+'"'}function v(o){var s=z(n),q;o=shine.utils.coerce(o,"string");o=o.substr(0,s.precision);if((q=s.minWidth-o.length)>0){if(s.leftAlign){return o+E(" ",q)}else{return E(s.zeroPad?"0":" ",q)+o}}return o}function r(o){o=shine.utils.coerce(o,"number","bad argument #"+B+" to 'format' (number expected)");var J=o<0,x=4,s=Math.pow(2,32),I=z(n),q;o=Math.floor(o);if(J){o=s+o}o=o.toString(16);if(J&&x>2){o=E("f",(x-2)*4)+o}if(I.hasPrecision&&I.precision!==Infinity&&(q=I.precision-o.length)>0){o=E("0",q)+o}if(I.alternateForm){o="0x"+o}I.showSign=I.prefix=false;I.zeroPad=I.zeroPad&&I.hasPrecision;o=G(o,false,I);return o}while(w=(""+D).match(u)){t+=w[1];n=(""+w[2]).match(m);if(n[1]){t+="%"+n[2]+n[3]+(n[4]||"")+n[6]}else{switch(n[6]){case"c":t+=H(p.shift());break;case"d":t+=F(p.shift());break;case"f":t+=C(p.shift());break;case"q":t+=y(p.shift());break;case"o":t+=A(p.shift());break;case"s":t+=v(p.shift());break;case"x":t+=r(p.shift());break;case"X":t+=r(p.shift()).toUpperCase();break}}D=n[7];B++}return t+D},gmatch:function(n,p){p=l(p);var m=new RegExp(p,"g"),o=(""+n).match(m);return function(){var r=o.shift(),q=new RegExp(m).exec(r);if(r===undefined){return}q.shift();return q.length?q:r}},gsub:function(w,u,r,m){if(typeof w!="string"&&typeof w!="number"){throw new shine.Error("bad argument #1 to 'gsub' (string expected, got "+typeof w+")")}if(typeof u!="string"&&typeof u!="number"){throw new shine.Error("bad argument #2 to 'gsub' (string expected, got "+typeof u+")")}if(m!==undefined&&(m=shine.utils.coerce(m,"number"))===undefined){throw new shine.Error("bad argument #4 to 'gsub' (number expected, got "+typeof m+")")}w=""+w;u=l(""+u);var t=0,x="",v,q,p,o;while((m===undefined||t<m)&&w&&(p=w.match(u))){if(typeof r=="function"||(r||shine.EMPTY_OBJ) instanceof shine.Function){v=r.apply(null,[p[0]],true);if(v instanceof Array){v=v[0]}if(v===undefined){v=p[0]}}else{if((r||shine.EMPTY_OBJ) instanceof shine.Table){v=r.getMember(p[0])}else{if(typeof r=="object"){v=r[p]}else{v=(""+r).replace(/%([0-9])/g,function(n,s){return p[s]})}}}if(p[0].length==0&&o===undefined){q=""}else{q=w.split(p[0],1)[0]}o=p[0];x+=q+v;w=w.substr((q+o).length);t++}return[x+w,t]},len:function(m){if(typeof m!="string"&&typeof m!="number"){throw new shine.Error("bad argument #1 to 'len' (string expected, got "+typeof m+")")}return(""+m).length},lower:function(m){if(typeof m!="string"&&typeof m!="number"){throw new shine.Error("bad argument #1 to 'lower' (string expected, got "+typeof m+")")}return(""+m).toLowerCase()},match:function(m,o,p){if(typeof m!="string"&&typeof m!="number"){throw new shine.Error("bad argument #1 to 'match' (string expected, got "+typeof m+")")}if(typeof o!="string"&&typeof o!="number"){throw new shine.Error("bad argument #2 to 'match' (string expected, got "+typeof o+")")}p=p?p-1:0;m=(""+m).substr(p);var n=m.match(new RegExp(l(o)));if(!n){return}if(!n[1]){return n[0]}n.shift();return n},rep:function(p,q){var m="",o;for(o=0;o<q;o++){m+=p}return m},reverse:function(o){var m="",n;for(n=o.length;n>=0;n--){m+=o.charAt(n)}return m},sub:function(o,n,m){if(typeof o!="string"&&typeof o!="number"){throw new shine.Error("bad argument #1 to 'sub' (string expected, got "+typeof o+")")}o=""+o;n=n||1;m=m||o.length;if(n>0){n=n-1}else{if(n<0){n=o.length+n}}if(m<0){m=o.length+m+1}return o.substring(n,m)},upper:function(m){return m.toUpperCase()}};shine.lib.table={concat:function(q,o,p,n){if(!((q||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in table.concat(). Table expected")}o=o||"";p=p||1;n=n||shine.lib.table.maxn(q);var m=shine.gc.createArray().concat(q.__shine.numValues).splice(p,n-p+1);return m.join(o)},getn:function(r){if(!((r||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in table.getn(). Table expected")}var s=r.__shine.numValues,q=shine.gc.createArray(),p,o=0;for(p in s){if(s.hasOwnProperty(p)){q[p]=true}}while(q[o+1]){o++}if(o>0&&s[o]===undefined){var p=0;while(o-p>1){var n=Math.floor((p+o)/2);if(s[n]===undefined){o=n}else{p=n}}return p}return o},insert:function(o,n,p){if(!((o||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in table.insert(). Table expected")}if(p==undefined){p=n;n=o.__shine.numValues.length}var m=o.getMember(n);o.setMember(n,p);if(m){shine.lib.table.insert(o,n+1,m)}},maxn:function(m){if(!((m||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in table.maxn(). Table expected")}return m.__shine.numValues.length-1},remove:function(p,o){if(!((p||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in table.remove(). Table expected")}var n=shine.lib.table.getn(p),q=p.__shine.numValues,m;if(o>n){return}if(o==undefined){o=n}m=q.splice(o,1);while(o<n&&q[o]===undefined){delete q[o++]}return m},sort:function(o,n){if(!((o||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 to 'sort' (table expected)")}var p,m=o.__shine.numValues;if(n){if(!((n||shine.EMPTY_OBJ) instanceof shine.Function)){throw new shine.Error("Bad argument #2 to 'sort' (function expected)")}p=function(r,q){return n.apply(null,[r,q],true)[0]?-1:1}}else{p=function(r,q){return r<q?-1:1}}m.shift();m.sort(p).unshift(undefined)},unpack:function(p,o,n){if(!((p||shine.EMPTY_OBJ) instanceof shine.Table)){throw new shine.Error("Bad argument #1 in unpack(). Table expected")}o=o||1;if(n===undefined){n=shine.lib.table.getn(p)}var q=shine.gc.createArray(),m;for(m=o;m<=n;m++){q.push(p.getMember(m))}return q}}})();"use strict";var shine=shine||{};(function(){var b=/^[-+]?[0-9]*\.?([0-9]+([eE][-+]?[0-9]+)?)?$/,a=/^(\-)?0x([0-9a-fA-F]*)\.?([0-9a-fA-F]*)$/;shine.utils={coerce:function(g,f,e){var h,d,c;switch(f){case"boolean":return !(g===false||g===undefined);case"string":switch(true){case g===undefined||g===null:return"nil";case g===Infinity:return"inf";case g===-Infinity:return"-inf";case typeof g=="number"&&window.isNaN(g):return"nan";case typeof g=="function":return"function: [host code]";case g instanceof shine.Table:return shine.Table.prototype.toString.call(g);default:return g.toString()}case"number":switch(g){case undefined:return;case Infinity:case -Infinity:return g;case"inf":return Infinity;case"-inf":return -Infinity;case"nan":return NaN;default:if(typeof g=="number"&&window.isNaN(g)){return g}if((""+g).match(b)){h=parseFloat(g)}else{if(d=(""+g).match(a)){c=d[3];if((h=d[2])||c){h=parseInt(h,16)||0;if(c){h+=parseInt(c,16)/Math.pow(16,c.length)}if(d[1]){h*=-1}}}}if(h===undefined&&e){throw new shine.Error(e)}return h}default:throw new ReferenceError("Can not coerce to type: "+f)}},toObject:function(h){var g=shine.lib.table.getn(h)>0,c=shine.gc["create"+(g?"Array":"Object")](),e=h.__shine.numValues,f,d=e.length;for(f=1;f<d;f++){c[f-1]=((e[f]||shine.EMPTY_OBJ) instanceof shine.Table)?shine.utils.toObject(e[f]):e[f]}for(f in h){if(h.hasOwnProperty(f)&&!(f in shine.Table.prototype)&&f!=="__shine"){c[f]=((h[f]||shine.EMPTY_OBJ) instanceof shine.Table)?shine.utils.toObject(h[f]):h[f]}}return c},parseJSON:function(c){var d=function(f){for(var e in f){if(f.hasOwnProperty(e)){if(typeof f[e]==="object"){f[e]=d(f[e])}else{if(f[e]===null){f[e]=undefined}}}}return new shine.Table(f)};return d(JSON.parse(c))},get:function(d,g,c){var f=new XMLHttpRequest(),e;f.open("GET",d,true);if("ArrayBuffer" in window){f.responseType="arraybuffer";e=function(n){if(n.byteLength<=10000){return String.fromCharCode.apply(String,new Uint8Array(n))}var m,k,j=new Uint8Array(n),h="";for(m=0,k=n.byteLength;m<k;m+=10000){h+=String.fromCharCode.apply(String,j.subarray(m,Math.min(m+10000,k)))}return h}}else{f.responseType="text";e=function(h){return h}}f.onload=function(h){if(this.status==200){if(g){g(e(this.response))}}else{if(c){c(this.status)}}};f.send(shine.EMPTY_OBJ)}}})();"use strict";var shine=shine||{};shine.stdout={};shine.stdout.write=function(a){if(console&&console.log){console.log(a)}else{if(trace){trace(a)}}};shine.stddebug={};shine.stddebug.write=function(a){};shine.stderr={};shine.stderr.write=function(a,b){b=b||"error";if(console&&console[b]){console[b](a)}};var module=module;if(typeof module!="undefined"){module.exports=shine};
});