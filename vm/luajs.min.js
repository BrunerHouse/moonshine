var luajs=luajs||{};luajs.EventEmitter=function(){this._listeners={}};luajs.EventEmitter.prototype._trigger=function(b,e){var d=this._listeners[b],a,c;if(!d){return}if(!((e||{}) instanceof Array)){e=[e]}for(c in d){a=d[c].apply(this,e);if(a!==undefined&&!a){break}}};luajs.EventEmitter.prototype.bind=function(a,b){if(!this._listeners[a]){this._listeners[a]=[]}this._listeners[a].push(b)};luajs.EventEmitter.prototype.unbind=function(a,c){for(var b in this._listeners[a]){if(this._listeners[a][b]===c){this._listeners[a].splice(b,1)}}};var luajs=luajs||{};luajs.VM=function(a){luajs.EventEmitter.call(this);this._files=[];this._env=a||{};this._coroutineStack=[];this._resetGlobals()};luajs.VM.prototype=new luajs.EventEmitter();luajs.VM.prototype.constructor=luajs.VM;luajs.VM.prototype._resetGlobals=function(){this._globals={};for(var a in luajs.lib){this._globals[a]=luajs.lib[a]}for(var a in this._env){this._globals[a]=this._env[a]}};luajs.VM.prototype.load=function(b,e,a){var d=this,c=new luajs.File(b);this._files.push(c);c.bind("loaded",function(f){d._trigger("loaded-file",c);if(e||e===undefined){d.execute(a,c)}});this._trigger("loading-file",c);c.load()};luajs.VM.prototype.execute=function(a,c){var f=c?[c]:this._files,b,c;if(!f.length){throw new Error("No files loaded.")}for(b in f){c=f[b];if(!c.data){throw new Error("Tried to execute file before data loaded.")}this._thread=new luajs.Function(this,c,c.data,this._globals);this._trigger("executing",[this._thread,a]);try{if(!a){this._thread.call()}else{var h=luajs.lib.coroutine.wrap(this._thread),d=function(){h();if(h._coroutine.status!="dead"){window.setTimeout(d,1)}};d()}}catch(g){luajs.Error.catchExecutionError(g)}}};luajs.VM.prototype.setGlobal=function(a,b){this._globals[a]=b};var luajs=luajs||{};luajs.Closure=function(c,b,f,e,g){luajs.EventEmitter.call(this);this._vm=c;this._globals=e;this._file=b;this._data=f;this._upvalues=g||{};this._constants=f.constants;this._functions=f.functions;this._instructions=f.instructions;this._register=[];this._pc=0;this._localsUsedAsUpvalues=[];var d=this,a=function(){var j=[];for(var k=0,h=arguments.length;k<h;k++){j.push(arguments[k])}return d.execute(j)};a._instance=this;return a};luajs.Closure.prototype=new luajs.EventEmitter();luajs.Closure.prototype.constructor=luajs.Closure;luajs.Closure.prototype.execute=function(c){this._pc=0;if(this._data&&this._data.sourceName){luajs.stddebug.write("Executing "+this._data.sourceName+"...")}luajs.stddebug.write("\n");this._params=[].concat(c);this._register=[].concat(c.splice(0,this._data.paramCount));if(this._data.is_vararg==7){var b=[].concat(c),d=b.length;b=new luajs.Table(b);b.setMember("n",d);this._register.push(b)}try{return this._run()}catch(f){if(!((f||{}) instanceof luajs.Error)){var a=(f.stack||"");f=new luajs.Error("Error in host call: "+f.message);f.stack=a;f.luaStack=a.split("\n")}if(!f.luaStack){f.luaStack=[]}f.luaStack.push("at "+(this._data.sourceName||"function")+" on line "+this._data.linePositions[this._pc-1]);throw f}};luajs.Closure.prototype._run=function(){var d,o,e,k;this.terminated=false;if(luajs.debug.status=="resuming"){if(luajs.debug.resumeStack.length){this._pc--}else{luajs.debug.status="running"}}else{if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="resuming"){if(luajs.Coroutine._running._resumeStack.length){this._pc--}else{luajs.Coroutine._running.status="running";luajs.stddebug.write("[coroutine resumed]\n");k=luajs.Coroutine._running._yieldVars}}}if(k){d=this._instructions[this._pc-1];var n=d.A,m=d.B,j=d.C,h=[];for(var g=0,f=k.length;g<f;g++){h.push(k[g])}if(j===0){f=h.length;for(g=0;g<f;g++){this._register[n+g]=h[g]}this._register.splice(n+f)}else{for(g=0;g<j-1;g++){this._register[n+g]=h[g]}}}while(d=this._instructions[this._pc]){o=this._data.linePositions[this._pc];this._pc++;e=this._executeInstruction(d,o);if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="suspending"){luajs.Coroutine._running._resumeStack.push(this);if(luajs.Coroutine._running._func._instance==this){e=luajs.Coroutine._running._yieldVars;luajs.Coroutine._running.status="suspended";luajs.Coroutine._remove();luajs.stddebug.write("[coroutine suspended]\n");return e}return}if(luajs.debug.status=="suspending"&&!e){luajs.debug.resumeStack.push(this);return e}if(e!==undefined){this.terminated=true;return e}}this.terminated=true};luajs.Closure.prototype._executeInstruction=function(a,b){var f=this.constructor.OPERATIONS[a.op];if(!f){throw new Error("Operation not implemented! ("+a.op+")")}if(luajs.debug.status!="resuming"){var e="",c=this.constructor.OPERATION_NAMES[a.op];for(var d=0;d<this._index;d++){e+="\t"}luajs.stddebug.write(e+"["+this._pc+"]\t"+b+"\t"+c+"\t"+a.A+"\t"+a.B+(a.C!==undefined?"\t"+a.C:""))}return f.call(this,a.A,a.B,a.C)};luajs.Closure.prototype._getConstant=function(a){if(this._constants[a]===null){return}return this._constants[a]};(function(){var E=/^[-+]?[0-9]*\.?([0-9]+([eE][-+]?[0-9]+)?)?$/;function m(O,N){this._register[O]=this._register[N]}function b(N,O){this._register[N]=this._getConstant(O)}function q(O,N,P){this._register[O]=!!N;if(P){this._pc++}}function J(O,N){for(var P=O;P<=N;P++){this._register[P]=undefined}}function B(O,N){this._register[O]=this._upvalues[N].getValue()}function i(O,N){if(this._getConstant(N)=="_G"){this._register[O]=new luajs.Table(this._globals)}else{if(this._globals[this._getConstant(N)]!==undefined){this._register[O]=this._globals[this._getConstant(N)]}else{this._register[O]=undefined}}}function x(O,N,P){P=(P>=256)?this._getConstant(P-256):this._register[P];if(this._register[N]===undefined){throw new luajs.Error("Attempt to index a nil value ("+P+" not present in nil)")}else{if((this._register[N]||{}) instanceof luajs.Table){this._register[O]=this._register[N].getMember(P)}else{if(typeof this._register[N]=="string"&&luajs.lib.string[P]){this._register[O]=luajs.lib.string[P]}else{this._register[O]=this._register[N][P]}}}}function l(O,N){this._globals[this._getConstant(N)]=this._register[O]}function z(O,N){this._upvalues[N].setValue(this._register[O])}function v(O,N,P){N=(N>=256)?this._getConstant(N-256):this._register[N];P=(P>=256)?this._getConstant(P-256):this._register[P];if((this._register[O]||{}) instanceof luajs.Table){this._register[O].setMember(N,P)}else{if(this._register[O]===undefined){throw new luajs.Error("Attempt to index a missing field (can't set \""+N+'" on a nil value)')}else{this._register[O][N]=P}}}function D(O,N,P){this._register[O]=new luajs.Table()}function k(O,N,P){P=(P>=256)?this._getConstant(P-256):this._register[P];this._register[O+1]=this._register[N];if(this._register[N]===undefined){throw new luajs.Error("Attempt to index a nil value ("+P+" not present in nil)")}else{if((this._register[N]||{}) instanceof luajs.Table){this._register[O]=this._register[N].getMember(P)}else{if(typeof this._register[N]=="string"&&luajs.lib.string[P]){this._register[O]=luajs.lib.string[P]}else{this._register[O]=this._register[N][P]}}}}function g(O,N,T){N=(N>=256)?this._getConstant(N-256):this._register[N];T=(T>=256)?this._getConstant(T-256):this._register[T];var P,Q,R,S;if((N||{}) instanceof luajs.Table&&(P=N.__luajs.metatable)&&(Q=P.getMember("__add"))){this._register[O]=Q.apply([N,T])[0]}else{if(!(""+N).match(E)||!(""+T).match(E)){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[O]=parseFloat(N)+parseFloat(T)}}function r(O,N,R){N=(N>=256)?this._getConstant(N-256):this._register[N];R=(R>=256)?this._getConstant(R-256):this._register[R];var P,Q;if((N||{}) instanceof luajs.Table&&(P=N.__luajs.metatable)&&(Q=P.getMember("__sub"))){this._register[O]=Q.apply([N,R])[0]}else{if(!(""+N).match(E)||!(""+R).match(E)){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[O]=parseFloat(N)-parseFloat(R)}}function d(O,N,R){N=(N>=256)?this._getConstant(N-256):this._register[N];R=(R>=256)?this._getConstant(R-256):this._register[R];var P,Q;if((N||{}) instanceof luajs.Table&&(P=N.__luajs.metatable)&&(Q=P.getMember("__mul"))){this._register[O]=Q.apply([N,R])[0]}else{if(!(""+N).match(E)||!(""+R).match(E)){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[O]=parseFloat(N)*parseFloat(R)}}function I(O,N,R){N=(N>=256)?this._getConstant(N-256):this._register[N];R=(R>=256)?this._getConstant(R-256):this._register[R];var P,Q;if((N||{}) instanceof luajs.Table&&(P=N.__luajs.metatable)&&(Q=P.getMember("__div"))){this._register[O]=Q.apply([N,R])[0]}else{if(!(""+N).match(E)||!(""+R).match(E)){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[O]=parseFloat(N)/parseFloat(R)}}function h(O,N,R){N=(N>=256)?this._getConstant(N-256):this._register[N];R=(R>=256)?this._getConstant(R-256):this._register[R];var P,Q;if((N||{}) instanceof luajs.Table&&(P=N.__luajs.metatable)&&(Q=P.getMember("__mod"))){this._register[O]=Q.apply([N,R])[0]}else{if(!(""+N).match(E)||!(""+R).match(E)){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[O]=parseFloat(N)%parseFloat(R)}}function w(O,N,R){N=(N>=256)?this._getConstant(N-256):this._register[N];R=(R>=256)?this._getConstant(R-256):this._register[R];var P,Q;if((N||{}) instanceof luajs.Table&&(P=N.__luajs.metatable)&&(Q=P.getMember("__pow"))){this._register[O]=Q.apply([N,R])[0]}else{if(!(""+N).match(E)||!(""+R).match(E)){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[O]=Math.pow(parseFloat(N),parseFloat(R))}}function o(O,N){var P,Q;if((this._register[N]||{}) instanceof luajs.Table&&(P=this._register[N].__luajs.metatable)&&(Q=P.getMember("__unm"))){this._register[O]=Q.apply([this._register[N]])[0]}else{N=this._register[N];if(!(""+N).match(E)){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[O]=-parseFloat(N)}}function G(O,N){this._register[O]=!this._register[N]}function n(O,N){var Q=0;if((this._register[N]||{}) instanceof luajs.Table){this._register[O]=luajs.lib.table.getn(this._register[N])}else{if(typeof this._register[N]=="object"){for(var P in this._register[N]){if(this._register[N].hasOwnProperty(P)){Q++}}this._register[O]=Q}else{if(this._register[N]==undefined){throw new luajs.Error("attempt to get length of a nil value")}else{if(this._register[N].length===undefined){this._register[O]=undefined}else{this._register[O]=this._register[N].length}}}}}function u(O,N,T){var S=this._register[T],P,R;for(var Q=T-1;Q>=N;Q--){if((this._register[Q]||{}) instanceof luajs.Table&&(P=this._register[Q].__luajs.metatable)&&(R=P.getMember("__concat"))){S=R.apply([this._register[Q],S])[0]}else{if(!(typeof this._register[Q]==="string"||typeof this._register[Q]==="number")||!(typeof S==="string"||typeof S==="number")){throw new luajs.Error("Attempt to concatenate a non-string or non-numeric value")}S=this._register[Q]+S}}this._register[O]=S}function K(O,N){this._pc+=N}function H(P,O,S){O=(O>=256)?this._getConstant(O-256):this._register[O];S=(S>=256)?this._getConstant(S-256):this._register[S];var Q,R,N;if(O!==S&&typeof(O)===typeof(S)&&(O||{}) instanceof luajs.Table&&(Q=O.__luajs.metatable)&&(R=Q.getMember("__eq"))){N=!!R.apply([O,S])[0]}else{N=(O===S)}if(N!=P){this._pc++}}function t(P,O,S){O=(O>=256)?this._getConstant(O-256):this._register[O];S=(S>=256)?this._getConstant(S-256):this._register[S];var Q,R,N;if((O||{}) instanceof luajs.Table&&(Q=O.__luajs.metatable)&&(R=Q.getMember("__le"))){N=R.apply([O,S])[0]}else{N=(O<S)}if(N!=P){this._pc++}}function C(P,O,S){O=(O>=256)?this._getConstant(O-256):this._register[O];S=(S>=256)?this._getConstant(S-256):this._register[S];var Q,R,N;if(O!==S&&typeof(O)===typeof(S)&&(O||{}) instanceof luajs.Table&&(Q=O.__luajs.metatable)&&(R=Q.getMember("__le"))){N=R.apply([O,S])[0]}else{N=(O<=S)}if(N!=P){this._pc++}}function j(O,N,P){if(this._register[O]===0||this._register[O]===""){if(!P){this._pc++}}else{if(!this._register[O]!==!P){this._pc++}}}function e(O,N,P){if(!this._register[N]===!P){this._register[O]=this._register[N]}else{this._pc++}}function c(P,N,U){var R=[],S,O,Q,T;if(luajs.debug.status=="resuming"){T=luajs.debug.resumeStack.pop();if((T||{}) instanceof luajs.Coroutine){Q=T.resume()}else{Q=T._run()}}else{if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="resuming"){T=luajs.Coroutine._running._resumeStack.pop();Q=T._run()}else{if(N===0){O=this._register.length;for(S=P+1;S<O;S++){R.push(this._register[S])}}else{for(S=0;S<N-1;S++){R.push(this._register[P+S+1])}}}}if(!T){if(!this._register[P]||!this._register[P].apply){throw new luajs.Error("Attempt to call non-function")}Q=this._register[P].apply({},R)}if(!((Q||{}) instanceof Array)){Q=[Q]}if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="suspending"){return}if(U===0){O=Q.length;for(S=0;S<O;S++){this._register[P+S]=Q[S]}this._register.splice(P+O)}else{for(S=0;S<U-1;S++){this._register[P+S]=Q[S]}}}function M(O,N){return c.call(this,O,N,0)}function y(P,N){var Q=[],S;if(N===0){O=this._register.length;for(S=P;S<O;S++){Q.push(this._register[S])}}else{for(S=0;S<N-1;S++){Q.push(this._register[P+S])}}for(var S=0,O=this._localsUsedAsUpvalues.length;S<O;S++){var R=this._localsUsedAsUpvalues[S];R.upvalue.value=this._register[R.registerIndex];R.upvalue.open=false;this._localsUsedAsUpvalues.splice(S--,1);O--;delete this._register[R.registerIndex]}return Q}function p(O,N){this._register[O]+=this._register[O+2];var P=this._register[O+2]/Math.abs(this._register[O+2]);if((P===1&&this._register[O]<=this._register[O+1])||(P!==1&&this._register[O]>=this._register[O+1])){this._register[O+3]=this._register[O];this._pc+=N}}function L(O,N){this._register[O]-=this._register[O+2];this._pc+=N}function s(O,N,T){var R=[this._register[O+1],this._register[O+2]],P=this._register[O].apply({},R),Q;if(!((P||{}) instanceof Array)){P=[P]}if(P[0]&&P[0]===""+(Q=parseInt(P[0],10))){P[0]=Q}for(var S=0;S<T;S++){this._register[O+S+3]=P[S]}if(this._register[O+3]!==undefined){this._register[O+2]=this._register[O+3]}else{this._pc++}}function f(O,N,R){var Q=N||this._register.length-O-1,P;for(P=0;P<Q;P++){this._register[O].setMember(50*(R-1)+P+1,this._register[O+P+1])}}function F(P,N,S){for(var R=0,O=this._localsUsedAsUpvalues.length;R<O;R++){var Q=this._localsUsedAsUpvalues[R];if(Q&&Q.registerIndex>=P){Q.upvalue.value=this._register[Q.registerIndex];Q.upvalue.open=false;this._localsUsedAsUpvalues.splice(R--,1);O--;delete this._register[Q.registerIndex]}}}function a(O,Q){var P=this,R=[],N;while((N=this._instructions[this._pc])&&(N.op===0||N.op===4)&&N.A===0){(function(){var V=N,W;luajs.stddebug.write("-> "+P.constructor.OPERATION_NAMES[V.op]+"\t"+V.A+"\t"+V.B+"\t"+V.C);if(V.op===0){for(var U=0,T=P._localsUsedAsUpvalues.length;U<T;U++){var S=P._localsUsedAsUpvalues[U];if(S.registerIndex===V.B){W=S.upvalue;break}}if(!W){W={open:true,getValue:function(){return this.open?P._register[V.B]:this.value},setValue:function(X){this.open?P._register[V.B]=X:this.value=X},name:P._functions[Q].upvalues[R.length]};P._localsUsedAsUpvalues.push({registerIndex:V.B,upvalue:W})}R.push(W)}else{R.push({getValue:function(){return P._upvalues[V.B].getValue()},setValue:function(X){P._upvalues[V.B].setValue(X)},name:P._upvalues[V.B].name})}})();this._pc++}this._register[O]=new luajs.Function(this._vm,this._file,this._functions[Q],this._globals,R)}function A(P,N){var Q,O=N===0?this._params.length-this._data.paramCount:N-1;for(Q=0;Q<O;Q++){this._register[P+Q]=this._params[this._data.paramCount+Q]}for(Q=P+O;Q<this._register.length;Q++){delete this._register[Q]}}luajs.Closure.OPERATIONS=[m,b,q,J,B,i,x,l,z,v,D,k,g,r,d,I,h,w,o,G,n,u,K,H,t,C,j,e,c,M,y,p,L,s,f,F,a,A];luajs.Closure.OPERATION_NAMES=["move","loadk","loadbool","loadnil","getupval","getglobal","gettable","setglobal","setupval","settable","newtable","self","add","sub","mul","div","mod","pow","unm","not","len","concat","jmp","eq","lt","le","test","testset","call","tailcall","return","forloop","forprep","tforloop","setlist","close","closure","vararg"]})();var luajs=luajs||{};luajs.Function=function(b,a,d,c,e){luajs.EventEmitter.call(this);this._vm=b;this._file=a;this._data=d;this._globals=c;this._upvalues=e||{};this._index=luajs.Function._index++};luajs.Function.prototype=new luajs.EventEmitter();luajs.Function.prototype.constructor=luajs.Function;luajs.Function._index=0;luajs.Function.prototype.getInstance=function(){return new luajs.Closure(this._vm,this._file,this._data,this._globals,this._upvalues)};luajs.Function.prototype.call=function(){var b=[],a=arguments.length,c;for(c=1;c<a;c++){b.push(arguments[c])}return this.apply(b)};luajs.Function.prototype.apply=function(c,a){if((c||{}) instanceof Array&&!a){a=c;c=undefined}try{return this.getInstance().apply(c,a)}catch(b){luajs.Error.catchExecutionError(b)}};luajs.Function.prototype.toString=function(){return"function: 0x"+this._index.toString(16)};var luajs=luajs||{};luajs.Coroutine=function(a){luajs.EventEmitter.call(this);this._func=a.getInstance();this._index=luajs.Coroutine._index++;this._started=false;this._yieldVars=undefined;this._resumeStack=[];this.status="suspended";luajs.stddebug.write("[coroutine created]\n")};luajs.Coroutine.prototype=new luajs.EventEmitter();luajs.Coroutine.prototype.constructor=luajs.Function;luajs.Coroutine._index=0;luajs.Coroutine._stack=[];luajs.Coroutine._add=function(a){luajs.Coroutine._stack.push(luajs.Coroutine._running);luajs.Coroutine._running=a};luajs.Coroutine._remove=function(){luajs.Coroutine._running=luajs.Coroutine._stack.pop()};luajs.Coroutine.prototype.resume=function(){var b;try{if(this.status=="dead"){throw new luajs.Error("cannot resume dead coroutine")}luajs.Coroutine._add(this);if(luajs.debug.status=="resuming"){var g=luajs.debug.resumeStack.pop();if((g||{}) instanceof luajs.Coroutine){b=g.resume()}else{b=this._func._instance._run()}}else{if(!this._started){this.status="running";luajs.stddebug.write("[coroutine started]\n");this._started=true;b=this._func.apply({},arguments)}else{this.status="resuming";luajs.stddebug.write("[coroutine resuming]\n");var c=[];for(var d=0,a=arguments.length;d<a;d++){c.push(arguments[d])}this._yieldVars=c;b=this._resumeStack.pop()._run()}}if(luajs.debug.status=="suspending"){luajs.debug.resumeStack.push(this);return}this.status=this._func._instance.terminated?"dead":"suspended";if(b){b.unshift(true)}}catch(f){b=[false,f];this.status="dead"}if(this.status=="dead"){luajs.stddebug.write("[coroutine terminated]\n")}return b};luajs.Coroutine.prototype.toString=function(){return"thread: 0x"+this._index.toString(16)};var luajs=luajs||{};luajs.Table=function(f){var d=((f||{}) instanceof Array),c,e,b;for(b in f||{}){var a;c=d?parseInt(b,10)+1:b;e=f[b];if(typeof getQualifiedClassName!=="undefined"){a=((getQualifiedClassName(e)=="Object")&&(!(e instanceof luajs.Table))&&(!(e instanceof luajs.Coroutine))&&(!(e instanceof luajs.Function))&&(!(e instanceof luajs.Closure)))||(getQualifiedClassName(e)=="Array")}else{a=(typeof e=="object"&&e.constructor===Object)}if(a){this[c]=new luajs.Table(e)}else{this[c]=e}}this.__luajs={type:"table",index:++luajs.Table.count,keys:[],values:[]}};luajs.Table.count=0;luajs.Table.prototype.getMember=function(c){if(typeof c==="string"||typeof c==="number"){if(this[c]!==undefined){return this[c]}}else{var b=this.__luajs.keys.indexOf(c);if(b>=0){return this.__luajs.values[b]}}var a=this.__luajs.metatable;if(a&&a.__index){switch(a.__index.constructor){case luajs.Table:return a.__index.getMember(c);case Function:return a.__index(this,c)}}};luajs.Table.prototype.setMember=function(c,e){var a=this.__luajs.metatable,d,b;if(this[c]===undefined&&a&&a.__newindex){switch(a.__newindex.constructor){case luajs.Table:return a.__newindex.setMember(c,e);case Function:return a.__newindex(this,c,e)}}if(typeof c==="string"||typeof c==="number"){this[c]=e}else{d=this.__luajs.keys;b=d.indexOf(c);if(b<0){b=d.length;d[b]=c}this.__luajs.values[b]=e}};luajs.Table.prototype.toString=function(){if(this.constructor!=luajs.Table){return"userdata"}return"table: 0x"+this.__luajs.index.toString(6)};var luajs=luajs||{};luajs.Error=function(a){this.message=a};luajs.Error.prototype=new Error();luajs.Error.catchExecutionError=function(a){if(a instanceof luajs.Error){a.message=a.message+"\n    "+(a.luaStack||[]).join("\n    ")}throw a};luajs.Error.prototype.toString=function(){return"Luajs Error: "+this.message};var luajs=luajs||{};luajs.File=function(a){luajs.EventEmitter.call(this);this._url=a;this.data=undefined};luajs.File.prototype=new luajs.EventEmitter();luajs.File.prototype.constructor=luajs.File;luajs.File.prototype.load=function(){var a=this;jQuery.getJSON(this._url,function(b){a.data=b;a._trigger("loaded",b)})};luajs.File.prototype.loadLua=function(){};var luajs=luajs||{};(function(){function a(b){b=b.replace(/%a/g,"[a-zA-Z]");b=b.replace(/%A/g,"[^a-zA-Z]");b=b.replace(/%c/g,"\\[nrt]");b=b.replace(/%d/g,"\d");b=b.replace(/%D/g,"[^\d]");b=b.replace(/%l/g,"[a-z]");b=b.replace(/%L/g,"[^a-z]");b=b.replace(/%s/g,"s");b=b.replace(/%S/g,"[^s]");b=b.replace(/%u/g,"[A-Z]");b=b.replace(/%U/g,"[^A-Z]");b=b.replace(/%w/g,"[a-zA-Z0-9]");b=b.replace(/%W/g,"[^a-zA-Z0-9]");b=b.replace(/%x/g,"[0-9a-fA-F]");b=b.replace(/%X/g,"[^0-9a-fA-F]");b=b.replace(/%([\^\$\(\)\%\.\[\]\*\+\-\?])/g,"\\$1");return b}luajs.lib={assert:function(c,b){if(!c){throw new luajs.Error(b||"Assertion failed!")}return[c,b]},collectgarbage:function(c,b){},dofile:function(b){},error:function(b){throw new luajs.Error(b)},getfenv:function(b){},getmetatable:function(b){if(!((b||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in getmetatable(). Table expected")}return b.__luajs.metatable},ipairs:function(c){if(!((c||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in ipairs(). Table expected")}var b=function(e,d){if(d===undefined){throw new luajs.Error("Bad argument #2 to ipairs() iterator")}if(!e.hasOwnProperty(d+1)){return undefined}return[d+1,e[d+1]]};return[b,c,0]},load:function(c,b){return[undefined,"Unimplemented"]},loadfile:function(b){return[undefined,"Unimplemented"]},loadstring:function(c,b){return[undefined,"Unimplemented"]},next:function(e,b){var f=(b==undefined),d;for(d in e){if(e.hasOwnProperty(d)&&!(d in luajs.Table.prototype)&&d!=="__luajs"){if(!f){if(d==b){f=true}}else{if(e.hasOwnProperty(d)&&e[d]!==undefined&&(""+d).substr(0,2)!="__"){return[d,e[d]]}}}}for(d in e.__luajs.keys){var c=e.__luajs.keys[d];if(!f){if(c===b){f=true}}else{if(e.__luajs.values[d]!==undefined){return[c,e.__luajs.values[d]]}}}return[]},pairs:function(b){if(!((b||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in pairs(). Table expected")}return[luajs.lib.next,b]},pcall:function(g){var d=[],b;for(var f=1,c=arguments.length;f<c;f++){d.push(arguments[f])}try{if(typeof g=="function"){b=g.apply({},d)}else{if((g||{}) instanceof luajs.Function){b=g.apply(d)}else{throw new luajs.Error("Attempt to call non-function")}}}catch(h){return[false,h.message]}if(!((b||{}) instanceof Array)){b=[b]}b.unshift(true);return b},print:function(){var c=[],e;for(var d=0,b=arguments.length;d<b;d++){e=arguments[d];if((e||{}) instanceof luajs.Table){c.push("table: 0x"+e.__luajs.index.toString(16))}else{if((e||{}) instanceof Function){c.push("JavaScript function: "+e.toString())}else{if(e===undefined){c.push("nil")}else{c.push(e)}}}}return luajs.stdout.write(c.join("\t"))},rawequal:function(c,b){return(c==b)},rawget:function(c,b){if(!((c||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in rawget(). Table expected")}return c.index},rawset:function(c,b,d){if(!((c||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in rawset(). Table expected")}if(b==undefined){throw new luajs.Error("Bad argument #2 in rawset(). Nil not allowed")}c[b]=d;return c},select:function(d){var c=[];if(d=="#"){return arguments.length-1}else{if(d=parseInt(d,10)){for(var e=d,b=arguments.length;e<b;e++){c.push(arguments[e])}return c}else{throw new luajs.Error('Bad argument #1 in select(). Number or "#" expected')}}},setmetatable:function(c,b){if(!((c||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in setmetatable(). Table expected")}if(!(b===undefined||(b||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #2 in setmetatable(). Nil or table expected")}c.__luajs.metatable=b},tonumber:function(c,b){c=(""+c).replace(/^\s+|\s+$/g,"");b=b||10;if(b===2&&c.match(/[^01]/)){return}if(b===10&&c.match(/[^0-9e\+\-\.]/)){return}if(b===16&&c.match(/[^0-9A-Fa-f]/)){return}return(b==10)?parseFloat(c):parseInt(c,b)},tostring:function(b){return b===undefined?"nil":b.toString()},type:function(b){var c=typeof(b);switch(c){case"undefined":return"nil";case"number":case"string":case"boolean":return c;case"object":if((b||{}) instanceof luajs.Table){return"table"}if((b||{}) instanceof luajs.Function){return"function"}return"userdata"}},unpack:function(d,c,b){return luajs.lib.table.unpack(d,c,b)},_VERSION:"Lua 5.1",xpcall:function(d,c){var b,g;try{b=d.apply({});g=true}catch(f){b=c.apply({});if(((b||{}) instanceof Array)){b=b[0]}g=false}if(!((b||{}) instanceof Array)){b=[b]}b.unshift(g);return b}};luajs.lib.string={"byte":function(f,e,d){e=e||1;d=d||e;var b=[],g=f.length,c;for(c=e;c<=g&&c<=d;c++){b.push(f.charCodeAt(c-1)||undefined)}return b},"char":function(){var b="";for(var d=0,c=arguments.length;d<c;d++){b+=String.fromCharCode(arguments[d])}return b},dump:function(b){},find:function(d,e,f,c){f=f||1;var b=d.indexOf(e,f-1);return(b===-1)?undefined:[b+1,b+e.length]},format:function(c){var b={init:function(){if(typeof arguments=="undefined"){return null}if(arguments.length<1){return null}if(typeof arguments[0]!="string"){return null}if(typeof RegExp=="undefined"){return null}var m=arguments[0];var f=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g);var k=new Array();var o=new Array();var d=0;var l=0;var q=0;var g=0;var n="";var j=null;while(j=f.exec(m)){if(j[9]){d+=1}l=g;q=f.lastIndex-j[0].length;o[o.length]=m.substring(l,q);g=f.lastIndex;k[k.length]={match:j[0],left:j[3]?true:false,sign:j[4]||"",pad:j[5]||" ",min:j[6]||0,precision:j[8],code:j[9]||"%",negative:parseInt(arguments[d])<0?true:false,argument:String(arguments[d])}}o[o.length]=m.substring(g);if(k.length==0){return m}if((arguments.length-1)<d){return null}var e=null,j=null,h=null,p;for(h=0;h<k.length;h++){if(k[h].code=="%"){p="%"}else{if(k[h].code=="b"){k[h].argument=String(Math.abs(parseInt(k[h].argument)).toString(2));p=b.convert(k[h],true)}else{if(k[h].code=="c"){k[h].argument=String(String.fromCharCode(Math.abs(parseInt(k[h].argument))));p=b.convert(k[h],true)}else{if(k[h].code=="d"){k[h].argument=String(Math.abs(parseInt(k[h].argument)));p=b.convert(k[h])}else{if(k[h].code=="f"){k[h].argument=String(Math.abs(parseFloat(k[h].argument)).toFixed(k[h].precision?k[h].precision:6));p=b.convert(k[h])}else{if(k[h].code=="o"){k[h].argument=String(Math.abs(parseInt(k[h].argument)).toString(8));p=b.convert(k[h])}else{if(k[h].code=="s"){k[h].argument=k[h].argument.substring(0,k[h].precision?k[h].precision:k[h].argument.length);p=b.convert(k[h],true)}else{if(k[h].code=="x"){k[h].argument=String(Math.abs(parseInt(k[h].argument)).toString(16));p=b.convert(k[h])}else{if(k[h].code=="X"){k[h].argument=String(Math.abs(parseInt(k[h].argument)).toString(16));p=b.convert(k[h]).toUpperCase()}else{p=k[h].match}}}}}}}}}n+=o[h];n+=p}n+=o[h];return n},convert:function(e,g){if(g){e.sign=""}else{e.sign=e.negative?"-":e.sign}var d=e.min-e.argument.length+1-e.sign.length;var f=new Array(d<0?0:d).join(e.pad);if(!e.left){if(e.pad=="0"||g){return e.sign+f+e.argument}else{return f+e.sign+e.argument}}else{if(e.pad=="0"||g){return e.sign+e.argument+f.replace(/0/g," ")}else{return e.sign+e.argument+f}}}};return b.init.apply({},arguments)},gmatch:function(b,c){},gsub:function(d,h,g,i){h=a(h);var c=new RegExp(h),e=0,b="",f;while((i===undefined||e<i)&&d.match(h)){d=d.replace(c,"{:gsub-sep:}");d=d.split("{:gsub-sep:}");b+=d[0]+g;d=d[1];e++}return[b+d,e]},len:function(b){return b.length},lower:function(b){return b.toLowerCase()},match:function(b,c,d){},rep:function(d,e){var b="",c;for(c=0;c<e;c++){b+=d}return b},reverse:function(d){var b="",c;for(c=d.length;c>=0;c--){b+=d.charAt(c)}return b},sub:function(d,c,b){if(c>0){c=c-1}else{if(c<0){c=d.length+c}}if(b<0){b=d.length+b+1}return d.substring(c,b)},upper:function(b){return b.toUpperCase()}};luajs.lib.table={concat:function(g,e,f,d){if(!((g||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.concat(). Table expected")}e=e||"";f=f||1;d=d||luajs.lib.table.maxn(g);var b=[],c;for(c=f;c<=d;c++){b.push(g[c])}return b.join(e)},getn:function(g){if(!((g||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.getn(). Table expected")}var f=[],d,e,c=0;for(e in g){if((d=0+parseInt(e,10))==e){f[d]=true}}while(f[c+1]){c++}if(c>0&&g[c]===undefined){var e=0;while(c-e>1){var b=Math.floor((e+c)/2);if(g[b]===undefined){c=b}else{e=b}}return e}return c},insert:function(d,c,e){if(!((d||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.insert(). Table expected")}if(e==undefined){e=c;c=1;while(d.getMember(c)!==undefined){c++}}var b=d.getMember(c);d.setMember(c,e);if(b){luajs.lib.table.insert(d,c+1,b)}},maxn:function(e){if(!((e||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.maxn(). Table expected")}var b=0,c,d;for(d in e){if((c=0+parseInt(d,10))==d&&e[d]!==null&&c>b){b=c}}return b},unpack:function(e,d,c){if(!((e||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in unpack(). Table expected")}d=d||1;if(c===undefined){c=luajs.lib.table.getn(e)}var f=[],b;for(b=d;b<=c;b++){f.push(e.getMember(b))}return f},remove:function(d,c){if(!((d||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.remove(). Table expected")}if(c==undefined){c=1;while(d[c+1]!==undefined){c++}}if(c>luajs.lib.table.getn(d)){return}var b=d[c];d[c]=d[c+1];luajs.lib.table.remove(d,c+1);if(d[c]===undefined){delete d[c]}return b},sort:function(e,c){if(!((e||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 to 'sort' (table expected)")}var f,b=[],g=function(i,h){return i<h?-1:1};if(c){if(!((c||{}) instanceof luajs.Function)){throw new luajs.Error("Bad argument #2 to 'sort' (function expected)")}g=function(i,h){return c.call({},i,h)[0]?-1:1}}for(var d=1;(f=e.getMember(d))!==undefined;d++){b.push(f)}b.sort(g);for(d in b){e.setMember(parseInt(d,10)+1,b[d])}}};luajs.lib.math={abs:function(b){return Math.abs(b)},acos:function(b){return Math.acos(b)},asin:function(b){return Math.asin(b)},atan:function(b){return Math.atan(b)},atan2:function(b,c){return Math.atan2(c,b)},ceil:function(b){return Math.ceil(b)},cos:function(b){return Math.cos(b)},cosh:function(b){},deg:function(b){},exp:function(b){return Math.exp(b)},floor:function(b){return Math.floor(b)},fmod:function(b,c){return b%c},frexp:function(b,c){},huge:Infinity,ldexp:function(b,c){return b*Math.pow(2,c)},log:function(c,d){var b=Math.log(c);if(d!==undefined){return b/Math.log(d)}return b},log10:function(b){return Math.log(b)/Math.log(10)},max:function(){var b=-Infinity,d=arguments.length,c;for(c=0;c<d;c++){if(arguments[c]>b){b=arguments[c]}}return b},min:function(){var c=Infinity,d=arguments.length,b;for(b=0;b<d;b++){if(arguments[b]<c){c=arguments[b]}}return c},modf:function(b){var d=Math.floor(b),c=b-d;return[d,c]},pi:Math.PI,pow:function(b,c){return Math.pow(b,c)},rad:function(b){},random:function(c,b){if(c===undefined&&b===undefined){return Math.random()}if(typeof c!=="number"){throw new luajs.Error("bad argument #1 to 'random' (number expected)")}if(b===undefined){b=c;c=1}else{if(typeof b!=="number"){throw new luajs.Error("bad argument #2 to 'random' (number expected)")}}if(c>b){throw new luajs.Error("bad argument #2 to 'random' (interval is empty)")}return Math.floor(Math.random()*(b-c+1)+c)},randomseed:function(){},sin:function(b){return Math.sin(b)},sinh:function(b){},sqrt:function(b){return Math.sqrt(b)},tan:function(b){return Math.tan(b)},tanh:function(b){}};luajs.lib.os={clock:function(){},date:function(l,f){if(l===undefined){l="%c"}var m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=["January","February","March","April","May","June","July","August","September","October","November","December"],b=[31,28,31,30,31,30,31,31,30,31,30,31],j=function(q,i){var o=parseInt(g["%j"](q),10),n=new Date(q.getFullYear(),0,1,12),p=(8-n["get"+k+"Day"]()+i)%7;return("0"+(Math.floor((o-p)/7)+1)).substr(-2)},g={"%a":function(i){return m[i["get"+k+"Day"]()].substr(0,3)},"%A":function(i){return m[i["get"+k+"Day"]()]},"%b":function(i){return d[i["get"+k+"Month"]()].substr(0,3)},"%B":function(i){return d[i["get"+k+"Month"]()]},"%c":function(i){return i["to"+k+"LocaleString"]()},"%d":function(i){return("0"+i["get"+k+"Date"]()).substr(-2)},"%H":function(i){return("0"+i["get"+k+"Hours"]()).substr(-2)},"%I":function(i){return("0"+((i["get"+k+"Hours"]()+11)%12+1)).substr(-2)},"%j":function(q){var o=q["get"+k+"Date"](),n=q["get"+k+"Month"]();for(var p=0;p<n;p++){o+=b[p]}if(n>1&&q["get"+k+"FullYear"]()%4===0){o+=1}return("00"+o).substr(-3)},"%m":function(i){return("0"+(i["get"+k+"Month"]()+1)).substr(-2)},"%M":function(i){return("0"+i["get"+k+"Minutes"]()).substr(-2)},"%p":function(i){return(i["get"+k+"Hours"]()<12)?"AM":"PM"},"%S":function(i){return("0"+i["get"+k+"Seconds"]()).substr(-2)},"%U":function(i){return j(i,0)},"%w":function(i){return""+(i["get"+k+"Day"]())},"%W":function(i){return j(i,1)},"%x":function(i){return g["%m"](i)+"/"+g["%d"](i)+"/"+g["%y"](i)},"%X":function(i){return g["%H"](i)+":"+g["%M"](i)+":"+g["%S"](i)},"%y":function(i){return g["%Y"](i).substr(-2)},"%Y":function(i){return""+i["get"+k+"FullYear"]()},"%Z":function(i){return k?"UTC":i.toString().substr(-4,3)},"%%":function(){return"%"}},k="",e=new Date();if(f){e.setTime(f*1000)}if(l.substr(0,1)==="!"){l=l.substr(1);k="UTC"}if(l==="*t"){var c=function(o){var n=o.getFullYear(),i=new Date(n,0);return(o.getTimezoneOffset()!==i.getTimezoneOffset())};return new luajs.Table({year:parseInt(g["%Y"](e),10),month:parseInt(g["%m"](e),10),day:parseInt(g["%d"](e),10),hour:parseInt(g["%H"](e),10),min:parseInt(g["%M"](e),10),sec:parseInt(g["%S"](e),10),wday:parseInt(g["%w"](e),10)+1,yday:parseInt(g["%j"](e),10),isdst:c(e)})}for(var h in g){if(l.indexOf(h)>=0){l=l.replace(h,g[h](e))}}return l},difftime:function(b,c){return b-c},execute:function(){if(arguments.length){throw new luajs.Error("shell is not available. You should always check first by calling os.execute with no parameters")}return 0},exit:function(){throw"Execution terminated."},getenv:function(){},remove:function(){},rename:function(){},setlocale:function(){},time:function(h){var d;if(!h){d=new Date()}else{var c,i,g,b,e,f;if(!(c=h.getMember("day"))){throw new luajs.Error("Field 'day' missing in date table")}if(!(i=h.getMember("month"))){throw new luajs.Error("Field 'month' missing in date table")}if(!(g=h.getMember("year"))){throw new luajs.Error("Field 'year' missing in date table")}b=h.getMember("hour")||12;e=h.getMember("min")||0;f=h.getMember("sec")||0;if(h.getMember("isdst")){b--}d=new Date(g,i-1,c,b,e,f)}return Math.floor(d.getTime()/1000)},tmpname:function(){}};luajs.lib.coroutine={create:function(b){return new luajs.Coroutine(b)},resume:function(b){var d=[];for(var e=1,c=arguments.length;e<c;e++){d.push(arguments[e])}return b.resume.apply(b,d)},running:function(){return luajs.Coroutine._running},status:function(b){return b.status},wrap:function(d){var c=luajs.lib.coroutine.create(d);var b=function(){var g=[c];for(var h=0,e=arguments.length;h<e;h++){g.push(arguments[h])}var f=luajs.lib.coroutine.resume.apply({},g),j=f.shift();if(j){return f}throw f[0]};b._coroutine=c;return b},yield:function(){if(!luajs.Coroutine._running){throw new luajs.Error("attempt to yield across metamethod/C-call boundary (not in coroutine)")}var c=[];for(var d=0,b=arguments.length;d<b;d++){c.push(arguments[d])}luajs.Coroutine._running._yieldVars=c;luajs.Coroutine._running.status="suspending";return}}})();var luajs=luajs||{};luajs.debug={};luajs.utils={toObject:function(d){var c=luajs.lib.table.getn(d)>0,a=c?[]:{},b;for(b in d){if(d.hasOwnProperty(b)&&!(b in luajs.Table.prototype)&&b!=="__luajs"){a[c?b-1:b]=((d[b]||{}) instanceof luajs.Table)?luajs.utils.toObject(d[b]):d[b]}}return a},parseJSON:function(a){var b=function(d){for(var c in d){if(typeof d[c]==="object"){d[c]=b(d[c])}else{if(d[c]===null){d[c]=undefined}}}return new luajs.Table(d)};return b(JSON.parse(a))}};var luajs=luajs||{};luajs.stdout={};luajs.stdout.write=function(a){if(console&&console.log){console.log(a)}else{if(trace){trace(a)}}};luajs.stddebug={};luajs.stddebug.write=function(a){};luajs.stderr={};luajs.stderr.write=function(a,b){b=b||"error";if(console&&console[b]){console[b](a)}};