var luajs=luajs||{};luajs.EMPTY_OBJ={};luajs.gc={objects:[],arrays:[],collected:0,reused:0,cacheArray:function(a){a.length=0;this.arrays.push(a);luajs.gc.collected++},cacheObject:function(b){for(var a in b){if(b.hasOwnProperty(a)){delete b[a]}}this.objects.push(b);luajs.gc.collected++},createObject:function(){if(luajs.gc.objects.length){luajs.gc.reused++}return luajs.gc.objects.pop()||{}},createArray:function(){if(luajs.gc.arrays.length){luajs.gc.reused++}return luajs.gc.arrays.pop()||[]},decrRef:function(a){if(!a||!(a instanceof luajs.Table)||a.__luajs.refCount===undefined){return}if(--a.__luajs.refCount==0){this.collect(a)}},incrRef:function(a){if(!a||!(a instanceof luajs.Table)||a.__luajs.refCount===undefined){return}a.__luajs.refCount++},collect:function(d){if(d===undefined||d===null){return}if(d instanceof Array){return this.cacheArray(d)}if(typeof d=="object"&&d.constructor==Object){return this.cacheObject(d)}if(!(d instanceof luajs.Table)||d.__luajs.refCount===undefined){return}var b,a,c=d.__luajs;for(b=0,a=c.values.length;b<a;b++){this.decrRef(c.values[b])}for(b=0,a=c.numValues.length;b<a;b++){this.decrRef(c.numValues[b])}this.cacheArray(c.keys);this.cacheArray(c.values);delete c.keys;delete c.values;this.cacheObject(c);delete d.__luajs;for(b in d){if(d.hasOwnProperty(b)){this.decrRef(d[b])}}}};var luajs=luajs||{};luajs.EventEmitter=function(){this._listeners={}};luajs.EventEmitter.prototype._trigger=function(b,e){var d=this._listeners[b],a,c;if(!d){return}if(!((e||luajs.EMPTY_OBJ) instanceof Array)){e=[e]}for(c in d){if(d.hasOwnProperty(c)){a=d[c].apply(this,e);if(a!==undefined&&!a){break}}}};luajs.EventEmitter.prototype.bind=function(a,b){if(!this._listeners[a]){this._listeners[a]=[]}this._listeners[a].push(b)};luajs.EventEmitter.prototype.unbind=function(a,c){for(var b in this._listeners[a]){if(this._listeners[a].hasOwnProperty(b)&&this._listeners[a][b]===c){this._listeners[a].splice(b,1)}}};var luajs=luajs||{};luajs.VM=function(a){luajs.EventEmitter.call(this);this._files=[];this._env=a||{};this._coroutineStack=[];this._resetGlobals()};luajs.VM.prototype=new luajs.EventEmitter();luajs.VM.prototype.constructor=luajs.VM;luajs.VM.prototype._resetGlobals=function(){this._globals=this._bindLib(luajs.lib);for(var a in this._globals){if(this._globals.hasOwnProperty(a)&&this._globals[a] instanceof luajs.Table){this._globals["package"].loaded[a]=this._globals[a]}}this._globals["package"].loaded._G=this._globals;for(var a in this._env){if(this._env.hasOwnProperty(a)){this._globals[a]=this._env[a]}}};luajs.VM.prototype._bindLib=function(c){var a=luajs.gc.createObject();for(var b in c){if(c.hasOwnProperty(b)){if(c[b]&&c[b].constructor===Object){a[b]=this._bindLib(c[b])}else{if(typeof c[b]=="function"){a[b]=(function(e,d){return function(){return e.apply(d,arguments)}})(c[b],this)}else{a[b]=c[b]}}}}return new luajs.Table(a)};luajs.VM.prototype.load=function(b,e,a){var d=this,c;switch(typeof b){case"string":c=new luajs.File(b);this._files.push(c);c.bind("loaded",function(f){d._trigger("loaded-file",c);if(e||e===undefined){d.execute(a,c)}});this._trigger("loading-file",c);c.load();break;case"object":c=new luajs.File();c.data=b;if(e||e===undefined){d.execute(a,c)}break;default:console.warn("Object of unknown type passed to luajs.VM.load()")}};luajs.VM.prototype.execute=function(j,b){var h=this,a=b?[b]:this._files,d,b,g;if(!a.length){throw new Error("No files loaded.")}for(d in a){if(a.hasOwnProperty(d)){b=a[d];if(!b.data){throw new Error("Tried to execute file before data loaded.")}g=this._thread=new luajs.Function(this,b,b.data,this._globals);this._trigger("executing",[g,j]);try{if(!j){g.call()}else{var i=luajs.lib.coroutine.wrap(g),c=function(){i();if(j.uiOnly&&i._coroutine.status!="dead"){window.setTimeout(c,1)}};c()}}catch(f){luajs.Error.catchExecutionError(f)}}}};luajs.VM.prototype.setGlobal=function(a,b){this._globals[a]=b};luajs.VM.prototype.dispose=function(){var a;for(var b in this._files){if(this._files.hasOwnProperty(b)){this._files[b].dispose()}}if(a=this._thread){a.dispose()}delete this._files;delete this._thread;delete this._globals;delete this._env;delete this._coroutineStack;while(luajs.Function._instances.length){luajs.Function._instances.dispose(true)}luajs.Closure._graveyard.splice(0,luajs.Closure._graveyard.length);luajs.Coroutine._graveyard.splice(0,luajs.Coroutine._graveyard.length)};luajs.Register=function(){luajs.Register.count++;this._register=luajs.gc.createArray()};luajs.Register.count=0;luajs.Register._graveyard=[];luajs.Register.create=function(){var a=luajs.Register._graveyard.pop();return a||new luajs.Register(arguments)};luajs.Register.prototype.getLength=function(){return this._register.length};luajs.Register.prototype.getItem=function(a){return this._register[a]};luajs.Register.prototype.setItem=function(a,c){var b=this._register[a];luajs.gc.decrRef(b);b=this._register[a]=c;luajs.gc.incrRef(b)};luajs.Register.prototype.set=function(a){for(var c=0,b=a.length;c<b;c++){this.setItem(c,a[c])}};luajs.Register.prototype.push=function(){this._register.push.apply(this._register,arguments)};luajs.Register.prototype.splice=function(){this._register.splice.apply(this._register,arguments)};luajs.Register.prototype.reset=function(){for(var b=0,a=this._register.length;b<a;b++){luajs.gc.decrRef(this._register[b])}this._register.length=0};luajs.Register.prototype.clearItem=function(a){delete this._register[a]};luajs.Register.prototype.dispose=function(a){this._register.reset();this.constructor._graveyard.push(this)};var luajs=luajs||{};luajs.Closure=function(c,b,f,e,g){var d=this;this._vm=c;this._globals=e;this._file=b;this._data=f;this._upvalues=g||luajs.gc.createObject();this._constants=f.constants;this._functions=f.functions;this._instructions=f.instructions;this._register=this._register||luajs.Register.create();this._pc=0;this._localsUsedAsUpvalues=this._localsUsedAsUpvalues||luajs.gc.createArray();this._funcInstances=this._funcInstances||luajs.gc.createArray();var d=this,a=function(){var j=luajs.gc.createArray();for(var k=0,h=arguments.length;k<h;k++){j.push(arguments[k])}return d.execute(j)};a._instance=this;a.dispose=function(){d.dispose();delete this.dispose};return a};luajs.Closure.prototype={};luajs.Closure.prototype.constructor=luajs.Closure;luajs.Closure._graveyard=[];luajs.Closure.create=function(c,b,e,d,f){var a=luajs.Closure._graveyard.pop();if(a){return luajs.Closure.apply(a,arguments)}else{return new luajs.Closure(c,b,e,d,f)}};luajs.Closure.prototype.execute=function(c){this._pc=0;this._params=luajs.gc.createArray().concat(c);this._register.set(c.splice(0,this._data.paramCount));if(this._data.is_vararg==7){var b=[].concat(c),d=b.length;b=new luajs.Table(b);b.setMember("n",d);this._register.push(b)}try{return this._run()}catch(f){if(!((f||luajs.EMPTY_OBJ) instanceof luajs.Error)){var a=(f.stack||"");f=new luajs.Error("Error in host call: "+f.message);f.stack=a;f.luaStack=a.split("\n")}if(!f.luaStack){f.luaStack=luajs.gc.createArray()}f.luaStack.push("at "+(this._data.sourceName||"function")+(this._data.linePositions?" on line "+this._data.linePositions[this._pc-1]:""));throw f}};luajs.Closure.prototype._run=function(){var d,p,e,m;this.terminated=false;if(luajs.debug.status=="resuming"){if(luajs.debug.resumeStack.length){this._pc--}else{luajs.debug.status="running"}}else{if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="resuming"){if(luajs.Coroutine._running._resumeStack.length){this._pc--}else{luajs.Coroutine._running.status="running";m=luajs.Coroutine._running._yieldVars}}}if(m){var g=(this._pc-1)*4,o=this._instructions[g+1],n=this._instructions[g+2],k=this._instructions[g+3],j=luajs.gc.createArray();for(var h=0,f=m.length;h<f;h++){j.push(m[h])}if(k===0){f=j.length;for(h=0;h<f;h++){this._register.setItem(o+h,j[h])}this._register.splice(o+f)}else{for(h=0;h<k-1;h++){this._register.setItem(o+h,j[h])}}luajs.gc.collect(j)}while(this._instructions[this._pc*4]!==undefined){p=this._data.linePositions&&this._data.linePositions[this._pc];e=this._executeInstruction(this._pc++,p);if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="suspending"){luajs.Coroutine._running._resumeStack.push(this);if(luajs.Coroutine._running._func._instance==this){e=luajs.Coroutine._running._yieldVars;luajs.Coroutine._running.status="suspended";luajs.Coroutine._remove();return e}return}if(luajs.debug.status=="suspending"&&!e){luajs.debug.resumeStack.push(this);return e}if(e!==undefined){this.terminated=true;this.dispose();return e}}this.terminated=true;this.dispose()};luajs.Closure.prototype._executeInstruction=function(c,b){var f=c*4,d=this._instructions[f],h=this.constructor.OPERATIONS[d],a=this._instructions[f+1],g=this._instructions[f+2],e=this._instructions[f+3];if(!h){throw new Error("Operation not implemented! ("+d+")")}return h.call(this,a,g,e)};luajs.Closure.prototype._getConstant=function(a){if(this._constants[a]===null){return}return this._constants[a]};luajs.Closure.prototype.hasRetainedScope=function(){if(this._localsUsedAsUpvalues.length){return true}if(this._upvalues.length){return true}for(var a in this._funcInstances){if(this._funcInstances.hasOwnProperty(a)&&this._funcInstances[a].isRetained()){return true}}return false};luajs.Closure.prototype.dispose=function(a){if(a||!this.hasRetainedScope()){delete this._vm;delete this._globals;delete this._file;delete this._data;delete this._functions;delete this._instructions;delete this._pc;luajs.gc.collect(this._params);delete this._params;delete this._constants;luajs.gc.collect(this._upvalues);delete this._upvalues;this._register.reset();this._funcInstances.length=0;this._localsUsedAsUpvalues.length=0;luajs.Closure._graveyard.push(this)}};(function(){function m(N,M){this._register.setItem(N,this._register.getItem(M))}function b(M,N){this._register.setItem(M,this._getConstant(N))}function q(N,M,O){this._register.setItem(N,!!M);if(O){this._pc++}}function I(N,M){for(var O=N;O<=M;O++){this._register.setItem(O,undefined)}}function B(N,M){if(this._upvalues[M]===undefined){return}this._register.setItem(N,this._upvalues[M].getValue())}function i(N,M){if(this._getConstant(M)=="_G"){this._register.setItem(N,new luajs.Table(this._globals))}else{if(this._globals[this._getConstant(M)]!==undefined){this._register.setItem(N,this._globals[this._getConstant(M)])}else{this._register.setItem(N,undefined)}}}function x(N,M,O){O=(O>=256)?this._getConstant(O-256):this._register.getItem(O);if(this._register.getItem(M)===undefined){throw new luajs.Error("Attempt to index a nil value ("+O+" not present in nil)")}else{if((this._register.getItem(M)||luajs.EMPTY_OBJ) instanceof luajs.Table){this._register.setItem(N,this._register.getItem(M).getMember(O))}else{if(typeof this._register.getItem(M)=="string"&&luajs.lib.string[O]){this._register.setItem(N,luajs.lib.string[O])}else{this._register.setItem(N,this._register.getItem(M)[O])}}}}function l(N,M){var Q=this._getConstant(M),O=this._globals[Q],P=this._register.getItem(N);this._globals[Q]=P;luajs.gc.decrRef(O);luajs.gc.incrRef(P)}function z(N,M){this._upvalues[M].setValue(this._register.getItem(N))}function v(N,M,O){M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);O=(O>=256)?this._getConstant(O-256):this._register.getItem(O);if((this._register.getItem(N)||luajs.EMPTY_OBJ) instanceof luajs.Table){this._register.getItem(N).setMember(M,O)}else{if(this._register.getItem(N)===undefined){throw new luajs.Error("Attempt to index a missing field (can't set \""+M+'" on a nil value)')}else{this._register.getItem(N)[M]=O}}}function D(N,M,P){var O=new luajs.Table();O.__luajs.refCount=0;this._register.setItem(N,O)}function k(N,M,O){O=(O>=256)?this._getConstant(O-256):this._register.getItem(O);this._register.setItem(N+1,this._register.getItem(M));if(this._register.getItem(M)===undefined){throw new luajs.Error("Attempt to index a nil value ("+O+" not present in nil)")}else{if((this._register.getItem(M)||luajs.EMPTY_OBJ) instanceof luajs.Table){this._register.setItem(N,this._register.getItem(M).getMember(O))}else{if(typeof this._register.getItem(M)=="string"&&luajs.lib.string[O]){this._register.setItem(N,luajs.lib.string[O])}else{this._register.setItem(N,this._register.getItem(M)[O])}}}}function g(N,M,T){M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);T=(T>=256)?this._getConstant(T-256):this._register.getItem(T);var P=luajs.utils.coerce,O,Q,R,S;if(((M||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=M.__luajs.metatable)&&(Q=O.getMember("__add")))||((T||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=T.__luajs.metatable)&&(Q=O.getMember("__add")))){this._register.setItem(N,Q.apply(null,[M,T],true)[0])}else{M=P(M,"number","attempt to perform arithmetic on a non-numeric value");T=P(T,"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,M+T)}}function r(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);R=(R>=256)?this._getConstant(R-256):this._register.getItem(R);var P=luajs.utils.coerce,O,Q;if(((M||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=M.__luajs.metatable)&&(Q=O.getMember("__sub")))||((R||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=R.__luajs.metatable)&&(Q=O.getMember("__sub")))){this._register.setItem(N,Q.apply(null,[M,R],true)[0])}else{M=P(M,"number","attempt to perform arithmetic on a non-numeric value");R=P(R,"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,M-R)}}function d(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);R=(R>=256)?this._getConstant(R-256):this._register.getItem(R);var P=luajs.utils.coerce,O,Q;if(((M||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=M.__luajs.metatable)&&(Q=O.getMember("__mul")))||((R||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=R.__luajs.metatable)&&(Q=O.getMember("__mul")))){this._register.setItem(N,Q.apply(null,[M,R],true)[0])}else{M=P(M,"number","attempt to perform arithmetic on a non-numeric value");R=P(R,"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,M*R)}}function H(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);R=(R>=256)?this._getConstant(R-256):this._register.getItem(R);var P=luajs.utils.coerce,O,Q;if(((M||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=M.__luajs.metatable)&&(Q=O.getMember("__div")))||((R||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=R.__luajs.metatable)&&(Q=O.getMember("__div")))){this._register.setItem(N,Q.apply(null,[M,R],true)[0])}else{M=P(M,"number","attempt to perform arithmetic on a non-numeric value");R=P(R,"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,M/R)}}function h(O,N,T){N=(N>=256)?this._getConstant(N-256):this._register.getItem(N);T=(T>=256)?this._getConstant(T-256):this._register.getItem(T);var Q=luajs.utils.coerce,P,S,M,R;if(((N||luajs.EMPTY_OBJ) instanceof luajs.Table&&(P=N.__luajs.metatable)&&(S=P.getMember("__mod")))||((T||luajs.EMPTY_OBJ) instanceof luajs.Table&&(P=T.__luajs.metatable)&&(S=P.getMember("__mod")))){this._register.setItem(O,S.apply(null,[N,T],true)[0])}else{N=Q(N,"number","attempt to perform arithmetic on a non-numeric value");T=Q(T,"number","attempt to perform arithmetic on a non-numeric value");if(T===0||T===-Infinity||T===Infinity||window.isNaN(N)||window.isNaN(T)){M=NaN}else{M=Math.abs(N)%(R=Math.abs(T));if(!(N<0)^!(T<0)){M=R-M}if(T<0){M*=-1}}this._register.setItem(O,M)}}function w(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register.getItem(M);R=(R>=256)?this._getConstant(R-256):this._register.getItem(R);var P=luajs.utils.coerce,O,Q;if(((M||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=M.__luajs.metatable)&&(Q=O.getMember("__pow")))||((R||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=R.__luajs.metatable)&&(Q=O.getMember("__pow")))){this._register.setItem(N,Q.apply(null,[M,R],true)[0])}else{M=P(M,"number","attempt to perform arithmetic on a non-numeric value");R=P(R,"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,Math.pow(M,R))}}function o(N,M){var O,P;if((this._register.getItem(M)||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=this._register.getItem(M).__luajs.metatable)&&(P=O.getMember("__unm"))){this._register.setItem(N,P.apply(null,[this._register.getItem(M)],true)[0])}else{M=luajs.utils.coerce(this._register.getItem(M),"number","attempt to perform arithmetic on a non-numeric value");this._register.setItem(N,-M)}}function F(N,M){this._register.setItem(N,!this._register.getItem(M))}function n(N,M){var P=0;if((this._register.getItem(M)||luajs.EMPTY_OBJ) instanceof luajs.Table){this._register.setItem(N,luajs.lib.table.getn(this._register.getItem(M)))}else{if(typeof this._register.getItem(M)=="object"){for(var O in this._register.getItem(M)){if(this._register.getItem(M).hasOwnProperty(O)){P++}}this._register.setItem(N,P)}else{if(this._register.getItem(M)==undefined){throw new luajs.Error("attempt to get length of a nil value")}else{if(this._register.getItem(M).length===undefined){this._register.setItem(N,undefined)}else{this._register.setItem(N,this._register.getItem(M).length)}}}}}function u(N,M,S){var R=this._register.getItem(S),O,Q;for(var P=S-1;P>=M;P--){if(((this._register.getItem(P)||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=this._register.getItem(P).__luajs.metatable)&&(Q=O.getMember("__concat")))||((R||luajs.EMPTY_OBJ) instanceof luajs.Table&&(O=R.__luajs.metatable)&&(Q=O.getMember("__concat")))){R=Q.apply(null,[this._register.getItem(P),R],true)[0]}else{if(!(typeof this._register.getItem(P)==="string"||typeof this._register.getItem(P)==="number")||!(typeof R==="string"||typeof R==="number")){throw new luajs.Error("Attempt to concatenate a non-string or non-numeric value")}R=this._register.getItem(P)+R}}this._register.setItem(N,R)}function J(N,M){this._pc+=M}function G(O,N,S){N=(N>=256)?this._getConstant(N-256):this._register.getItem(N);S=(S>=256)?this._getConstant(S-256):this._register.getItem(S);var Q,P,R,M;if(N!==S&&(N||luajs.EMPTY_OBJ) instanceof luajs.Table&&(S||luajs.EMPTY_OBJ) instanceof luajs.Table&&(Q=N.__luajs.metatable)&&(P=S.__luajs.metatable)&&Q===P&&(R=Q.getMember("__eq"))){M=!!R.apply(null,[N,S],true)[0]}else{M=(N===S)}if(M!=O){this._pc++}}function t(T,S,Q){S=(S>=256)?this._getConstant(S-256):this._register.getItem(S);Q=(Q>=256)?this._getConstant(Q-256):this._register.getItem(Q);var R=(typeof S!="object"&&typeof S)||((S||luajs.EMPTY_OBJ) instanceof luajs.Table&&"table")||"userdata",P=(typeof Q!="object"&&typeof S)||((Q||luajs.EMPTY_OBJ) instanceof luajs.Table&&"table")||"userdata",O,U,N,M;if(R!==P){throw new luajs.Error("attempt to compare "+R+" with "+P)}else{if(R=="table"){if((N=S.__luajs.metatable)&&(M=Q.__luajs.metatable)&&N===M&&(O=N.getMember("__lt"))){U=O.apply(null,[S,Q],true)[0]}else{throw new luajs.Error("attempt to compare two table values")}}else{U=(S<Q)}}if(U!=T){this._pc++}}function C(T,S,Q){S=(S>=256)?this._getConstant(S-256):this._register.getItem(S);Q=(Q>=256)?this._getConstant(Q-256):this._register.getItem(Q);var R=(typeof S!="object"&&typeof S)||((S||luajs.EMPTY_OBJ) instanceof luajs.Table&&"table")||"userdata",P=(typeof Q!="object"&&typeof S)||((Q||luajs.EMPTY_OBJ) instanceof luajs.Table&&"table")||"userdata",O,U,N,M;if(R!==P){throw new luajs.Error("attempt to compare "+R+" with "+P)}else{if(R=="table"){if((N=S.__luajs.metatable)&&(M=Q.__luajs.metatable)&&N===M&&(O=N.getMember("__le"))){U=O.apply(null,[S,Q],true)[0]}else{throw new luajs.Error("attempt to compare two table values")}}else{U=(S<=Q)}}if(U!=T){this._pc++}}function j(N,M,O){if(this._register.getItem(N)===0||this._register.getItem(N)===""){if(!O){this._pc++}}else{if(!this._register.getItem(N)!==!O){this._pc++}}}function e(N,M,O){if(!this._register.getItem(M)!==!O){this._register.setItem(N,this._register.getItem(M))}else{this._pc++}}function c(W,V,U){var T=luajs.gc.createArray(),Q,O,R,P,S,N,M;if(luajs.debug.status=="resuming"){P=luajs.debug.resumeStack.pop();if((P||luajs.EMPTY_OBJ) instanceof luajs.Coroutine){R=P.resume()}else{R=P._run()}}else{if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="resuming"){P=luajs.Coroutine._running._resumeStack.pop();R=P._run()}else{if(V===0){O=this._register.getLength();for(Q=W+1;Q<O;Q++){T.push(this._register.getItem(Q))}}else{for(Q=0;Q<V-1;Q++){T.push(this._register.getItem(W+Q+1))}}}}if(!P){N=this._register.getItem(W);if((N||luajs.EMPTY_OBJ) instanceof luajs.Function){R=N.apply(null,T,true)}else{if(N&&N.apply){R=N.apply(null,T)}else{if(N&&(N||luajs.EMPTY_OBJ) instanceof luajs.Table&&(M=N.__luajs.metatable)&&(S=M.getMember("__call"))&&S.apply){T.unshift(N);R=S.apply(null,T,true)}else{throw new luajs.Error("Attempt to call non-function")}}}}luajs.gc.collect(T);if(!((R||luajs.EMPTY_OBJ) instanceof Array)){R=[R]}if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="suspending"){return}if(U===0){O=R.length;for(Q=0;Q<O;Q++){this._register.setItem(W+Q,R[Q])}this._register.splice(W+O)}else{for(Q=0;Q<U-1;Q++){this._register.setItem(W+Q,R[Q])}}}function L(N,M){return c.call(this,N,M,0)}function y(O,M){var P=luajs.gc.createArray(),R,Q,N;if(M===0){N=this._register.getLength();for(Q=O;Q<N;Q++){P.push(this._register.getItem(Q))}}else{for(Q=0;Q<M-1;Q++){P.push(R=this._register.getItem(O+Q));luajs.gc.incrRef(R)}}E.call(this,0);this.dead=true;return P}function p(N,M){this._register.setItem(N,this._register.getItem(N)+this._register.getItem(N+2));var O=this._register.getItem(N+2)/Math.abs(this._register.getItem(N+2));if((O===1&&this._register.getItem(N)<=this._register.getItem(N+1))||(O!==1&&this._register.getItem(N)>=this._register.getItem(N+1))){this._register.setItem(N+3,this._register.getItem(N));this._pc+=M}}function K(N,M){this._register.setItem(N,this._register.getItem(N)-this._register.getItem(N+2));this._pc+=M}function s(N,M,S){var Q=[this._register.getItem(N+1),this._register.getItem(N+2)],O=this._register.getItem(N).apply(null,Q),P;if(!((O||luajs.EMPTY_OBJ) instanceof Array)){O=[O]}if(O[0]&&O[0]===""+(P=parseInt(O[0],10))){O[0]=P}for(var R=0;R<S;R++){this._register.setItem(N+R+3,O[R])}if(this._register.getItem(N+3)!==undefined){this._register.setItem(N+2,this._register.getItem(N+3))}else{this._pc++}}function f(N,M,Q){var P=M||this._register.getLength()-N-1,O;for(O=0;O<P;O++){this._register.getItem(N).setMember(50*(Q-1)+O+1,this._register.getItem(N+O+1))}}function E(O,M,R){for(var Q=0,N=this._localsUsedAsUpvalues.length;Q<N;Q++){var P=this._localsUsedAsUpvalues[Q];if(P&&P.registerIndex>=O){P.upvalue.value=this._register.getItem(P.registerIndex);P.upvalue.open=false;this._localsUsedAsUpvalues.splice(Q--,1);N--;this._register.clearItem(P.registerIndex)}}}function a(M,Q){var O=this,R=luajs.gc.createArray(),P;while((P=this._instructions[this._pc*4])!==undefined&&(P===0||P===4)&&this._instructions[this._pc*4+1]===0){(function(){var Z=P,W=O._pc*4,U=O._instructions[W+1],T=O._instructions[W+2],S=O._instructions[W+3],aa;if(Z===0){for(var X=0,V=O._localsUsedAsUpvalues.length;X<V;X++){var Y=O._localsUsedAsUpvalues[X];if(Y.registerIndex===T){aa=Y.upvalue;break}}if(!aa){aa={open:true,getValue:function(){return this.open?O._register.getItem(T):this.value},setValue:function(ab){this.open?O._register.setItem(T,ab):this.value=ab},name:O._functions[Q].upvalues[R.length]};O._localsUsedAsUpvalues.push({registerIndex:T,upvalue:aa})}R.push(aa)}else{R.push({getValue:function(){return O._upvalues[T].getValue()},setValue:function(ab){O._upvalues[T].setValue(ab)},name:O._upvalues[T].name})}})();this._pc++}var N=new luajs.Function(this._vm,this._file,this._functions[Q],this._globals,R);this._register.setItem(M,N)}function A(P,M){var Q,O,N=M===0?this._params.length-this._data.paramCount:M-1;for(Q=0;Q<N;Q++){this._register.setItem(P+Q,this._params[this._data.paramCount+Q])}for(Q=P+N,O=this._register.getLength();Q<O;Q++){this._register.clearItem(Q)}}luajs.Closure.OPERATIONS=[m,b,q,I,B,i,x,l,z,v,D,k,g,r,d,H,h,w,o,F,n,u,J,G,t,C,j,e,c,L,y,p,K,s,f,E,a,A];luajs.Closure.OPERATION_NAMES=["move","loadk","loadbool","loadnil","getupval","getglobal","gettable","setglobal","setupval","settable","newtable","self","add","sub","mul","div","mod","pow","unm","not","len","concat","jmp","eq","lt","le","test","testset","call","tailcall","return","forloop","forprep","tforloop","setlist","close","closure","vararg"]})();var luajs=luajs||{};luajs.Function=function(b,a,d,c,e){this._vm=b;this._file=a;this._data=d;this._globals=c;this._upvalues=e||luajs.gc.createObject();this._index=luajs.Function._index++;this.instances=luajs.gc.createArray();this._retainCount=0;this._convertInstructions();this.constructor._instances.push(this)};luajs.Function.prototype={};luajs.Function.prototype.constructor=luajs.Function;luajs.Function._index=0;luajs.Function._instances=[];luajs.Function.prototype.getInstance=function(){return luajs.Closure.create(this._vm,this._file,this._data,this._globals,this._upvalues)};luajs.Function.prototype._convertInstructions=function(){var c=this._data.instructions,e,b,f,d,a,g;if("ArrayBuffer" in window){if(c instanceof Int32Array){return}e=new ArrayBuffer(c.length*4*4);b=new Int32Array(e);if(c.length==0||c[0].op===undefined){b.set(c);this._data.instructions=b;return}}else{if(c.length==0||c[0].op===undefined){return}b=[]}for(f=0,d=c.length;f<d;f++){a=c[f];g=f*4;b[g]=a.op;b[g+1]=a.A;b[g+2]=a.B;b[g+3]=a.C}this._data.instructions=b};luajs.Function.prototype.call=function(){var b=luajs.gc.createArray(),a=arguments.length,c;for(c=1;c<a;c++){b.push(arguments[c])}return this.apply(b)};luajs.Function.prototype.apply=function(f,b,a){if((f||luajs.EMPTY_OBJ) instanceof Array&&!b){b=f;f=undefined}var c=a?this.getInstance():luajs.lib.coroutine.wrap(this);try{return c.apply(f,b)}catch(d){luajs.Error.catchExecutionError(d)}};luajs.Function.prototype.toString=function(){return"function: 0x"+this._index.toString(16)};luajs.Function.prototype.retain=function(){this._retainCount++};luajs.Function.prototype.release=function(){if(!--this._retainCount&&this._readyToDispose){this.dispose()}};luajs.Function.prototype.isRetained=function(){if(this._retainCount){return true}for(var a in this.instances){if(this.instances.hasOwnProperty(a)&&this.instances[a].hasRetainedScope()){return true}}return false};luajs.Function.prototype.dispose=function(b){this._readyToDispose=true;if(b){for(var a in this.instances){if(this.instances.hasOwnProperty(a)){this.instances[a].dispose(true)}}}else{if(this.isRetained()){return false}}delete this._vm;delete this._file;delete this._data;delete this._globals;delete this._upvalues;delete this.instances;delete this._readyToDispose;this.constructor._instances.splice(this.constructor._instances.indexOf(this),1);return true};var luajs=luajs||{};luajs.Coroutine=function(a){luajs.EventEmitter.call(this);this._func=a.getInstance();this._index=luajs.Coroutine._index++;this._started=false;this._yieldVars=undefined;this._resumeStack=this._resumeStack||luajs.gc.createArray();this.status="suspended";luajs.stddebug.write("[coroutine created]\n")};luajs.Coroutine.prototype=new luajs.EventEmitter();luajs.Coroutine.prototype.constructor=luajs.Function;luajs.Coroutine._index=0;luajs.Coroutine._stack=[];luajs.Coroutine._graveyard=[];luajs.Coroutine.create=function(b){var a=luajs.Coroutine._graveyard.pop();if(a){luajs.Coroutine.apply(a,arguments);return a}else{return new luajs.Coroutine(b)}};luajs.Coroutine._add=function(a){luajs.Coroutine._stack.push(luajs.Coroutine._running);luajs.Coroutine._running=a};luajs.Coroutine._remove=function(){luajs.Coroutine._running=luajs.Coroutine._stack.pop()};luajs.Coroutine.prototype.resume=function(){var b;try{if(this.status=="dead"){throw new luajs.Error("cannot resume dead coroutine")}luajs.Coroutine._add(this);if(luajs.debug.status=="resuming"){var g=luajs.debug.resumeStack.pop();if((g||luajs.EMPTY_OBJ) instanceof luajs.Coroutine){b=g.resume()}else{b=this._func._instance._run()}}else{if(!this._started){this.status="running";luajs.stddebug.write("[coroutine started]\n");this._started=true;b=this._func.apply(null,arguments,true)}else{this.status="resuming";luajs.stddebug.write("[coroutine resuming]\n");var c=luajs.gc.createArray();for(var d=0,a=arguments.length;d<a;d++){c.push(arguments[d])}this._yieldVars=c;b=this._resumeStack.pop()._run()}}if(luajs.debug.status=="suspending"){luajs.debug.resumeStack.push(this);return}this.status=this._func._instance.terminated?"dead":"suspended";if(b){b.unshift(true)}}catch(f){b=[false,f];this.status="dead"}if(this.status=="dead"){luajs.Coroutine._remove();luajs.stddebug.write("[coroutine terminated]\n");this._dispose()}return b};luajs.Coroutine.prototype.toString=function(){return"thread: 0x"+this._index.toString(16)};luajs.Coroutine.prototype._dispose=function(){delete this._func;delete this._index;delete this._listeners;delete this._started;delete this._yieldVars;delete this.status;this._resumeStack.length=0;luajs.Coroutine._graveyard.push(this)};var luajs=luajs||{};luajs.Table=function(g){var d=((g||luajs.EMPTY_OBJ) instanceof Array),f,c,e,b;g=g||luajs.gc.createObject();this.__luajs=f=luajs.gc.createObject();f.type="table";f.index=++luajs.Table.count;f.keys=luajs.gc.createArray();f.values=luajs.gc.createArray();f.numValues=[undefined];for(b in g){if(g.hasOwnProperty(b)){var a;c=d?parseInt(b,10)+1:b;e=g[b];if(typeof getQualifiedClassName!=="undefined"){a=((getQualifiedClassName(e)=="Object")&&(!(e instanceof luajs.Table))&&(!(e instanceof luajs.Coroutine))&&(!(e instanceof luajs.Function))&&(!(e instanceof luajs.Closure)))||(getQualifiedClassName(e)=="Array")}else{a=(typeof e=="object"&&e.constructor===Object)||e instanceof Array}this.setMember(c,a?new luajs.Table(e):e)}}};luajs.Table.count=0;luajs.Table.prototype.getMember=function(c){var b,d;switch(typeof c){case"string":if(this[c]!==undefined){return this[c]}break;case"number":d=this.__luajs.numValues[c];if(d!==undefined){return d}default:b=this.__luajs.keys.indexOf(c);if(b>=0){return this.__luajs.values[b]}}var a=this.__luajs.metatable;if(a&&a.__index){switch(a.__index.constructor){case luajs.Table:return a.__index.getMember(c);case Function:return a.__index(this,c);case luajs.Function:return a.__index.apply(this,[this,c])[0]}}};luajs.Table.prototype.setMember=function(d,f){var a=this.__luajs.metatable,c,e,b;if(this[d]===undefined&&a&&a.__newindex){switch(a.__newindex.constructor){case luajs.Table:return a.__newindex.setMember(d,f);case Function:return a.__newindex(this,d,f);case luajs.Function:return a.__newindex.apply(this,[this,d,f])[0]}}switch(typeof d){case"string":c=this[d];this[d]=f;break;case"number":c=this.__luajs.numValues[d];this.__luajs.numValues[d]=f;break;default:e=this.__luajs.keys;b=e.indexOf(d);if(b<0){b=e.length;e[b]=d}c=this.__luajs.values[b];this.__luajs.values[b]=f}luajs.gc.decrRef(c);luajs.gc.incrRef(f)};luajs.Table.prototype.toString=function(){var a;if(this.constructor!=luajs.Table){return"userdata"}if(this.__luajs&&(a=this.__luajs.metatable)&&a.__tostring){return a.__tostring.call(undefined,this)}return"table: 0x"+this.__luajs.index.toString(16)};var luajs=luajs||{};luajs.Error=function(b){var a=new Error(b);a.constructor=this.constructor;a.__proto__=this;a.name="luajs.Error";return a};luajs.Error.prototype=new Error();luajs.Error.prototype.constructor=luajs.Error;luajs.Error.catchExecutionError=function(a){if(!a){return}if((a||luajs.EMPTY_OBJ) instanceof luajs.Error){if(!a.luaMessage){a.luaMessage=a.message}a.message=a.luaMessage+"\n    "+(a.luaStack||luajs.gc.createArray()).join("\n    ")}throw a};luajs.Error.prototype.toString=function(){return"Luajs Error: "+this.message};var luajs=luajs||{};luajs.File=function(a){luajs.EventEmitter.call(this);this._url=a;this.data=undefined};luajs.File.prototype=new luajs.EventEmitter();luajs.File.prototype.constructor=luajs.File;luajs.File.prototype.load=function(){var b=this;function c(d){b.data=JSON.parse(d);b._trigger("loaded",b.data)}function a(d){b._trigger("error",d)}luajs.utils.get(this._url,c,a)};luajs.File.prototype.loadLua=function(){};luajs.File.prototype.dispose=function(){delete this._url;delete this.data};var luajs=luajs||{};(function(){var b=16807,e=2147483647,d={"([^a-zA-Z0-9%(])-":"$1*?","(.)-([^a-zA-Z0-9?])":"$1*?$2","(.)-$":"$1*?","%a":"[a-zA-Z]","%A":"[^a-zA-Z]","%c":"[\x00-\x1f]","%C":"[^\x00-\x1f]","%d":"\\d","%D":"[^\d]","%l":"[a-z]","%L":"[^a-z]","%p":"[.,\"'?!;:#$%&()*+-/<>=@[]\\^_{}|~]","%P":"[^.,\"'?!;:#$%&()*+-/<>=@[]\\^_{}|~]","%s":"[ \\t\\n\\f\\v\\r]","%S":"[^ \t\n\f\v\r]","%u":"[A-Z]","%U":"[^A-Z]","%w":"[a-zA-Z0-9]","%W":"[^a-zA-Z0-9]","%x":"[a-fA-F0-9]","%X":"[^a-fA-F0-9]","%([^a-zA-Z])":"\\$1"},f=1;function c(){f=(b*f)%e;return f/e}function g(o){o=""+o;var p=0,k,h,m,j;for(k in d){if(d.hasOwnProperty(k)){o=o.replace(new RegExp(k,"g"),d[k])}}h=o.length;for(k=0;k<h;k++){m=o.substr(k,1);j=false;if(m=="["){if(p){j=true}p++}else{if(m=="]"){p--;if(p){j=true}}}if(j){o=o.substr(0,k)+"\\"+o.substr(k++);h++}}return o}function a(h,l){var j=this,i,k;if(h.substr(0,1)!="/"){k=(this._thread._file._url||"").match(/^(.*\/).*?$/);k=(k&&k[1])||"";h=k+h}i=new luajs.File(h);i.bind("loaded",function(n){var m=new luajs.Function(j,i,i.data,j._globals);j._trigger("module-loaded",i,m);l(m)});i.bind("error",function(m){j._trigger("module-load-error",i,m);l()});this._trigger("loading-module",i);i.load()}luajs.lib={assert:function(i,h){if(i===false||i===undefined){throw new luajs.Error(h||"Assertion failed!")}return[i,h]},collectgarbage:function(i,h){},dofile:function(h){},error:function(h){throw new luajs.Error(h)},getfenv:function(h){},getmetatable:function(h){if(!((h||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in getmetatable(). Table expected")}return h.__luajs.metatable},ipairs:function(i){if(!((i||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in ipairs(). Table expected")}var h=function(l,k){if(k===undefined){throw new luajs.Error("Bad argument #2 to ipairs() iterator")}var j=k+1;if(!l.__luajs.numValues.hasOwnProperty(j)){return undefined}return[j,l.__luajs.numValues[j]]};return[h,i,0]},load:function(m,i){var k=new luajs.File,j="",l,h;while((l=m())&&l!=h){j+=(h=l)}k._data=JSON.parse(j);return new luajs.Function(this,k,k._data,this._globals,luajs.gc.createArray())},loadfile:function(i){var h=luajs.lib.coroutine.yield(),j=function(k){h.resume(k)};a.call(this,i,j)},loadstring:function(i,h){var j=function(){return i};return luajs.lib.load.call(this,j,h)},next:function(o,k){var p=(k===undefined),j=o.__luajs.numValues,n,h;if(p||typeof k=="number"){for(n=1,h=j.length;n<h;n++){if(!p){if(n===k){p=true}}else{if(j.hasOwnProperty(n)&&j[n]!==undefined){return[n,j[n]]}}}}for(n in o){if(o.hasOwnProperty(n)&&!(n in luajs.Table.prototype)&&n!=="__luajs"){if(!p){if(n==k){p=true}}else{if(o.hasOwnProperty(n)&&o[n]!==undefined&&(""+n).substr(0,2)!="__"){return[n,o[n]]}}}}for(n in o.__luajs.keys){if(o.__luajs.keys.hasOwnProperty(n)){var m=o.__luajs.keys[n];if(!p){if(m===k){p=true}}else{if(o.__luajs.values[n]!==undefined){return[m,o.__luajs.values[n]]}}}}return luajs.gc.createArray()},pairs:function(h){if(!((h||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in pairs(). Table expected")}return[luajs.lib.next,h]},pcall:function(n){var k=luajs.gc.createArray(),h;for(var m=1,j=arguments.length;m<j;m++){k.push(arguments[m])}try{if(typeof n=="function"){h=n.apply(null,k)}else{if((n||luajs.EMPTY_OBJ) instanceof luajs.Function){h=n.apply(null,k,true)}else{throw new luajs.Error("Attempt to call non-function")}}}catch(o){return[false,o.message]}if(!((h||luajs.EMPTY_OBJ) instanceof Array)){h=[h]}h.unshift(true);return h},print:function(){var j=luajs.gc.createArray(),m;for(var k=0,h=arguments.length;k<h;k++){m=arguments[k];if((m||luajs.EMPTY_OBJ) instanceof luajs.Table){j.push("table: 0x"+m.__luajs.index.toString(16))}else{if((m||luajs.EMPTY_OBJ) instanceof Function){j.push("JavaScript function: "+m.toString())}else{if(m===undefined){j.push("nil")}else{j.push(luajs.lib.tostring(m))}}}}return luajs.stdout.write(j.join("\t"))},rawequal:function(i,h){return(i===h)},rawget:function(i,h){if(!((i||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in rawget(). Table expected")}return i[h]},rawset:function(i,h,j){if(!((i||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in rawset(). Table expected")}if(h==undefined){throw new luajs.Error("Bad argument #2 in rawset(). Nil not allowed")}i[h]=j;return i},require:function(j){var m,k=luajs.lib["package"],i=this,h,n,p,q;function o(r){k.loaded[j]=true;h=r.call(null,j)[0];if(h!==undefined){k.loaded[j]=h}return k.loaded[j]}if(h=k.loaded[j]){return h}if(n=k.preload[j]){return o(n)}p=k.path.replace(/;;/g,";").split(";");m=luajs.lib.coroutine.yield();function l(){q=p.shift();if(!q){m.resume()}else{q=q.replace(/\?/g,j);a.call(i,q,function(r){if(r){m.resume(o(r))}else{l()}})}}l()},select:function(k){var j=luajs.gc.createArray();if(k=="#"){return arguments.length-1}else{if(k=parseInt(k,10)){for(var m=k,h=arguments.length;m<h;m++){j.push(arguments[m])}return j}else{throw new luajs.Error('Bad argument #1 in select(). Number or "#" expected')}}},setmetatable:function(i,h){if(!((i||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in setmetatable(). Table expected")}if(!(h===undefined||(h||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #2 in setmetatable(). Nil or table expected")}luajs.gc.decrRef(i.__luajs.metatable);i.__luajs.metatable=h;luajs.gc.incrRef(h);return i},tonumber:function(i,h){if(i===""){return}i=(""+i).replace(/^\s+|\s+$/g,"");h=h||10;if(h===2&&i.match(/[^01]/)){return}if(h===10&&i.match(/[^0-9e\+\-\.]/)){return}if(h===16&&i.match(/[^0-9A-Fa-f]/)){return}return(h==10)?parseFloat(i):parseInt(i,h)},tostring:function(h){switch(true){case h===undefined:return"nil";case h===Infinity:return"inf";case h===-Infinity:return"-inf";case typeof h=="number"&&window.isNaN(h):return"nan";default:return h.toString()}},type:function(h){var i=typeof(h);switch(i){case"undefined":return"nil";case"number":case"string":case"boolean":case"function":return i;case"object":if(h.constructor===luajs.Table){return"table"}if((h||luajs.EMPTY_OBJ) instanceof luajs.Function){return"function"}return"userdata"}},unpack:function(l,k,h){return luajs.lib.table.unpack(l,k,h)},_VERSION:"Lua 5.1",xpcall:function(j,i){var h,m,k;try{if(typeof j=="function"){h=j.apply()}else{if((j||luajs.EMPTY_OBJ) instanceof luajs.Function){h=j.apply(null,undefined,true)}else{k=true}}m=true}catch(l){h=i.apply(null,undefined,true);if(((h||luajs.EMPTY_OBJ) instanceof Array)){h=h[0]}m=false}if(k){throw new luajs.Error("Attempt to call non-function")}if(!((h||luajs.EMPTY_OBJ) instanceof Array)){h=[h]}h.unshift(m);return h}};luajs.lib.coroutine={create:function(h){return luajs.Coroutine.create(h)},resume:function(h){var k=luajs.gc.createArray();for(var m=1,j=arguments.length;m<j;m++){k.push(arguments[m])}return h.resume.apply(h,k)},running:function(){return luajs.Coroutine._running},status:function(h){return h.status},wrap:function(j){var i=luajs.lib.coroutine.create(j);var h=function(){var n=[i];for(var o=0,k=arguments.length;o<k;o++){n.push(arguments[o])}var m=luajs.lib.coroutine.resume.apply(null,n),p=m.shift();if(p){return m}throw m[0]};h._coroutine=i;return h},yield:function(){if(!luajs.Coroutine._running){throw new luajs.Error("attempt to yield across metamethod/C-call boundary (not in coroutine)")}if(luajs.Coroutine._running.status!="running"){throw new luajs.Error("attempt to yield non-running coroutine in host")}var k=luajs.gc.createArray(),j=luajs.Coroutine._running;for(var m=0,h=arguments.length;m<h;m++){k.push(arguments[m])}j._yieldVars=k;j.status="suspending";return{resume:function(){var o=[j],p,n=arguments.length,q=function(){luajs.lib.coroutine.resume.apply(undefined,o)};for(p=0;p<n;p++){o.push(arguments[p])}if(j.status=="suspending"){window.setTimeout(q,1)}else{q()}}}}};luajs.lib.debug={debug:function(){},getfenv:function(h){},gethook:function(h){},getinfo:function(h,i,j){},getlocal:function(h,j,i){},getmetatable:function(h){},getregistry:function(){},getupvalue:function(i,h){},setfenv:function(h,i){},sethook:function(h,k,i,j){},setlocal:function(h,k,i,j){},setmetatable:function(h,i){},setupvalue:function(i,h,j){},traceback:function(h,i,j){}};luajs.lib.io={write:function(){var k,h,j="";for(var k in arguments){if(arguments.hasOwnProperty(k)){var h=arguments[k];if(["string","number"].indexOf(typeof h)==-1){throw new luajs.Error("bad argument #"+k+" to 'write' (string expected, got "+typeof h+")")}j+=h}}luajs.stdout.write(j)}};luajs.lib.math={abs:function(h){return Math.abs(h)},acos:function(h){return Math.acos(h)},asin:function(h){return Math.asin(h)},atan:function(h){return Math.atan(h)},atan2:function(i,h){return Math.atan2(i,h)},ceil:function(h){return Math.ceil(h)},cos:function(h){return Math.cos(h)},cosh:function(h){},deg:function(h){return h*180/Math.PI},exp:function(h){return Math.exp(h)},floor:function(h){return Math.floor(h)},fmod:function(h,i){return h%i},frexp:function(h,i){},huge:Infinity,ldexp:function(h,i){return h*Math.pow(2,i)},log:function(i,j){var h=Math.log(i);if(j!==undefined){return h/Math.log(j)}return h},log10:function(h){return Math.log(h)/Math.log(10)},max:function(){var h=-Infinity,k=arguments.length,j;for(j=0;j<k;j++){if(arguments[j]>h){h=arguments[j]}}return h},min:function(){var j=Infinity,k=arguments.length,h;for(h=0;h<k;h++){if(arguments[h]<j){j=arguments[h]}}return j},modf:function(h){var j=Math.floor(h),i=h-j;return[j,i]},pi:Math.PI,pow:function(h,j){var i=luajs.utils.coerce;h=i(h,"number","bad argument #1 to 'pow' (number expected)");j=i(j,"number","bad argument #2 to 'pow' (number expected)");return Math.pow(h,j)},rad:function(h){h=luajs.utils.coerce(h,"number","bad argument #1 to 'rad' (number expected)");return(Math.PI/180)*h},random:function(i,h){if(i===undefined&&h===undefined){return c()}if(typeof i!=="number"){throw new luajs.Error("bad argument #1 to 'random' (number expected)")}if(h===undefined){h=i;i=1}else{if(typeof h!=="number"){throw new luajs.Error("bad argument #2 to 'random' (number expected)")}}if(i>h){throw new luajs.Error("bad argument #2 to 'random' (interval is empty)")}return Math.floor(c()*(h-i+1)+i)},randomseed:function(h){if(typeof h!=="number"){throw new luajs.Error("bad argument #1 to 'randomseed' (number expected)")}f=h},sin:function(h){return Math.sin(h)},sinh:function(h){},sqrt:function(h){return Math.sqrt(h)},tan:function(h){return Math.tan(h)},tanh:function(h){}};luajs.lib.os={clock:function(){},date:function(r,m){if(r===undefined){r="%c"}var s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],k=["January","February","March","April","May","June","July","August","September","October","November","December"],h=[31,28,31,30,31,30,31,31,30,31,30,31],p=function(w,i){var u=parseInt(n["%j"](w),10),t=new Date(w.getFullYear(),0,1,12),v=(8-t["get"+q+"Day"]()+i)%7;return("0"+(Math.floor((u-v)/7)+1)).substr(-2)},n={"%a":function(i){return s[i["get"+q+"Day"]()].substr(0,3)},"%A":function(i){return s[i["get"+q+"Day"]()]},"%b":function(i){return k[i["get"+q+"Month"]()].substr(0,3)},"%B":function(i){return k[i["get"+q+"Month"]()]},"%c":function(i){return i["to"+q+"LocaleString"]()},"%d":function(i){return("0"+i["get"+q+"Date"]()).substr(-2)},"%H":function(i){return("0"+i["get"+q+"Hours"]()).substr(-2)},"%I":function(i){return("0"+((i["get"+q+"Hours"]()+11)%12+1)).substr(-2)},"%j":function(w){var u=w["get"+q+"Date"](),t=w["get"+q+"Month"]();for(var v=0;v<t;v++){u+=h[v]}if(t>1&&w["get"+q+"FullYear"]()%4===0){u+=1}return("00"+u).substr(-3)},"%m":function(i){return("0"+(i["get"+q+"Month"]()+1)).substr(-2)},"%M":function(i){return("0"+i["get"+q+"Minutes"]()).substr(-2)},"%p":function(i){return(i["get"+q+"Hours"]()<12)?"AM":"PM"},"%S":function(i){return("0"+i["get"+q+"Seconds"]()).substr(-2)},"%U":function(i){return p(i,0)},"%w":function(i){return""+(i["get"+q+"Day"]())},"%W":function(i){return p(i,1)},"%x":function(i){return n["%m"](i)+"/"+n["%d"](i)+"/"+n["%y"](i)},"%X":function(i){return n["%H"](i)+":"+n["%M"](i)+":"+n["%S"](i)},"%y":function(i){return n["%Y"](i).substr(-2)},"%Y":function(i){return""+i["get"+q+"FullYear"]()},"%Z":function(i){return q?"UTC":i.toString().substr(-4,3)},"%%":function(){return"%"}},q="",l=new Date();if(m){l.setTime(m*1000)}if(r.substr(0,1)==="!"){r=r.substr(1);q="UTC"}if(r==="*t"){var j=function(u){var t=u.getFullYear(),i=new Date(t,0);return(u.getTimezoneOffset()!==i.getTimezoneOffset())};return new luajs.Table({year:parseInt(n["%Y"](l),10),month:parseInt(n["%m"](l),10),day:parseInt(n["%d"](l),10),hour:parseInt(n["%H"](l),10),min:parseInt(n["%M"](l),10),sec:parseInt(n["%S"](l),10),wday:parseInt(n["%w"](l),10)+1,yday:parseInt(n["%j"](l),10),isdst:j(l)})}for(var o in n){if(n.hasOwnProperty(o)&&r.indexOf(o)>=0){r=r.replace(o,n[o](l))}}return r},difftime:function(h,i){return h-i},execute:function(){if(arguments.length){throw new luajs.Error("shell is not available. You should always check first by calling os.execute with no parameters")}return 0},exit:function(){throw"Execution terminated."},getenv:function(){},remove:function(){},rename:function(){},setlocale:function(){},time:function(m){var o;if(!m){o=Date.now?Date.now():new Date().getTime()}else{var i,n,l,h,j,k;if(!(i=m.getMember("day"))){throw new luajs.Error("Field 'day' missing in date table")}if(!(n=m.getMember("month"))){throw new luajs.Error("Field 'month' missing in date table")}if(!(l=m.getMember("year"))){throw new luajs.Error("Field 'year' missing in date table")}h=m.getMember("hour")||12;j=m.getMember("min")||0;k=m.getMember("sec")||0;if(m.getMember("isdst")){h--}o=new Date(l,n-1,i,h,j,k).getTime()}return Math.floor(o/1000)},tmpname:function(){}};luajs.lib["package"]={cpath:undefined,loaded:new luajs.Table(),loadlib:function(i,h){},path:"?.lua.json;?.json;./modules/?.json;./modules/?/?.json;./modules/?/index.json",preload:{},seeall:function(h){}};luajs.lib.string={"byte":function(n,m,l){m=m||1;l=l||m;var h=luajs.gc.createArray(),o=n.length,k;for(k=m;k<=o&&k<=l;k++){h.push(n.charCodeAt(k-1)||undefined)}return h},"char":function(){var h="";for(var k=0,j=arguments.length;k<j;k++){h+=String.fromCharCode(arguments[k])}return h},dump:function(h){return JSON.stringify(h._data)},find:function(m,n,o,k){if(typeof m!="string"&&typeof m!="number"){throw new luajs.Error("bad argument #1 to 'find' (string expected, got "+typeof m+")")}if(typeof n!="string"&&typeof n!="number"){throw new luajs.Error("bad argument #2 to 'find' (string expected, got "+typeof n+")")}m=""+m;o=o||1;var j,l,i,h;if(k===undefined||!k){n=g(n);l=new RegExp(n);j=m.substr(o-1).search(l);if(j<0){return}i=m.substr(o-1).match(l);h=[j+o,j+o+i[0].length-1];i.shift();return h.concat(i)}j=m.indexOf(n,o-1);return(j===-1)?undefined:[j+1,j+n.length]},format:function(i){var h={init:function(){if(typeof arguments=="undefined"){return null}if(arguments.length<1){return null}if(typeof arguments[0]!="string"){return null}if(typeof RegExp=="undefined"){return null}var r=arguments[0];var l=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g);var p=new Array();var t=new Array();var j=0;var q=0;var v=0;var m=0;var s="";var o=null;while(o=l.exec(r)){if(o[9]){j+=1}q=m;v=l.lastIndex-o[0].length;t[t.length]=r.substring(q,v);m=l.lastIndex;p[p.length]={match:o[0],left:o[3]?true:false,sign:o[4]||"",pad:o[5]||" ",min:o[6]||0,precision:o[8],code:o[9]||"%",negative:parseInt(arguments[j])<0?true:false,argument:String(arguments[j])}}t[t.length]=r.substring(m);if(p.length==0){return r}if((arguments.length-1)<j){return null}var k=null,o=null,n=null,u;for(n=0;n<p.length;n++){if(p[n].code=="%"){u="%"}else{if(p[n].code=="b"){p[n].argument=String(Math.abs(parseInt(p[n].argument)).toString(2));u=h.convert(p[n],true)}else{if(p[n].code=="c"){p[n].argument=String(String.fromCharCode(Math.abs(parseInt(p[n].argument))));u=h.convert(p[n],true)}else{if(p[n].code=="d"){p[n].argument=String(Math.abs(parseInt(p[n].argument)));u=h.convert(p[n])}else{if(p[n].code=="f"){p[n].argument=String(Math.abs(parseFloat(p[n].argument)).toFixed(p[n].precision?p[n].precision:6));u=h.convert(p[n])}else{if(p[n].code=="o"){p[n].argument=String(Math.abs(parseInt(p[n].argument)).toString(8));u=h.convert(p[n])}else{if(p[n].code=="s"){p[n].argument=p[n].argument.substring(0,p[n].precision?p[n].precision:p[n].argument.length);u=h.convert(p[n],true)}else{if(p[n].code=="x"){p[n].argument=String(Math.abs(parseInt(p[n].argument)).toString(16));u=h.convert(p[n])}else{if(p[n].code=="X"){p[n].argument=String(Math.abs(parseInt(p[n].argument)).toString(16));u=h.convert(p[n]).toUpperCase()}else{u=p[n].match}}}}}}}}}s+=t[n];s+=u}s+=t[n];return s},convert:function(k,n){if(n){k.sign=""}else{k.sign=k.negative?"-":k.sign}var j=k.min-k.argument.length+1-k.sign.length;var m=new Array(j<0?0:j).join(k.pad);if(!k.left){if(k.pad=="0"||n){return k.sign+m+k.argument}else{return m+k.sign+k.argument}}else{if(k.pad=="0"||n){return k.sign+k.argument+m.replace(/0/g," ")}else{return k.sign+k.argument+m}}}};return h.init.apply(null,arguments)},gmatch:function(i,k){k=g(k);var h=new RegExp(k,"g"),j=(""+i).match(h);return function(){var m=j.shift(),l=new RegExp(h).exec(m);if(m===undefined){return}l.shift();return l.length?l:m}},gsub:function(q,o,l,h){if(typeof q!="string"&&typeof q!="number"){throw new luajs.Error("bad argument #1 to 'gsub' (string expected, got "+typeof q+")")}if(typeof o!="string"&&typeof o!="number"){throw new luajs.Error("bad argument #2 to 'gsub' (string expected, got "+typeof o+")")}if(h!==undefined&&(h=luajs.utils.coerce(h,"number"))===undefined){throw new luajs.Error("bad argument #4 to 'gsub' (number expected, got "+typeof h+")")}q=""+q;o=g(""+o);var m=0,r="",p,k,j,i;while((h===undefined||m<h)&&q&&(j=q.match(o))){if(typeof l=="function"||(l||luajs.EMPTY_OBJ) instanceof luajs.Function){p=l.apply(null,[j[0]],true);if(p instanceof Array){p=p[0]}if(p===undefined){p=j[0]}}else{if((l||luajs.EMPTY_OBJ) instanceof luajs.Table){p=l.getMember(j[0])}else{if(typeof l=="object"){p=l[j]}else{p=(""+l).replace(/%([0-9])/g,function(n,s){return j[s]})}}}if(j[0].length==0&&i===undefined){k=""}else{k=q.split(j[0],1)[0]}i=j[0];r+=k+p;q=q.substr((k+i).length);m++}return[r+q,m]},len:function(h){if(typeof h!="string"&&typeof h!="number"){throw new luajs.Error("bad argument #1 to 'len' (string expected, got "+typeof h+")")}return(""+h).length},lower:function(h){if(typeof h!="string"&&typeof h!="number"){throw new luajs.Error("bad argument #1 to 'lower' (string expected, got "+typeof h+")")}return(""+h).toLowerCase()},match:function(h,j,k){if(typeof h!="string"&&typeof h!="number"){throw new luajs.Error("bad argument #1 to 'match' (string expected, got "+typeof h+")")}if(typeof j!="string"&&typeof j!="number"){throw new luajs.Error("bad argument #2 to 'match' (string expected, got "+typeof j+")")}k=k?k-1:0;h=(""+h).substr(k);var i=h.match(new RegExp(g(j)));if(!i){return}if(!i[1]){return i[0]}i.shift();return i},rep:function(k,l){var h="",j;for(j=0;j<l;j++){h+=k}return h},reverse:function(k){var h="",j;for(j=k.length;j>=0;j--){h+=k.charAt(j)}return h},sub:function(l,k,h){if(typeof l!="string"&&typeof l!="number"){throw new luajs.Error("bad argument #1 to 'sub' (string expected, got "+typeof l+")")}l=""+l;k=k||1;h=h||l.length;if(k>0){k=k-1}else{if(k<0){k=l.length+k}}if(h<0){h=l.length+h+1}return l.substring(k,h)},upper:function(h){return h.toUpperCase()}};luajs.lib.table={concat:function(n,l,m,k){if(!((n||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.concat(). Table expected")}l=l||"";m=m||1;k=k||luajs.lib.table.maxn(n);var h=luajs.gc.createArray().concat(n.__luajs.numValues).splice(m,k-m+1);return h.join(l)},getn:function(o){if(!((o||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.getn(). Table expected")}var p=o.__luajs.numValues,n=luajs.gc.createArray(),l,k=0;for(l in p){if(p.hasOwnProperty(l)){n[l]=true}}while(n[k+1]){k++}if(k>0&&p[k]===undefined){var l=0;while(k-l>1){var h=Math.floor((l+k)/2);if(p[h]===undefined){k=h}else{l=h}}return l}return k},insert:function(j,i,k){if(!((j||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.insert(). Table expected")}if(k==undefined){k=i;i=j.__luajs.numValues.length}var h=j.getMember(i);j.setMember(i,k);if(h){luajs.lib.table.insert(j,i+1,h)}},maxn:function(h){if(!((h||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.maxn(). Table expected")}return h.__luajs.numValues.length-1},remove:function(k,j){if(!((k||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.remove(). Table expected")}var i=luajs.lib.table.getn(k),l=k.__luajs.numValues,h;if(j>i){return}if(j==undefined){j=i}h=l.splice(j,1);while(j<i&&l[j]===undefined){delete l[j++]}return h},sort:function(j,i){if(!((j||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 to 'sort' (table expected)")}var k,h=j.__luajs.numValues;if(i){if(!((i||luajs.EMPTY_OBJ) instanceof luajs.Function)){throw new luajs.Error("Bad argument #2 to 'sort' (function expected)")}k=function(m,l){return i.apply(null,[m,l],true)[0]?-1:1}}else{k=function(m,l){return m<l?-1:1}}h.shift();h.sort(k).unshift(undefined)},unpack:function(m,l,k){if(!((m||luajs.EMPTY_OBJ) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in unpack(). Table expected")}l=l||1;if(k===undefined){k=luajs.lib.table.getn(m)}var n=luajs.gc.createArray(),h;for(h=l;h<=k;h++){n.push(m.getMember(h))}return n}}})();var luajs=luajs||{};luajs.debug={};(function(){var a=/^[-+]?[0-9]*\.?([0-9]+([eE][-+]?[0-9]+)?)?$/;luajs.utils={coerce:function(d,c,b){var e;switch(c){case"boolean":return !(d===false||d===undefined);case"string":return""+d;case"number":if(d===Infinity||d===-Infinity||(typeof d=="number"&&window.isNaN(d))){return d}if((""+d).match(a)){e=parseFloat(d)}if(e===undefined&&b){throw new luajs.Error(b)}return e;default:throw new ReferenceError("Can not coerce to type: "+c)}},toObject:function(g){var f=luajs.lib.table.getn(g)>0,b=luajs.gc["create"+(f?"Array":"Object")](),d=g.__luajs.numValues,e,c=d.length;for(e=1;e<c;e++){b[e-1]=((d[e]||luajs.EMPTY_OBJ) instanceof luajs.Table)?luajs.utils.toObject(d[e]):d[e]}for(e in g){if(g.hasOwnProperty(e)&&!(e in luajs.Table.prototype)&&e!=="__luajs"){b[e]=((g[e]||luajs.EMPTY_OBJ) instanceof luajs.Table)?luajs.utils.toObject(g[e]):g[e]}}return b},parseJSON:function(b){var c=function(e){for(var d in e){if(e.hasOwnProperty(d)){if(typeof e[d]==="object"){e[d]=c(e[d])}else{if(e[d]===null){e[d]=undefined}}}}return new luajs.Table(e)};return c(JSON.parse(b))},get:function(c,e,b){var d=new XMLHttpRequest();d.open("GET",c,true);d.responseType="text";d.onload=function(f){if(this.status==200){if(e){e(this.response)}}else{if(b){b(this.status)}}};d.send(luajs.EMPTY_OBJ)}}})();var luajs=luajs||{};luajs.stdout={};luajs.stdout.write=function(a){if(console&&console.log){console.log(a)}else{if(trace){trace(a)}}};luajs.stddebug={};luajs.stddebug.write=function(a){};luajs.stderr={};luajs.stderr.write=function(a,b){b=b||"error";if(console&&console[b]){console[b](a)}};