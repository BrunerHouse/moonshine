var luajs=luajs||{};luajs.EventEmitter=function(){this._listeners={}};luajs.EventEmitter.prototype._trigger=function(b,e){var d=this._listeners[b],a,c;if(!d){return}if(!((e||{}) instanceof Array)){e=[e]}for(c in d){if(d.hasOwnProperty(c)){a=d[c].apply(this,e);if(a!==undefined&&!a){break}}}};luajs.EventEmitter.prototype.bind=function(a,b){if(!this._listeners[a]){this._listeners[a]=[]}this._listeners[a].push(b)};luajs.EventEmitter.prototype.unbind=function(a,c){for(var b in this._listeners[a]){if(this._listeners[a].hasOwnProperty(b)&&this._listeners[a][b]===c){this._listeners[a].splice(b,1)}}};var luajs=luajs||{};luajs.VM=function(a){luajs.EventEmitter.call(this);this._files=[];this._env=a||{};this._coroutineStack=[];this._resetGlobals()};luajs.VM.prototype=new luajs.EventEmitter();luajs.VM.prototype.constructor=luajs.VM;luajs.VM.prototype._resetGlobals=function(){this._globals={};for(var a in luajs.lib){if(luajs.lib.hasOwnProperty(a)){this._globals[a]=luajs.lib[a]}}for(var a in this._env){if(this._env.hasOwnProperty(a)){this._globals[a]=this._env[a]}}};luajs.VM.prototype.load=function(b,e,a){var d=this,c;switch(typeof b){case"string":c=new luajs.File(b);this._files.push(c);c.bind("loaded",function(f){d._trigger("loaded-file",c);if(e||e===undefined){d.execute(a,c)}});this._trigger("loading-file",c);c.load();break;case"object":c=new luajs.File();c.data=b;if(e||e===undefined){d.execute(a,c)}break;default:console.warn("Object of unknown type passed to luajs.VM.load()")}};luajs.VM.prototype.execute=function(b,c){var g=this,f=c?[c]:this._files,a,c;if(!f.length){throw new Error("No files loaded.")}for(a in f){if(f.hasOwnProperty(a)){c=f[a];if(!c.data){throw new Error("Tried to execute file before data loaded.")}this._thread=new luajs.Function(this,c,c.data,this._globals);this._trigger("executing",[this._thread,b]);try{if(!b){this._thread.call()}else{var i=luajs.lib.coroutine.wrap(this._thread),d=function(){i();if(b.uiOnly&&i._coroutine.status!="dead"){window.setTimeout(d,1)}};d()}}catch(h){luajs.Error.catchExecutionError(h)}}}};luajs.VM.prototype.setGlobal=function(a,b){this._globals[a]=b};luajs.VM.prototype.dispose=function(){var a;for(var b in this._files){if(this._files.hasOwnProperty(b)){this._files[b].dispose()}}if(a=this._thread){a.dispose()}delete this._files;delete this._thread;delete this._globals;delete this._env;delete this._coroutineStack;while(luajs.Function._instances.length){luajs.Function._instances.pop().dispose(true)}luajs.Closure._graveyard.splice(0,luajs.Closure._graveyard.length);luajs.Coroutine._graveyard.splice(0,luajs.Coroutine._graveyard.length)};(function(){var a=function(c){this._data=c};a.prototype.get=function(d,c){return this._data[d][c]};var b=function(f){this._buffer=new ArrayBuffer(f.length*4*4);this._view=new Int32Array(this._buffer);var c,e,d;for(e=0,d=f.length;e<d;e++){var c=f[e];this._view[e*4]=c.op;this._view[e*4+1]=c.A;this._view[e*4+2]=c.B;if(c.C){this._view[e*4+3]=c.C}}};b.prototype.get=function(d,c){switch(c){case"op":return this._view[d*4];case"A":return this._view[d*4+1];case"B":return this._view[d*4+2];case"C":return this._view[d*4+3]}};luajs.InstructionSet=("ArrayBuffer" in window)?b:a})();var luajs=luajs||{};luajs.Closure=function(c,b,f,e,g){var d=this;luajs.EventEmitter.call(this);this._vm=c;this._globals=e;this._file=b;this._data=f;this._upvalues=g||{};this._constants=f.constants;this._functions=f.functions;this._instructions=new luajs.InstructionSet(f.instructions);this._register=[];this._pc=0;this._localsUsedAsUpvalues=[];this._funcInstances=[];var d=this,a=function(){var j=[];for(var k=0,h=arguments.length;k<h;k++){j.push(arguments[k])}return d.execute(j)};a._instance=this;a.dispose=function(){d.dispose();delete this.dispose};return a};luajs.Closure.prototype=new luajs.EventEmitter();luajs.Closure.prototype.constructor=luajs.Closure;luajs.Closure._graveyard=[];luajs.Closure.create=function(c,b,e,d,f){var a=luajs.Closure._graveyard.pop();if(a){return luajs.Closure.apply(a,arguments)}else{return new luajs.Closure(c,b,e,d,f)}};luajs.Closure.prototype.execute=function(c){this._pc=0;this._params=[].concat(c);this._register=[].concat(c.splice(0,this._data.paramCount));if(this._data.is_vararg==7){var b=[].concat(c),d=b.length;b=new luajs.Table(b);b.setMember("n",d);this._register.push(b)}try{return this._run()}catch(f){if(!((f||{}) instanceof luajs.Error)){var a=(f.stack||"");f=new luajs.Error("Error in host call: "+f.message);f.stack=a;f.luaStack=a.split("\n")}if(!f.luaStack){f.luaStack=[]}f.luaStack.push("at "+(this._data.sourceName||"function")+" on line "+this._data.linePositions[this._pc-1]);throw f}};luajs.Closure.prototype._run=function(){var d,o,e,k;this.terminated=false;if(luajs.debug.status=="resuming"){if(luajs.debug.resumeStack.length){this._pc--}else{luajs.debug.status="running"}}else{if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="resuming"){if(luajs.Coroutine._running._resumeStack.length){this._pc--}else{luajs.Coroutine._running.status="running";k=luajs.Coroutine._running._yieldVars}}}if(k){var n=this._instructions.get(this._pc-1,"A"),m=this._instructions.get(this._pc-1,"B"),j=this._instructions.get(this._pc-1,"C"),h=[];for(var g=0,f=k.length;g<f;g++){h.push(k[g])}if(j===0){f=h.length;for(g=0;g<f;g++){this._register[n+g]=h[g]}this._register.splice(n+f)}else{for(g=0;g<j-1;g++){this._register[n+g]=h[g]}}}while(this._instructions.get(this._pc,"op")!==undefined){o=this._data.linePositions[this._pc];e=this._executeInstruction(this._pc++,o);if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="suspending"){luajs.Coroutine._running._resumeStack.push(this);if(luajs.Coroutine._running._func._instance==this){e=luajs.Coroutine._running._yieldVars;luajs.Coroutine._running.status="suspended";luajs.Coroutine._remove();return e}return}if(luajs.debug.status=="suspending"&&!e){luajs.debug.resumeStack.push(this);return e}if(e!==undefined){this.terminated=true;this.dispose();return e}}this.terminated=true;this.dispose()};luajs.Closure.prototype._executeInstruction=function(c,b){var d=this._instructions.get(c,"op"),g=this.constructor.OPERATIONS[d],a=this._instructions.get(c,"A"),f=this._instructions.get(c,"B"),e=this._instructions.get(c,"C");if(!g){throw new Error("Operation not implemented! ("+d+")")}return g.call(this,a,f,e)};luajs.Closure.prototype._getConstant=function(a){if(this._constants[a]===null){return}return this._constants[a]};luajs.Closure.prototype.hasRetainedScope=function(){if(this._localsUsedAsUpvalues.length){return true}if(this._upvalues.length){return true}for(var a in this._funcInstances){if(this._funcInstances.hasOwnProperty(a)&&this._funcInstances[a].isRetained()){return true}}return false};luajs.Closure.prototype.dispose=function(a){if(a||!this.hasRetainedScope()){delete this._vm;delete this._globals;delete this._file;delete this._data;delete this._functions;delete this._instructions;delete this._register;delete this._pc;delete this._funcInstances;delete this._listeners;delete this._params;delete this._constants;delete this._localsUsedAsUpvalues;delete this._upvalues;luajs.Closure._graveyard.push(this)}};(function(){function m(N,M){this._register[N]=this._register[M]}function b(M,N){this._register[M]=this._getConstant(N)}function q(N,M,O){this._register[N]=!!M;if(O){this._pc++}}function I(N,M){for(var O=N;O<=M;O++){this._register[O]=undefined}}function B(N,M){this._register[N]=this._upvalues[M].getValue()}function i(N,M){if(this._getConstant(M)=="_G"){this._register[N]=new luajs.Table(this._globals)}else{if(this._globals[this._getConstant(M)]!==undefined){this._register[N]=this._globals[this._getConstant(M)]}else{this._register[N]=undefined}}}function x(N,M,O){O=(O>=256)?this._getConstant(O-256):this._register[O];if(this._register[M]===undefined){throw new luajs.Error("Attempt to index a nil value ("+O+" not present in nil)")}else{if((this._register[M]||{}) instanceof luajs.Table){this._register[N]=this._register[M].getMember(O)}else{if(typeof this._register[M]=="string"&&luajs.lib.string[O]){this._register[N]=luajs.lib.string[O]}else{this._register[N]=this._register[M][O]}}}}function l(N,M){this._globals[this._getConstant(M)]=this._register[N]}function z(N,M){this._upvalues[M].setValue(this._register[N])}function v(N,M,O){M=(M>=256)?this._getConstant(M-256):this._register[M];O=(O>=256)?this._getConstant(O-256):this._register[O];if((this._register[N]||{}) instanceof luajs.Table){this._register[N].setMember(M,O)}else{if(this._register[N]===undefined){throw new luajs.Error("Attempt to index a missing field (can't set \""+M+'" on a nil value)')}else{this._register[N][M]=O}}}function D(N,M,O){this._register[N]=new luajs.Table()}function k(N,M,O){O=(O>=256)?this._getConstant(O-256):this._register[O];this._register[N+1]=this._register[M];if(this._register[M]===undefined){throw new luajs.Error("Attempt to index a nil value ("+O+" not present in nil)")}else{if((this._register[M]||{}) instanceof luajs.Table){this._register[N]=this._register[M].getMember(O)}else{if(typeof this._register[M]=="string"&&luajs.lib.string[O]){this._register[N]=luajs.lib.string[O]}else{this._register[N]=this._register[M][O]}}}}function g(N,M,T){M=(M>=256)?this._getConstant(M-256):this._register[M];T=(T>=256)?this._getConstant(T-256):this._register[T];var P=luajs.utils.toFloat,O,Q,R,S;if(((M||{}) instanceof luajs.Table&&(O=M.__luajs.metatable)&&(Q=O.getMember("__add")))||((T||{}) instanceof luajs.Table&&(O=T.__luajs.metatable)&&(Q=O.getMember("__add")))){this._register[N]=Q.apply([M,T])[0]}else{if(P(M)===undefined||P(T)===undefined){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[N]=parseFloat(M)+parseFloat(T)}}function r(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register[M];R=(R>=256)?this._getConstant(R-256):this._register[R];var P=luajs.utils.toFloat,O,Q;if(((M||{}) instanceof luajs.Table&&(O=M.__luajs.metatable)&&(Q=O.getMember("__sub")))||((R||{}) instanceof luajs.Table&&(O=R.__luajs.metatable)&&(Q=O.getMember("__sub")))){this._register[N]=Q.apply([M,R])[0]}else{if(P(M)===undefined||P(R)===undefined){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[N]=parseFloat(M)-parseFloat(R)}}function d(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register[M];R=(R>=256)?this._getConstant(R-256):this._register[R];var P=luajs.utils.toFloat,O,Q;if(((M||{}) instanceof luajs.Table&&(O=M.__luajs.metatable)&&(Q=O.getMember("__mul")))||((R||{}) instanceof luajs.Table&&(O=R.__luajs.metatable)&&(Q=O.getMember("__mul")))){this._register[N]=Q.apply([M,R])[0]}else{if(P(M)===undefined||P(R)===undefined){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[N]=parseFloat(M)*parseFloat(R)}}function H(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register[M];R=(R>=256)?this._getConstant(R-256):this._register[R];var P=luajs.utils.toFloat,O,Q;if(((M||{}) instanceof luajs.Table&&(O=M.__luajs.metatable)&&(Q=O.getMember("__div")))||((R||{}) instanceof luajs.Table&&(O=R.__luajs.metatable)&&(Q=O.getMember("__div")))){this._register[N]=Q.apply([M,R])[0]}else{if(P(M)===undefined||P(R)===undefined){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[N]=parseFloat(M)/parseFloat(R)}}function h(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register[M];R=(R>=256)?this._getConstant(R-256):this._register[R];var P=luajs.utils.toFloat,O,Q;if(((M||{}) instanceof luajs.Table&&(O=M.__luajs.metatable)&&(Q=O.getMember("__mod")))||((R||{}) instanceof luajs.Table&&(O=R.__luajs.metatable)&&(Q=O.getMember("__mod")))){this._register[N]=Q.apply([M,R])[0]}else{if(P(M)===undefined||P(R)===undefined){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[N]=parseFloat(M)%parseFloat(R)}}function w(N,M,R){M=(M>=256)?this._getConstant(M-256):this._register[M];R=(R>=256)?this._getConstant(R-256):this._register[R];var P=luajs.utils.toFloat,O,Q;if(((M||{}) instanceof luajs.Table&&(O=M.__luajs.metatable)&&(Q=O.getMember("__pow")))||((R||{}) instanceof luajs.Table&&(O=R.__luajs.metatable)&&(Q=O.getMember("__pow")))){this._register[N]=Q.apply([M,R])[0]}else{if(P(M)===undefined||P(R)===undefined){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[N]=Math.pow(parseFloat(M),parseFloat(R))}}function o(N,M){var O,P;if((this._register[M]||{}) instanceof luajs.Table&&(O=this._register[M].__luajs.metatable)&&(P=O.getMember("__unm"))){this._register[N]=P.apply([this._register[M]])[0]}else{M=this._register[M];if(luajs.utils.toFloat(M)===undefined){throw new luajs.Error("attempt to perform arithmetic on a non-numeric value")}this._register[N]=-parseFloat(M)}}function F(N,M){this._register[N]=!this._register[M]}function n(N,M){var P=0;if((this._register[M]||{}) instanceof luajs.Table){this._register[N]=luajs.lib.table.getn(this._register[M])}else{if(typeof this._register[M]=="object"){for(var O in this._register[M]){if(this._register[M].hasOwnProperty(O)){P++}}this._register[N]=P}else{if(this._register[M]==undefined){throw new luajs.Error("attempt to get length of a nil value")}else{if(this._register[M].length===undefined){this._register[N]=undefined}else{this._register[N]=this._register[M].length}}}}}function u(N,M,S){var R=this._register[S],O,Q;for(var P=S-1;P>=M;P--){if(((this._register[P]||{}) instanceof luajs.Table&&(O=this._register[P].__luajs.metatable)&&(Q=O.getMember("__concat")))||((R||{}) instanceof luajs.Table&&(O=R.__luajs.metatable)&&(Q=O.getMember("__concat")))){R=Q.apply([this._register[P],R])[0]}else{if(!(typeof this._register[P]==="string"||typeof this._register[P]==="number")||!(typeof R==="string"||typeof R==="number")){throw new luajs.Error("Attempt to concatenate a non-string or non-numeric value")}R=this._register[P]+R}}this._register[N]=R}function J(N,M){this._pc+=M}function G(O,N,S){N=(N>=256)?this._getConstant(N-256):this._register[N];S=(S>=256)?this._getConstant(S-256):this._register[S];var Q,P,R,M;if(N!==S&&(N||{}) instanceof luajs.Table&&(S||{}) instanceof luajs.Table&&(Q=N.__luajs.metatable)&&(P=S.__luajs.metatable)&&Q===P&&(R=Q.getMember("__eq"))){M=!!R.apply([N,S])[0]}else{M=(N===S)}if(M!=O){this._pc++}}function t(T,S,Q){S=(S>=256)?this._getConstant(S-256):this._register[S];Q=(Q>=256)?this._getConstant(Q-256):this._register[Q];var R=(typeof S!="object"&&typeof S)||((S||{}) instanceof luajs.Table&&"table")||"userdata",P=(typeof Q!="object"&&typeof S)||((Q||{}) instanceof luajs.Table&&"table")||"userdata",O,U,N,M;if(R!==P){throw new luajs.Error("attempt to compare "+R+" with "+P)}else{if(R=="table"){if((N=S.__luajs.metatable)&&(M=Q.__luajs.metatable)&&N===M&&(O=N.getMember("__lt"))){U=O.apply([S,Q])[0]}else{throw new luajs.Error("attempt to compare two table values")}}else{U=(S<Q)}}if(U!=T){this._pc++}}function C(T,S,Q){S=(S>=256)?this._getConstant(S-256):this._register[S];Q=(Q>=256)?this._getConstant(Q-256):this._register[Q];var R=(typeof S!="object"&&typeof S)||((S||{}) instanceof luajs.Table&&"table")||"userdata",P=(typeof Q!="object"&&typeof S)||((Q||{}) instanceof luajs.Table&&"table")||"userdata",O,U,N,M;if(R!==P){throw new luajs.Error("attempt to compare "+R+" with "+P)}else{if(R=="table"){if((N=S.__luajs.metatable)&&(M=Q.__luajs.metatable)&&N===M&&(O=N.getMember("__le"))){U=O.apply([S,Q])[0]}else{throw new luajs.Error("attempt to compare two table values")}}else{U=(S<=Q)}}if(U!=T){this._pc++}}function j(N,M,O){if(this._register[N]===0||this._register[N]===""){if(!O){this._pc++}}else{if(!this._register[N]!==!O){this._pc++}}}function e(N,M,O){if(!this._register[M]===!O){this._register[N]=this._register[M]}else{this._pc++}}function c(W,V,U){var T=[],Q,O,R,P,S,N,M;if(luajs.debug.status=="resuming"){P=luajs.debug.resumeStack.pop();if((P||{}) instanceof luajs.Coroutine){R=P.resume()}else{R=P._run()}}else{if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="resuming"){P=luajs.Coroutine._running._resumeStack.pop();R=P._run()}else{if(V===0){O=this._register.length;for(Q=W+1;Q<O;Q++){T.push(this._register[Q])}}else{for(Q=0;Q<V-1;Q++){T.push(this._register[W+Q+1])}}}}if(!P){N=this._register[W];if((N||{}) instanceof luajs.Function){R=N.apply({},T,true)}else{if(N&&N.apply){R=N.apply({},T)}else{if(N&&(N||{}) instanceof luajs.Table&&(M=N.__luajs.metatable)&&(S=M.getMember("__call"))&&S.apply){T.unshift(N);R=S.apply({},T,true)}else{throw new luajs.Error("Attempt to call non-function")}}}}if(!((R||{}) instanceof Array)){R=[R]}if(luajs.Coroutine._running&&luajs.Coroutine._running.status=="suspending"){return}if(U===0){O=R.length;for(Q=0;Q<O;Q++){this._register[W+Q]=R[Q]}this._register.splice(W+O)}else{for(Q=0;Q<U-1;Q++){this._register[W+Q]=R[Q]}}}function L(N,M){return c.call(this,N,M,0)}function y(O,M){var P=[],R;if(M===0){N=this._register.length;for(R=O;R<N;R++){P.push(this._register[R])}}else{for(R=0;R<M-1;R++){P.push(this._register[O+R])}}for(var R=0,N=this._localsUsedAsUpvalues.length;R<N;R++){var Q=this._localsUsedAsUpvalues[R];Q.upvalue.value=this._register[Q.registerIndex];Q.upvalue.open=false;this._localsUsedAsUpvalues.splice(R--,1);N--;delete this._register[Q.registerIndex]}this.dead=true;return P}function p(N,M){this._register[N]+=this._register[N+2];var O=this._register[N+2]/Math.abs(this._register[N+2]);if((O===1&&this._register[N]<=this._register[N+1])||(O!==1&&this._register[N]>=this._register[N+1])){this._register[N+3]=this._register[N];this._pc+=M}}function K(N,M){this._register[N]-=this._register[N+2];this._pc+=M}function s(N,M,S){var Q=[this._register[N+1],this._register[N+2]],O=this._register[N].apply({},Q),P;if(!((O||{}) instanceof Array)){O=[O]}if(O[0]&&O[0]===""+(P=parseInt(O[0],10))){O[0]=P}for(var R=0;R<S;R++){this._register[N+R+3]=O[R]}if(this._register[N+3]!==undefined){this._register[N+2]=this._register[N+3]}else{this._pc++}}function f(N,M,Q){var P=M||this._register.length-N-1,O;for(O=0;O<P;O++){this._register[N].setMember(50*(Q-1)+O+1,this._register[N+O+1])}}function E(O,M,R){for(var Q=0,N=this._localsUsedAsUpvalues.length;Q<N;Q++){var P=this._localsUsedAsUpvalues[Q];if(P&&P.registerIndex>=O){P.upvalue.value=this._register[P.registerIndex];P.upvalue.open=false;this._localsUsedAsUpvalues.splice(Q--,1);N--;delete this._register[P.registerIndex]}}}function a(M,Q){var O=this,R=[],P;while((P=this._instructions.get(this._pc,"op"))!==undefined&&(P===0||P===4)&&this._instructions.get(this._pc,"A")===0){(function(){var Y=P,aa=O._pc,U=O._instructions.get(aa,"A"),T=O._instructions.get(aa,"B"),S=O._instructions.get(aa,"C"),Z;if(Y===0){for(var W=0,V=O._localsUsedAsUpvalues.length;W<V;W++){var X=O._localsUsedAsUpvalues[W];if(X.registerIndex===T){Z=X.upvalue;break}}if(!Z){Z={open:true,getValue:function(){return this.open?O._register[T]:this.value},setValue:function(ab){this.open?O._register[T]=ab:this.value=ab},name:O._functions[Q].upvalues[R.length]};O._localsUsedAsUpvalues.push({registerIndex:T,upvalue:Z})}R.push(Z)}else{R.push({getValue:function(){return O._upvalues[T].getValue()},setValue:function(ab){O._upvalues[T].setValue(ab)},name:O._upvalues[T].name})}})();this._pc++}var N=new luajs.Function(this._vm,this._file,this._functions[Q],this._globals,R);this._register[M]=N}function A(O,M){var P,N=M===0?this._params.length-this._data.paramCount:M-1;for(P=0;P<N;P++){this._register[O+P]=this._params[this._data.paramCount+P]}for(P=O+N;P<this._register.length;P++){delete this._register[P]}}luajs.Closure.OPERATIONS=[m,b,q,I,B,i,x,l,z,v,D,k,g,r,d,H,h,w,o,F,n,u,J,G,t,C,j,e,c,L,y,p,K,s,f,E,a,A];luajs.Closure.OPERATION_NAMES=["move","loadk","loadbool","loadnil","getupval","getglobal","gettable","setglobal","setupval","settable","newtable","self","add","sub","mul","div","mod","pow","unm","not","len","concat","jmp","eq","lt","le","test","testset","call","tailcall","return","forloop","forprep","tforloop","setlist","close","closure","vararg"]})();var luajs=luajs||{};luajs.Function=function(b,a,d,c,e){luajs.EventEmitter.call(this);this._vm=b;this._file=a;this._data=d;this._globals=c;this._upvalues=e||{};this._index=luajs.Function._index++;this.instances=[];this._retainCount=0;this.constructor._instances.push(this)};luajs.Function.prototype=new luajs.EventEmitter();luajs.Function.prototype.constructor=luajs.Function;luajs.Function._index=0;luajs.Function._instances=[];luajs.Function.prototype.getInstance=function(){return luajs.Closure.create(this._vm,this._file,this._data,this._globals,this._upvalues)};luajs.Function.prototype.call=function(){var b=[],a=arguments.length,c;for(c=1;c<a;c++){b.push(arguments[c])}return this.apply(b)};luajs.Function.prototype.apply=function(f,b,a){if((f||{}) instanceof Array&&!b){b=f;f=undefined}var c=a?this.getInstance():luajs.lib.coroutine.wrap(this);try{return c.apply(f,b)}catch(d){luajs.Error.catchExecutionError(d)}};luajs.Function.prototype.toString=function(){return"function: 0x"+this._index.toString(16)};luajs.Function.prototype.retain=function(){this._retainCount++};luajs.Function.prototype.release=function(){if(!--this._retainCount&&this._readyToDispose){this.dispose()}};luajs.Function.prototype.isRetained=function(){if(this._retainCount){return true}for(var a in this.instances){if(this.instances.hasOwnProperty(a)&&this.instances[a].hasRetainedScope()){return true}}return false};luajs.Function.prototype.dispose=function(b){this._readyToDispose=true;if(b){for(var a in this.instances){if(this.instances.hasOwnProperty(a)){this.instances[a].dispose(true)}}}else{if(this.isRetained()){return false}}delete this._vm;delete this._file;delete this._data;delete this._globals;delete this._upvalues;delete this._listeners;delete this.instances;delete this._readyToDispose;return true};var luajs=luajs||{};luajs.Coroutine=function(a){luajs.EventEmitter.call(this);this._func=a.getInstance();this._index=luajs.Coroutine._index++;this._started=false;this._yieldVars=undefined;this._resumeStack=[];this.status="suspended";luajs.stddebug.write("[coroutine created]\n")};luajs.Coroutine.prototype=new luajs.EventEmitter();luajs.Coroutine.prototype.constructor=luajs.Function;luajs.Coroutine._index=0;luajs.Coroutine._stack=[];luajs.Coroutine._graveyard=[];luajs.Coroutine.create=function(b){var a=luajs.Coroutine._graveyard.pop();if(a){luajs.Coroutine.apply(a,arguments);return a}else{return new luajs.Coroutine(b)}};luajs.Coroutine._add=function(a){luajs.Coroutine._stack.push(luajs.Coroutine._running);luajs.Coroutine._running=a};luajs.Coroutine._remove=function(){luajs.Coroutine._running=luajs.Coroutine._stack.pop()};luajs.Coroutine.prototype.resume=function(){var b;try{if(this.status=="dead"){throw new luajs.Error("cannot resume dead coroutine")}luajs.Coroutine._add(this);if(luajs.debug.status=="resuming"){var g=luajs.debug.resumeStack.pop();if((g||{}) instanceof luajs.Coroutine){b=g.resume()}else{b=this._func._instance._run()}}else{if(!this._started){this.status="running";luajs.stddebug.write("[coroutine started]\n");this._started=true;b=this._func.apply({},arguments)}else{this.status="resuming";luajs.stddebug.write("[coroutine resuming]\n");var c=[];for(var d=0,a=arguments.length;d<a;d++){c.push(arguments[d])}this._yieldVars=c;b=this._resumeStack.pop()._run()}}if(luajs.debug.status=="suspending"){luajs.debug.resumeStack.push(this);return}this.status=this._func._instance.terminated?"dead":"suspended";if(b){b.unshift(true)}}catch(f){b=[false,f];this.status="dead"}if(this.status=="dead"){luajs.stddebug.write("[coroutine terminated]\n");this._dispose()}return b};luajs.Coroutine.prototype.toString=function(){return"thread: 0x"+this._index.toString(16)};luajs.Coroutine.prototype._dispose=function(){this._resumeStack.splice(0,this._resumeStack.length);luajs.Coroutine._graveyard.push(this)};var luajs=luajs||{};luajs.Table=function(f){var d=((f||{}) instanceof Array),c,e,b;f=f||{};this.__luajs={type:"table",index:++luajs.Table.count,keys:[],values:[],numValues:[undefined]};for(b in f){if(f.hasOwnProperty(b)){var a;c=d?parseInt(b,10)+1:b;e=f[b];if(typeof getQualifiedClassName!=="undefined"){a=((getQualifiedClassName(e)=="Object")&&(!(e instanceof luajs.Table))&&(!(e instanceof luajs.Coroutine))&&(!(e instanceof luajs.Function))&&(!(e instanceof luajs.Closure)))||(getQualifiedClassName(e)=="Array")}else{a=(typeof e=="object"&&e.constructor===Object)||e instanceof Array}this.setMember(c,a?new luajs.Table(e):e)}}};luajs.Table.count=0;luajs.Table.prototype.getMember=function(c){var b,d;switch(typeof c){case"string":if(this[c]!==undefined){return this[c]}break;case"number":d=this.__luajs.numValues[c];if(d!==undefined){return d}default:b=this.__luajs.keys.indexOf(c);if(b>=0){return this.__luajs.values[b]}}var a=this.__luajs.metatable;if(a&&a.__index){switch(a.__index.constructor){case luajs.Table:return a.__index.getMember(c);case Function:return a.__index(this,c);case luajs.Function:return a.__index.apply(this,[this,c])[0]}}};luajs.Table.prototype.setMember=function(c,e){var a=this.__luajs.metatable,d,b;if(this[c]===undefined&&a&&a.__newindex){switch(a.__newindex.constructor){case luajs.Table:return a.__newindex.setMember(c,e);case Function:return a.__newindex(this,c,e);case luajs.Function:return a.__newindex.apply(this,[this,c,e])[0]}}switch(typeof c){case"string":this[c]=e;break;case"number":this.__luajs.numValues[c]=e;break;default:d=this.__luajs.keys;b=d.indexOf(c);if(b<0){b=d.length;d[b]=c}this.__luajs.values[b]=e}};luajs.Table.prototype.toString=function(){var a;if(this.constructor!=luajs.Table){return"userdata"}if(this.__luajs&&(a=this.__luajs.metatable)&&a.__tostring){return a.__tostring.call(undefined,this)}return"table: 0x"+this.__luajs.index.toString(16)};var luajs=luajs||{};luajs.Error=function(b){var a=new Error(b);a.constructor=this.constructor;a.__proto__=this;a.name="luajs.Error";return a};luajs.Error.prototype=new Error();luajs.Error.prototype.constructor=luajs.Error;luajs.Error.catchExecutionError=function(a){if(!a){return}if(a instanceof luajs.Error){a.message=a.message+"\n    "+(a.luaStack||[]).join("\n    ")}throw a};luajs.Error.prototype.toString=function(){return"Luajs Error: "+this.message};var luajs=luajs||{};luajs.File=function(a){luajs.EventEmitter.call(this);this._url=a;this.data=undefined};luajs.File.prototype=new luajs.EventEmitter();luajs.File.prototype.constructor=luajs.File;luajs.File.prototype.load=function(){var a=this;jQuery.getJSON(this._url,function(b){a.data=b;a._trigger("loaded",b)})};luajs.File.prototype.loadLua=function(){};luajs.File.prototype.dispose=function(){delete this._url;delete this.data};var luajs=luajs||{};(function(){var a=16807,d=2147483647,c={"([^a-zA-Z0-9%(])-":"$1*?","(.)-([^a-zA-Z0-9?])":"$1*?$2","(.)-$":"$1*?","%a":"[a-zA-Z]","%A":"[^a-zA-Z]","%c":"[\x00-\x1f]","%C":"[^\x00-\x1f]","%d":"\\d","%D":"[^\d]","%l":"[a-z]","%L":"[^a-z]","%p":"[.,\"'?!;:#$%&()*+-/<>=@[]\\^_{}|~]","%P":"[^.,\"'?!;:#$%&()*+-/<>=@[]\\^_{}|~]","%s":"[ \\t\\n\\f\\v\\r]","%S":"[^ \t\n\f\v\r]","%u":"[A-Z]","%U":"[^A-Z]","%w":"[a-zA-Z0-9]","%W":"[^a-zA-Z0-9]","%x":"[a-fA-F0-9]","%X":"[^a-fA-F0-9]","%([^a-zA-Z])":"\\$1"},e=1;function b(){e=(a*e)%d;return e/d}function f(m){m=""+m;var o=0,j,g,k,h;for(j in c){if(c.hasOwnProperty(j)){m=m.replace(new RegExp(j,"g"),c[j])}}g=m.length;for(j=0;j<g;j++){k=m.substr(j,1);h=false;if(k=="["){if(o){h=true}o++}else{if(k=="]"){o--;if(o){h=true}}}if(h){m=m.substr(0,j)+"\\"+m.substr(j++);g++}}return m}luajs.lib={assert:function(h,g){if(h===false||h===undefined){throw new luajs.Error(g||"Assertion failed!")}return[h,g]},collectgarbage:function(h,g){},dofile:function(g){},error:function(g){throw new luajs.Error(g)},getfenv:function(g){},getmetatable:function(g){if(!((g||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in getmetatable(). Table expected")}return g.__luajs.metatable},ipairs:function(h){if(!((h||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in ipairs(). Table expected")}var g=function(k,j){if(j===undefined){throw new luajs.Error("Bad argument #2 to ipairs() iterator")}var i=j+1;if(!k.__luajs.numValues.hasOwnProperty(i)){return undefined}return[i,k.__luajs.numValues[i]]};return[g,h,0]},load:function(h,g){return[undefined,"Unimplemented"]},loadfile:function(g){return[undefined,"Unimplemented"]},loadstring:function(h,g){return[undefined,"Unimplemented"]},next:function(n,j){var o=(j===undefined),h=n.__luajs.numValues,m,g;if(o||typeof j=="number"){for(m=1,g=h.length;m<g;m++){if(!o){if(m===j){o=true}}else{if(h.hasOwnProperty(m)&&h[m]!==undefined){return[m,h[m]]}}}}for(m in n){if(n.hasOwnProperty(m)&&!(m in luajs.Table.prototype)&&m!=="__luajs"){if(!o){if(m==j){o=true}}else{if(n.hasOwnProperty(m)&&n[m]!==undefined&&(""+m).substr(0,2)!="__"){return[m,n[m]]}}}}for(m in n.__luajs.keys){if(n.__luajs.keys.hasOwnProperty(m)){var k=n.__luajs.keys[m];if(!o){if(k===j){o=true}}else{if(n.__luajs.values[m]!==undefined){return[k,n.__luajs.values[m]]}}}}return[]},pairs:function(g){if(!((g||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in pairs(). Table expected")}return[luajs.lib.next,g]},pcall:function(m){var j=[],g;for(var k=1,h=arguments.length;k<h;k++){j.push(arguments[k])}try{if(typeof m=="function"){g=m.apply({},j)}else{if((m||{}) instanceof luajs.Function){g=m.apply(j)}else{throw new luajs.Error("Attempt to call non-function")}}}catch(n){return[false,n.message]}if(!((g||{}) instanceof Array)){g=[g]}g.unshift(true);return g},print:function(){var h=[],k;for(var j=0,g=arguments.length;j<g;j++){k=arguments[j];if((k||{}) instanceof luajs.Table){h.push("table: 0x"+k.__luajs.index.toString(16))}else{if((k||{}) instanceof Function){h.push("JavaScript function: "+k.toString())}else{if(k===undefined){h.push("nil")}else{h.push(k)}}}}return luajs.stdout.write(h.join("\t"))},rawequal:function(h,g){return(h===g)},rawget:function(h,g){if(!((h||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in rawget(). Table expected")}return h[g]},rawset:function(h,g,i){if(!((h||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in rawset(). Table expected")}if(g==undefined){throw new luajs.Error("Bad argument #2 in rawset(). Nil not allowed")}h[g]=i;return h},select:function(j){var h=[];if(j=="#"){return arguments.length-1}else{if(j=parseInt(j,10)){for(var k=j,g=arguments.length;k<g;k++){h.push(arguments[k])}return h}else{throw new luajs.Error('Bad argument #1 in select(). Number or "#" expected')}}},setmetatable:function(h,g){if(!((h||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in setmetatable(). Table expected")}if(!(g===undefined||(g||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #2 in setmetatable(). Nil or table expected")}h.__luajs.metatable=g;return h},tonumber:function(h,g){if(h===""){return}h=(""+h).replace(/^\s+|\s+$/g,"");g=g||10;if(g===2&&h.match(/[^01]/)){return}if(g===10&&h.match(/[^0-9e\+\-\.]/)){return}if(g===16&&h.match(/[^0-9A-Fa-f]/)){return}return(g==10)?parseFloat(h):parseInt(h,g)},tostring:function(g){switch(true){case g===undefined:return"nil";case g===Infinity:return"inf";case g===-Infinity:return"-inf";case typeof g=="number"&&window.isNaN(g):return"nan";default:return g.toString()}},type:function(g){var h=typeof(g);switch(h){case"undefined":return"nil";case"number":case"string":case"boolean":case"function":return h;case"object":if(g.constructor===luajs.Table){return"table"}if((g||{}) instanceof luajs.Function){return"function"}return"userdata"}},unpack:function(k,h,g){return luajs.lib.table.unpack(k,h,g)},_VERSION:"Lua 5.1",xpcall:function(i,h){var g,k;try{g=i.apply({});k=true}catch(j){g=h.apply({});if(((g||{}) instanceof Array)){g=g[0]}k=false}if(!((g||{}) instanceof Array)){g=[g]}g.unshift(k);return g}};luajs.lib.string={"byte":function(m,l,k){l=l||1;k=k||l;var g=[],n=m.length,h;for(h=l;h<=n&&h<=k;h++){g.push(m.charCodeAt(h-1)||undefined)}return g},"char":function(){var g="";for(var j=0,h=arguments.length;j<h;j++){g+=String.fromCharCode(arguments[j])}return g},dump:function(g){console.log(g);return JSON.stringify(g)},find:function(k,l,m,i){if(typeof k!="string"&&typeof k!="number"){throw new luajs.Error("bad argument #1 to 'find' (string expected, got "+typeof k+")")}if(typeof l!="string"&&typeof l!="number"){throw new luajs.Error("bad argument #2 to 'find' (string expected, got "+typeof l+")")}k=""+k;m=m||1;var h,j,g;if(i===undefined||!i){l=f(l);j=new RegExp(l);h=k.substr(m-1).search(j);if(h<0){return}g=k.substr(m-1).match(j);return[h+m,h+m+g[0].length-1,g[1]]}h=k.indexOf(l,m-1);return(h===-1)?undefined:[h+1,h+l.length]},format:function(h){var g={init:function(){if(typeof arguments=="undefined"){return null}if(arguments.length<1){return null}if(typeof arguments[0]!="string"){return null}if(typeof RegExp=="undefined"){return null}var r=arguments[0];var l=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g);var p=new Array();var t=new Array();var j=0;var q=0;var v=0;var m=0;var s="";var o=null;while(o=l.exec(r)){if(o[9]){j+=1}q=m;v=l.lastIndex-o[0].length;t[t.length]=r.substring(q,v);m=l.lastIndex;p[p.length]={match:o[0],left:o[3]?true:false,sign:o[4]||"",pad:o[5]||" ",min:o[6]||0,precision:o[8],code:o[9]||"%",negative:parseInt(arguments[j])<0?true:false,argument:String(arguments[j])}}t[t.length]=r.substring(m);if(p.length==0){return r}if((arguments.length-1)<j){return null}var k=null,o=null,n=null,u;for(n=0;n<p.length;n++){if(p[n].code=="%"){u="%"}else{if(p[n].code=="b"){p[n].argument=String(Math.abs(parseInt(p[n].argument)).toString(2));u=g.convert(p[n],true)}else{if(p[n].code=="c"){p[n].argument=String(String.fromCharCode(Math.abs(parseInt(p[n].argument))));u=g.convert(p[n],true)}else{if(p[n].code=="d"){p[n].argument=String(Math.abs(parseInt(p[n].argument)));u=g.convert(p[n])}else{if(p[n].code=="f"){p[n].argument=String(Math.abs(parseFloat(p[n].argument)).toFixed(p[n].precision?p[n].precision:6));u=g.convert(p[n])}else{if(p[n].code=="o"){p[n].argument=String(Math.abs(parseInt(p[n].argument)).toString(8));u=g.convert(p[n])}else{if(p[n].code=="s"){p[n].argument=p[n].argument.substring(0,p[n].precision?p[n].precision:p[n].argument.length);u=g.convert(p[n],true)}else{if(p[n].code=="x"){p[n].argument=String(Math.abs(parseInt(p[n].argument)).toString(16));u=g.convert(p[n])}else{if(p[n].code=="X"){p[n].argument=String(Math.abs(parseInt(p[n].argument)).toString(16));u=g.convert(p[n]).toUpperCase()}else{u=p[n].match}}}}}}}}}s+=t[n];s+=u}s+=t[n];return s},convert:function(j,m){if(m){j.sign=""}else{j.sign=j.negative?"-":j.sign}var i=j.min-j.argument.length+1-j.sign.length;var k=new Array(i<0?0:i).join(j.pad);if(!j.left){if(j.pad=="0"||m){return j.sign+k+j.argument}else{return k+j.sign+j.argument}}else{if(j.pad=="0"||m){return j.sign+j.argument+k.replace(/0/g," ")}else{return j.sign+j.argument+k}}}};return g.init.apply({},arguments)},gmatch:function(h,i){i=f(i);var g=new RegExp(i,"g");return function(){var j=g.exec(h),k;if(!j){return}k=j?j.shift():undefined;return j.length?j:k}},gsub:function(p,m,k,h){if(typeof p!="string"&&typeof p!="number"){throw new luajs.Error("bad argument #1 to 'gsub' (string expected, got "+typeof p+")")}if(typeof m!="string"&&typeof m!="number"){throw new luajs.Error("bad argument #2 to 'gsub' (string expected, got "+typeof m+")")}if(h!==undefined&&(h=luajs.utils.toFloat(h))===undefined){throw new luajs.Error("bad argument #4 to 'gsub' (number expected, got "+typeof h+")")}p=""+p;m=f(""+m);var g=new RegExp(m),l=0,q="",o,j,i;while((h===undefined||l<h)&&p&&(i=p.match(m))){if(typeof k=="function"||(k||{}) instanceof luajs.Function){o=k.call({},i[0]);if(o instanceof Array){o=o[0]}if(o===undefined){o=i[0]}}else{if((k||{}) instanceof luajs.Table){o=k.getMember(i[0])}else{if(typeof k=="object"){o=k[i]}else{o=(""+k).replace(/%([0-9])/g,function(n,r){return i[r]})}}}j=p.split(i[0],1)[0];q+=j+o;p=p.substr((j+i[0]).length);l++}return[q+p,l]},len:function(g){if(typeof g!="string"&&typeof g!="number"){throw new luajs.Error("bad argument #1 to 'len' (string expected, got "+typeof g+")")}return(""+g).length},lower:function(g){if(typeof g!="string"&&typeof g!="number"){throw new luajs.Error("bad argument #1 to 'lower' (string expected, got "+typeof g+")")}return(""+g).toLowerCase()},match:function(g,i,j){if(typeof g!="string"&&typeof g!="number"){throw new luajs.Error("bad argument #1 to 'match' (string expected, got "+typeof g+")")}if(typeof i!="string"&&typeof i!="number"){throw new luajs.Error("bad argument #2 to 'match' (string expected, got "+typeof i+")")}j=j?j-1:0;g=(""+g).substr(j);var h=g.match(new RegExp(f(i)));if(!h){return}if(!h[1]){return h[0]}h.shift();return h},rep:function(j,k){var g="",h;for(h=0;h<k;h++){g+=j}return g},reverse:function(j){var g="",h;for(h=j.length;h>=0;h--){g+=j.charAt(h)}return g},sub:function(k,h,g){if(typeof k!="string"&&typeof k!="number"){throw new luajs.Error("bad argument #1 to 'sub' (string expected, got "+typeof k+")")}k=""+k;h=h||1;g=g||k.length;if(h>0){h=h-1}else{if(h<0){h=k.length+h}}if(g<0){g=k.length+g+1}return k.substring(h,g)},upper:function(g){return g.toUpperCase()}};luajs.lib.table={concat:function(m,k,l,h){if(!((m||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.concat(). Table expected")}k=k||"";l=l||1;h=h||luajs.lib.table.maxn(m);var g=[].concat(m.__luajs.numValues).splice(l,h-l+1);return g.join(k)},getn:function(n){if(!((n||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.getn(). Table expected")}var o=n.__luajs.numValues,l=[],k,h=0;for(k in o){if(o.hasOwnProperty(k)){l[k]=true}}while(l[h+1]){h++}if(h>0&&o[h]===undefined){var k=0;while(h-k>1){var g=Math.floor((k+h)/2);if(o[g]===undefined){h=g}else{k=g}}return k}return h},insert:function(i,h,j){if(!((i||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.insert(). Table expected")}if(j==undefined){j=h;h=i.__luajs.numValues.length}var g=i.getMember(h);i.setMember(h,j);if(g){luajs.lib.table.insert(i,h+1,g)}},maxn:function(g){if(!((g||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.maxn(). Table expected")}return g.__luajs.numValues.length-1},unpack:function(l,k,h){if(!((l||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in unpack(). Table expected")}k=k||1;if(h===undefined){h=luajs.lib.table.getn(l)}var m=[],g;for(g=k;g<=h;g++){m.push(l.getMember(g))}return m},remove:function(j,i){if(!((j||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 in table.remove(). Table expected")}var h=luajs.lib.table.getn(j),k=j.__luajs.numValues,g;if(i>h){return}if(i==undefined){i=h}g=k.splice(i,1);while(i<h&&k[i]===undefined){delete k[i++]}return g},sort:function(i,h){if(!((i||{}) instanceof luajs.Table)){throw new luajs.Error("Bad argument #1 to 'sort' (table expected)")}var j,g=i.__luajs.numValues;if(h){if(!((h||{}) instanceof luajs.Function)){throw new luajs.Error("Bad argument #2 to 'sort' (function expected)")}j=function(l,k){return h.call({},l,k)[0]?-1:1}}else{j=function(l,k){return l<k?-1:1}}g.shift();g.sort(j).unshift(undefined)}};luajs.lib.math={abs:function(g){return Math.abs(g)},acos:function(g){return Math.acos(g)},asin:function(g){return Math.asin(g)},atan:function(g){return Math.atan(g)},atan2:function(h,g){return Math.atan2(h,g)},ceil:function(g){return Math.ceil(g)},cos:function(g){return Math.cos(g)},cosh:function(g){},deg:function(g){return g*180/Math.PI},exp:function(g){return Math.exp(g)},floor:function(g){return Math.floor(g)},fmod:function(g,h){return g%h},frexp:function(g,h){},huge:Infinity,ldexp:function(g,h){return g*Math.pow(2,h)},log:function(h,i){var g=Math.log(h);if(i!==undefined){return g/Math.log(i)}return g},log10:function(g){return Math.log(g)/Math.log(10)},max:function(){var g=-Infinity,j=arguments.length,h;for(h=0;h<j;h++){if(arguments[h]>g){g=arguments[h]}}return g},min:function(){var h=Infinity,j=arguments.length,g;for(g=0;g<j;g++){if(arguments[g]<h){h=arguments[g]}}return h},modf:function(g){var i=Math.floor(g),h=g-i;return[i,h]},pi:Math.PI,pow:function(g,h){if((g=luajs.utils.toFloat(g))===undefined){throw new luajs.Error("bad argument #1 to 'pow' (number expected)")}if((h=luajs.utils.toFloat(h))===undefined){throw new luajs.Error("bad argument #2 to 'pow' (number expected)")}return Math.pow(g,h)},rad:function(g){if((g=luajs.utils.toFloat(g))===undefined){throw new luajs.Error("bad argument #1 to 'rad' (number expected)")}return(Math.PI/180)*g},random:function(h,g){if(h===undefined&&g===undefined){return b()}if(typeof h!=="number"){throw new luajs.Error("bad argument #1 to 'random' (number expected)")}if(g===undefined){g=h;h=1}else{if(typeof g!=="number"){throw new luajs.Error("bad argument #2 to 'random' (number expected)")}}if(h>g){throw new luajs.Error("bad argument #2 to 'random' (interval is empty)")}return Math.floor(b()*(g-h+1)+h)},randomseed:function(g){if(typeof g!=="number"){throw new luajs.Error("bad argument #1 to 'randomseed' (number expected)")}e=g},sin:function(g){return Math.sin(g)},sinh:function(g){},sqrt:function(g){return Math.sqrt(g)},tan:function(g){return Math.tan(g)},tanh:function(g){}};luajs.lib.io={write:function(){var j,g,h="";for(var j in arguments){if(arguments.hasOwnProperty(j)){var g=arguments[j];if(["string","number"].indexOf(typeof g)==-1){throw new luajs.Error("bad argument #"+j+" to 'write' (string expected, got "+typeof g+")")}h+=g}}luajs.stdout.write(h)}};luajs.lib.os={clock:function(){},date:function(q,l){if(q===undefined){q="%c"}var r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],j=["January","February","March","April","May","June","July","August","September","October","November","December"],g=[31,28,31,30,31,30,31,31,30,31,30,31],o=function(v,i){var t=parseInt(m["%j"](v),10),s=new Date(v.getFullYear(),0,1,12),u=(8-s["get"+p+"Day"]()+i)%7;return("0"+(Math.floor((t-u)/7)+1)).substr(-2)},m={"%a":function(i){return r[i["get"+p+"Day"]()].substr(0,3)},"%A":function(i){return r[i["get"+p+"Day"]()]},"%b":function(i){return j[i["get"+p+"Month"]()].substr(0,3)},"%B":function(i){return j[i["get"+p+"Month"]()]},"%c":function(i){return i["to"+p+"LocaleString"]()},"%d":function(i){return("0"+i["get"+p+"Date"]()).substr(-2)},"%H":function(i){return("0"+i["get"+p+"Hours"]()).substr(-2)},"%I":function(i){return("0"+((i["get"+p+"Hours"]()+11)%12+1)).substr(-2)},"%j":function(v){var t=v["get"+p+"Date"](),s=v["get"+p+"Month"]();for(var u=0;u<s;u++){t+=g[u]}if(s>1&&v["get"+p+"FullYear"]()%4===0){t+=1}return("00"+t).substr(-3)},"%m":function(i){return("0"+(i["get"+p+"Month"]()+1)).substr(-2)},"%M":function(i){return("0"+i["get"+p+"Minutes"]()).substr(-2)},"%p":function(i){return(i["get"+p+"Hours"]()<12)?"AM":"PM"},"%S":function(i){return("0"+i["get"+p+"Seconds"]()).substr(-2)},"%U":function(i){return o(i,0)},"%w":function(i){return""+(i["get"+p+"Day"]())},"%W":function(i){return o(i,1)},"%x":function(i){return m["%m"](i)+"/"+m["%d"](i)+"/"+m["%y"](i)},"%X":function(i){return m["%H"](i)+":"+m["%M"](i)+":"+m["%S"](i)},"%y":function(i){return m["%Y"](i).substr(-2)},"%Y":function(i){return""+i["get"+p+"FullYear"]()},"%Z":function(i){return p?"UTC":i.toString().substr(-4,3)},"%%":function(){return"%"}},p="",k=new Date();if(l){k.setTime(l*1000)}if(q.substr(0,1)==="!"){q=q.substr(1);p="UTC"}if(q==="*t"){var h=function(t){var s=t.getFullYear(),i=new Date(s,0);return(t.getTimezoneOffset()!==i.getTimezoneOffset())};return new luajs.Table({year:parseInt(m["%Y"](k),10),month:parseInt(m["%m"](k),10),day:parseInt(m["%d"](k),10),hour:parseInt(m["%H"](k),10),min:parseInt(m["%M"](k),10),sec:parseInt(m["%S"](k),10),wday:parseInt(m["%w"](k),10)+1,yday:parseInt(m["%j"](k),10),isdst:h(k)})}for(var n in m){if(m.hasOwnProperty(n)&&q.indexOf(n)>=0){q=q.replace(n,m[n](k))}}return q},difftime:function(g,h){return g-h},execute:function(){if(arguments.length){throw new luajs.Error("shell is not available. You should always check first by calling os.execute with no parameters")}return 0},exit:function(){throw"Execution terminated."},getenv:function(){},remove:function(){},rename:function(){},setlocale:function(){},time:function(l){var n;if(!l){n=Date.now?Date.now():new Date().getTime()}else{var h,m,k,g,i,j;if(!(h=l.getMember("day"))){throw new luajs.Error("Field 'day' missing in date table")}if(!(m=l.getMember("month"))){throw new luajs.Error("Field 'month' missing in date table")}if(!(k=l.getMember("year"))){throw new luajs.Error("Field 'year' missing in date table")}g=l.getMember("hour")||12;i=l.getMember("min")||0;j=l.getMember("sec")||0;if(l.getMember("isdst")){g--}n=new Date(k,m-1,h,g,i,j).getTime()}return Math.floor(n/1000)},tmpname:function(){}};luajs.lib.coroutine={create:function(g){return luajs.Coroutine.create(g)},resume:function(g){var j=[];for(var k=1,h=arguments.length;k<h;k++){j.push(arguments[k])}return g.resume.apply(g,j)},running:function(){return luajs.Coroutine._running},status:function(g){return g.status},wrap:function(i){var h=luajs.lib.coroutine.create(i);var g=function(){var m=[h];for(var n=0,j=arguments.length;n<j;n++){m.push(arguments[n])}var k=luajs.lib.coroutine.resume.apply({},m),o=k.shift();if(o){return k}throw k[0]};g._coroutine=h;return g},yield:function(){if(!luajs.Coroutine._running){throw new luajs.Error("attempt to yield across metamethod/C-call boundary (not in coroutine)")}if(luajs.Coroutine._running.status!="running"){throw new luajs.Error("attempt to yield non-running coroutine in host")}var j=[],h=luajs.Coroutine._running;for(var k=0,g=arguments.length;k<g;k++){j.push(arguments[k])}h._yieldVars=j;h.status="suspending";return{resume:function(){var n=[h],o,m=arguments.length,p=function(){luajs.lib.coroutine.resume.apply(undefined,n)};for(o=0;o<m;o++){n.push(arguments[o])}if(h.status=="suspending"){window.setTimeout(p,1)}else{p()}}}}}})();var luajs=luajs||{};luajs.debug={};(function(){var a=/^[-+]?[0-9]*\.?([0-9]+([eE][-+]?[0-9]+)?)?$/;luajs.utils={coerce:function(d,c,b){var e;switch(c){case"boolean":return !(d===false||d===undefined);case"string":return""+d;case"number":if((""+d).match(a)){e=parseFloat(d)}if(e===undefined&&b){throw new luajs.Error(b)}return e;default:throw new ReferenceError("Can not coerce to type: "+c)}},toObject:function(g){var f=luajs.lib.table.getn(g)>0,b=f?[]:{},d=g.__luajs.numValues,e,c=d.length;for(e=1;e<c;e++){b[e-1]=((d[e]||{}) instanceof luajs.Table)?luajs.utils.toObject(d[e]):d[e]}for(e in g){if(g.hasOwnProperty(e)&&!(e in luajs.Table.prototype)&&e!=="__luajs"){b[e]=((g[e]||{}) instanceof luajs.Table)?luajs.utils.toObject(g[e]):g[e]}}return b},parseJSON:function(b){var c=function(e){for(var d in e){if(e.hasOwnProperty(d)){if(typeof e[d]==="object"){e[d]=c(e[d])}else{if(e[d]===null){e[d]=undefined}}}}return new luajs.Table(e)};return c(JSON.parse(b))},toFloat:function(b){if(b===Infinity||b===-Infinity){return b}var c=/^[-+]?[0-9]*\.?([0-9]+([eE][-+]?[0-9]+)?)?$/;if(!(""+b).match(c)){return}return parseFloat(b)}}})();var luajs=luajs||{};luajs.stdout={};luajs.stdout.write=function(a){if(console&&console.log){console.log(a)}else{if(trace){trace(a)}}};luajs.stddebug={};luajs.stddebug.write=function(a){};luajs.stderr={};luajs.stderr.write=function(a,b){b=b||"error";if(console&&console[b]){console[b](a)}};